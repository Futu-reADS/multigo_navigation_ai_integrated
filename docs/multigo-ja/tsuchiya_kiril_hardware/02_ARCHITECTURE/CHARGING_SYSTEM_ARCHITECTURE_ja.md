# 充電システムアーキテクチャ

**プロジェクト:** 屋外車椅子輸送ロボット - マルチチームシステム
**ドキュメントタイプ:** ハードウェアアーキテクチャ仕様
**チーム:** Tsuchiya（ハードウェア）+ Pankaj（自動充電ソフトウェア）
**日付:** December 16, 2025
**バージョン:** 1.0

---

## システム概要

```
┌─────────────────────────────────────────────────────────┐
│           充電ステーション（固定インフラ）                │
│                                                         │
│  200V 3相AC入力                                          │
│         │                                               │
│         ▼                                               │
│  ┌──────────────────┐                                   │
│  │  AC-DCコンバーター│  (ベイあたり2 kW)                │
│  │  200V AC → 48V DC│                                   │
│  │  (絶縁型)        │                                   │
│  └────────┬─────────┘                                   │
│           │                                             │
│      ┌────┴────┐                                        │
│      │         │                                        │
│   ┌──▼───┐ ┌──▼───┐                                    │
│   │ベイ1 │ │ベイ2 │ (各48V @ 20A)                      │
│   │      │ │      │                                    │
│   │  🔌  │ │  🔌  │ スプリング式ポゴピン               │
│   │ +48V │ │ +48V │ (4ピン: +48V、GND、CAN_H、CAN_L)   │
│   │ GND  │ │ GND  │                                    │
│   │CAN_H │ │CAN_H │                                    │
│   │CAN_L │ │CAN_L │                                    │
│   └──────┘ └──────┘                                    │
│      │         │                                        │
│   [ArUco]  [ArUco] (ドッキングアライメントマーカー)    │
└──────┼─────────┼───────────────────────────────────────┘
       │         │
       ▼         ▼
    車両      車両
    (後部     (後部
     ポート)   ポート)
```

## 車両充電ポート

### 物理設計

```
ロボット後面図

     ┌────────────────────┐
     │   ロボットシャーシ   │
     │                    │
     │  ┌──────────────┐  │
     │  │ 充電ポート    │  │
     │  │  (凹型)      │  │
     │  │              │  │
     │  │  ●  ●        │  │ ← 4つのスプリング式接点
     │  │              │  │   (+48V、GND、CAN_H、CAN_L)
     │  │  ●  ●        │  │
     │  │              │  │
     │  │ [ArUco ID50] │  │ ← 100mm × 100mmマーカー
     │  └──────────────┘  │
     │        高さ500mm   │
     └────────────────────┘
```

**接点:**
- 材料: 金メッキ銅（耐腐食性）
- タイプ: スプリング式ポゴピン、ピンあたり10A定格
- トラベル: 10mm圧縮範囲
- 抵抗: 接続時<10mΩ
- IP定格: IP65（非充電時シール）

**ArUcoマーカー:**
- サイズ: 100mm × 100mm
- ID: 50（充電ポート固有）
- 材料: 耐UVビニール
- 反射性: 再帰反射コーティング（夜間視認性）

### 電気インターフェース

**電源ピン:**
- ピン1: +48V（充電プラス）
- ピン2: GND（充電マイナス）
- 電流容量: 20A連続

**通信ピン:**
- ピン3: CAN_H（ISO 11898 CANバス）
- ピン4: CAN_L
- ボーレート: 250 kbit/s
- 目的: 充電ハンドシェイク、BMSテレメトリー

## 充電ステーション設計

### AC-DCコンバーター

**仕様:**
- 入力: 200V 3相AC、50/60 Hz
- 出力: 48V DC、ベイあたり2 kW（20A × 2ベイ = 合計40A）
- 効率: ≥95%
- 力率: >0.95（PFC回路）
- 保護: 過電流、過電圧、短絡

**安全機能:**
- 地絡検出（<30mAトリップ）
- 絶縁トランス（入出力絶縁）
- 非常停止ボタン（全電源遮断）

### ポゴピン接点（ステーション側）

**仕様:**
- 力: ピンあたり200g（接触圧維持）
- メッキ: 金メッキ（10μm厚）
- 耐久性: 10,000嵌合サイクル
- アライメント公差: X-Y平面で±50mm
- 自動アライメント: テーパー付きガイドファンネル

### 防水性

- 接点: IP65シールドハウジング
- ケーブル: IP67コネクター、ストレインリリーフ
- エンクロージャー: IP54（屋外キャノピー上部）
- 排水: 傾斜接点ホルダー（水流出）

## 充電プロトコル

### ハンドシェイクシーケンス（CANバス）

1. **車両接続**（電圧センシングで物理的接触検出）
2. **ステーション送信:** `CHARGING_READY`メッセージ（CAN ID 0x100）
3. **車両応答:** `BMS_STATUS`（SoC、電圧、温度、健全性）
4. **ステーション検証:** 充電可能なバッテリーステータスを確認
5. **ステーション有効化:** 充電リレー閉じ、CC-CV充電開始
6. **連続監視:** 車両が1秒ごとに`BMS_STATUS`送信
7. **充電完了:** 電流<1A → ステーションが`CHARGING_COMPLETE`送信
8. **車両切断:** リレー開放、ベイから退出

### CANメッセージ定義

**CHARGING_READY（ステーション → 車両）**
```
CAN ID: 0x100
Data: [0x01, bay_id, max_current (A), reserved...]
```

**BMS_STATUS（車両 → ステーション）**
```
CAN ID: 0x101
Data: [SOC (%), voltage_high, voltage_low, temp (°C), current_high, current_low, flags]
flags: bit 0 = charging_enabled、bit 1 = temp_ok、bit 2 = voltage_ok
```

**CHARGING_COMPLETE（ステーション → 車両）**
```
CAN ID: 0x102
Data: [0x01, bay_id, energy_delivered_kWh, duration_min]
```

### CC-CV充電プロファイル

**定電流（CC）フェーズ:**
- 電流: 20A（40Ahバッテリーで0.5C）
- 電圧制限: 54.6V（セルあたり4.2V × 13S）
- 期間: 約1.5時間（20% → 80% SoC）

**定電圧（CV）フェーズ:**
- 電圧: 54.6V
- 電流テーパー: 20A → 1A
- 終了: 電流<1A（充電完了）
- 期間: 約30分

**総充電時間:** 約2時間（20% → 80% SoC）

## 自動ドッキング

### ArUcoベース精密ドッキング

1. **接近:** 車両が充電ステーションへナビゲート（GPS/NDTローカライゼーション）
2. **粗アライメント:** ベイから2m以内に位置、後ろ向き
3. **ArUco検出:** 後部カメラがベイ上のArUcoマーカーを検出
4. **精密アライメント:** ビジュアルサーボイングで車両ポートをステーション接点に揃える
5. **最終ドッキング:** 接点が接続するまで後退（±20mm精度）
6. **確認:** 電圧センシング + CANハンドシェイクで接続確認

### アライメント公差

- 必要ドッキング精度: ±20mm（X-Y平面）、±5°（ヨー）
- 接点自動アライメント: ±50mm（スプリング式接点が補償）
- 成功率目標: ≥95%一回目ドッキング

## 充電ベイレイアウト

### 物理寸法

```
上面図

ベイ1              ベイ2
┌──────┐          ┌──────┐
│      │          │      │
│  🔌  │   2m     │  🔌  │
│ArUco │          │ArUco │
└──────┘          └──────┘
   ↑                 ↑
  1.5m             1.5m
   ↓                 ↓
車両              車両
接近              接近
ゾーン            ゾーン
```

- ベイ幅: 1.5m（車両幅0.9m + 0.6mクリアランス）
- ベイ奥行: 2m（車両長1.2m + 0.8mクリアランス）
- ベイ間隔: 2m（相互交通防止）

### ステーションエンクロージャー

- 材料: 粉体塗装鋼フレーム、ポリカーボネート屋根
- 寸法: 5m（幅）× 3m（奥行）× 3m（高さ）
- 天候保護: 上部キャノピー（充電中の車両を保護）
- 照明: LEDストリップ（夜間視認性）
- 取り付け: コンクリートパッド、アンカーボルト

## 電力管理

### 負荷バランシング

- 総ステーション容量: 4 kW（2ベイ × 2 kW）
- 両ベイ占有時: ベイあたり2 kW（標準充電レート）
- 1ベイ占有時: 2 kW（フルレート、またはサポートされていれば3 kW急速充電）

### エネルギー計測

- セッションごとに供給されたエネルギーを測定（kWh）
- ステーションコントローラーに保存（TVMサーバーにログ）
- メンテナンス計画とコスト会計に使用

---

**合計:** CHARGING_INFRASTRUCTURE_REQUIREMENTS.mdで85要件をカバー

**ドキュメント終了**

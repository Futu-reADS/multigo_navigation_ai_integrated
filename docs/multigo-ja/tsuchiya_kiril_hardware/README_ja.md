# ハードウェアプラットフォーム - Tsuchiya + Kirilの範囲

**チームリーダー:**
- **Tsuchiya** - 機械、電気、センサー、電源
- **Kiril** - 外装、eHMIハードウェア、美観

**範囲:** 物理ハードウェアプラットフォームのみ
**タイムライン:** 16週間（プロトタイプ5週間、完全プラットフォーム11週間）
**ステータス:** 実装準備完了

---

## 🎯 あなたが構築するもの

### Tsuchiyaの範囲（機械+電気+センサー）

**機械システム:**
- ✅ **シャシー設計** - 溶接アルミニウムフレーム、耐荷重100kg
- ✅ **スワーブドライブモジュール** - 4つの独立したステアリングと駆動モジュール
- ✅ **サスペンションシステム** - 屋外の荒れた地形用
- ✅ **ドッキングメカニズム** - 車椅子への物理的な取り付け
- ✅ **センサー取り付け** - LiDAR、カメラ、IMU、バンパー
- ✅ **ケーブル管理** - 内部配線、防水コネクタ

**電気システム:**
- ✅ **電源分配** - 48Vバス、DC-DCコンバーター（12V、5V）
- ✅ **バッテリー管理システム（BMS）** - 48V 20Ah LiFePO4、CANインターフェース
- ✅ **モーターコントローラー** - 駆動4つ + ステアリング4つ（CANバス）
- ✅ **コンピュートプラットフォーム** - GMKtec Nucbox K6（AMD Ryzen 7 7840HS、32GB RAM）
- ✅ **安全システム** - ハードウェア緊急停止、バンパー、ウォッチドッグ
- ✅ **充電システム** - 48V充電ポート

**センサー統合:**
- ✅ **3D LiDAR** - 屋外グレードIP65+、USB/イーサネットインターフェース
- ✅ **カメラ** - 2つのRGBカメラ（ArUco検出、障害物認識）
- ✅ **IMU** - 9自由度（MPU-9250または同等品）
- ✅ **エンコーダー** - 駆動エンコーダー4つ + ステアリングエンコーダー4つ
- ✅ **バンパー** - 衝突検出用接触センサー

### Kirilの範囲（外装 + eHMI）

**外装設計:**
- ✅ **ボディパネル** - 防水（IP54+）、美的デザイン
- ✅ **照明** - ヘッドライト、テールライト、ウインカー
- ✅ **保護カバー** - LiDARカバー、カメラカバー
- ✅ **ブランディング** - ロゴ、カラースキーム、ビジュアルアイデンティティ

**eHMIハードウェア:**
- ✅ **ESP32-S3コントローラー** - LED制御用マイクロコントローラー
- ✅ **LEDシステム** - WS2812B LEDストリップ（2-3メートル、60+ LED/メートル）
- ✅ **オーディオシステム** - I2Sアンプ（MAX98357A）、スピーカー（5W+、防水）
- ✅ **ディスプレイ（オプション）** - ステータスメッセージ用小型OLED
- ✅ **シリアル通信** - メインコンピュートへのUART

---

## ❌ あなたが構築しないもの

- ❌ **車両ソフトウェア**（Pankajの責任範囲）
  - ROS 2ノード、ナビゲーションアルゴリズム、制御ソフトウェアは含まれません
  - UI、ドッキングコントローラー、知覚は含まれません

- ❌ **TVMサーバー**（Unnoの責任範囲）
  - バックエンドサーバー、データベース、フリートダッシュボードは含まれません
  - サーバーサイドロジックは含まれません

**あなたの焦点:** Pankajのソフトウェアが制御する物理ハードウェア

---

## 🔗 あなたのインターフェース

### 車両ソフトウェアへのインターフェース（Pankaj）

**ドキュメント（重要）:**
- `04_INTERFACES/HARDWARE_SOFTWARE_INTERFACE.md` - **これを提供する必要があります**

**Pankajがあなたから必要とするもの:**

**ROS 2トピック（あなたが公開）:**
- `/sensors/lidar/points` - 3D LiDARポイントクラウド（10 Hz）
- `/sensors/camera/front/image` - フロントカメラ（10 Hz）
- `/sensors/camera/rear/image` - リアカメラ（10 Hz）
- `/sensors/imu/data` - IMU（50 Hz）
- `/sensors/battery/status` - バッテリー（1 Hz）
- `/safety/bumpers` - バンパー接触ステータス（50 Hz）
- `/safety/estop` - 緊急停止ステータス（50 Hz）

**ROS 2トピック（あなたがサブスクライブ）:**
- `/control/cmd_vel` - ソフトウェアからの速度コマンド
- `/control/swerve/drive_velocities` - 駆動モーター速度（4モーター）
- `/control/swerve/steer_angles` - ステアリング角度（4モーター）

**CANバス:**
- モーターコントローラーがコマンドに応答
- BMSがバッテリーデータを公開

**シリアル（eHMI）:**
- ESP32がソフトウェアからLED/サウンドコマンドを受信
- ESP32がソフトウェアにステータスを送信

---

## 🛠️ ハードウェア仕様

### コンピュートプラットフォーム

**モデル:** GMKtec Nucbox K6
- **CPU:** AMD Ryzen 7 7840HS（8コア、16スレッド、3.8-5.1 GHz）
- **RAM:** 32GB DDR5
- **GPU:** AMD Radeon 780M（内蔵）
- **ストレージ:** 1TB NVMe SSD
- **OS:** Ubuntu 22.04 LTS（Pankajがインストール）
- **ポート:** USB 3.2、USB-C、イーサネット、HDMI

### 電源システム

**バッテリー:**
- **タイプ:** LiFePO4（より安全、長寿命）
- **電圧:** 48V公称
- **容量:** 20Ah（960Wh）
- **BMS:** CANバスインターフェース、過電流/過電圧保護
- **稼働時間:** 乗客を乗せて≥4時間

**電源分配:**
- 48V → モーターコントローラー（直接）
- 48V → 12V（DC-DCコンバーター、20A）→ コンピュート、センサー
- 48V → 5V（DC-DCコンバーター、10A）→ ESP32、小型電子機器

### モーター

**駆動モーター（4つ）:**
- **タイプ:** 6.5インチホバーボードインホイールモーター
- **出力:** 1輪あたり80W（合計320W）
- **電圧:** 48V
- **制御:** CANバスモーターコントローラー
- **エンコーダー:** ホール効果センサー

**ステアリングモーター（4つ）:**
- **オプション1:** デジタルサーボ（3.5Nmトルク）
- **オプション2:** パワーウィンドウモーター（2.9Nmトルク）
- **制御:** PWMまたはCANバス

### センサー

**3D LiDAR:**
- **範囲:** 30-100メートル
- **視野:** 水平360°、垂直±15°（最小）
- **精度:** ±3cm
- **保護:** IP65+（屋外グレード）
- **インターフェース:** イーサネットまたはUSB
- **コスト:** $1000-3000

**カメラ（2つ）:**
- **解像度:** 1920x1080（最小）
- **FPS:** 30 FPS
- **インターフェース:** USB 3.0
- **保護:** IP54+防水ハウジング
- **目的:** ArUco検出（ドッキング）、障害物認識

**IMU:**
- **タイプ:** 9自由度（加速度計、ジャイロスコープ、磁力計）
- **モデル:** MPU-9250または同等品
- **インターフェース:** I2CまたはSPI
- **サンプリングレート:** 最小50 Hz

**エンコーダー:**
- **駆動エンコーダー:** 4つ（モーターに内蔵または別個）
- **ステアリングエンコーダー:** ステアリング角度用絶対エンコーダー4つ
- **解像度:** 最小360ティック/回転

**バンパー:**
- **タイプ:** 接触スイッチまたは圧力センサー
- **場所:** 前面、後面、側面
- **インターフェース:** GPIOまたはCANバス

**緊急停止:**
- **タイプ:** 物理的な緊急停止ボタン
- **回路:** モーターコントローラーに直接配線（安全上重要）
- **冗長性:** デュアルチャネル（2つの独立した回路）

### eHMIハードウェア（Kiril）

**ESP32-S3:**
- **目的:** LED、スピーカー、ディスプレイの制御
- **通信:** メインコンピュートへのUART（115200ボー）
- **電源:** DC-DCコンバーターから5V

**LEDシステム:**
- **タイプ:** WS2812Bアドレス可能LEDストリップ
- **長さ:** 2-3メートル
- **密度:** 60+ LED/メートル
- **制御:** ESP32からSPI

**オーディオシステム:**
- **アンプ:** MAX98357A（I2S）
- **スピーカー:** 5W+防水スピーカー
- **オーディオファイル:** SDカードに保存（WAV形式）

---

## 📁 フォルダ構造

```
tsuchiya_kiril_hardware/
├── 01_REQUIREMENTS/          ← ハードウェアが満たすべき要件
│   ├── MECHANICAL_REQUIREMENTS.md（Tsuchiya）
│   ├── ELECTRICAL_REQUIREMENTS.md（Tsuchiya）
│   ├── COMMUNICATION_SYSTEM_REQUIREMENTS.md（Tsuchiya）
│   ├── EXTERIOR_REQUIREMENTS.md（Kiril）
│   └── CHARGING_INFRASTRUCTURE_REQUIREMENTS.md（Tsuchiya）
│
├── 02_ARCHITECTURE/          ← システムの構成
│   ├── MECHANICAL_SYSTEM_ARCHITECTURE.md
│   ├── ELECTRICAL_SYSTEM_ARCHITECTURE.md
│   └── CHARGING_SYSTEM_ARCHITECTURE.md
│
├── 03_DESIGN/                ← 詳細設計
│   ├── MECHANICAL_CAD_DESIGN.md（CADモデル、図面）
│   ├── ELECTRICAL_SCHEMATICS.md（配線図）
│   └── PCB_DESIGN.md（カスタムPCBがある場合）
│
├── 04_INTERFACES/            ← ソフトウェアへのインターフェース（Pankaj）
│   └── HARDWARE_SOFTWARE_INTERFACE.md ← これを提供（重要！）
│
├── 05_DEVELOPMENT/           ← 構築方法
│   └── HARDWARE_DEVELOPMENT_GUIDE.md
│
└── README.md                 ← このファイル
```

---

## 🚀 クイックスタート

### 1. まずインターフェースドキュメントを読む

**重要 - 構築前に必読:**
1. `04_INTERFACES/HARDWARE_SOFTWARE_INTERFACE.md` - Pankajがあなたから必要とするもの

**主要セクション:**
- 公開する必要があるROS 2トピック（センサー）
- サブスクライブする必要があるROS 2トピック（コマンド）
- CANバスプロトコル
- シリアルプロトコル（eHMI）

### 2. 要件を確認

何を構築するかを理解するために、以下から始めてください:
1. `01_REQUIREMENTS/MECHANICAL_REQUIREMENTS.md`（Tsuchiya）
2. `01_REQUIREMENTS/ELECTRICAL_REQUIREMENTS.md`（Tsuchiya）
3. `01_REQUIREMENTS/EXTERIOR_REQUIREMENTS.md`（Kiril）

### 3. 実装を開始

**推奨される順序:**

**フェーズ1: 高速プロトタイプ（5週間）**
- **第1-2週:** センサーを選択、アーキテクチャを定義、部品を調達
- **第3-4週:** 基本シャシーを組み立て、駆動モーターを設置
- **第5週:** LiDAR + カメラ + CAN通信を追加

**マイルストーン:** "ウォーキングスケルトン" - プラットフォームが駆動でき、センサーがデータを公開

**フェーズ2: 改良（11週間）**
- **第6-8週:** ステアリングモーターを追加（スワーブドライブを完成）
- **第9-10週:** サスペンションシステムを設置
- **第11-12週:** 残りのセンサーを追加（バンパー、IMU）
- **第13-14週:** ドッキングメカニズムを実装
- **第15週:** 制御システム統合を完了
- **第16週:** 最終防水処理

**フェーズ3: 外装（Kirilと並行）**
- **第1-8週:** 外装CAD設計
- **第9-12週:** ボディパネルを製作
- **第13-16週:** eHMIハードウェア組み立て

---

## 🔧 組み立てチェックリスト

### 機械（Tsuchiya）

- [ ] シャシーフレームを溶接/組み立て
- [ ] スワーブドライブモジュールを設置（4つ）
- [ ] サスペンションシステムを設置
- [ ] ドッキングメカニズムを設置
- [ ] センサー取り付けブラケットを設置
- [ ] ケーブル配線を完了
- [ ] 地上高≥20mmを確認

### 電気（Tsuchiya）

- [ ] バッテリーを設置し固定
- [ ] BMSを設置し設定
- [ ] 電源分配を配線
- [ ] DC-DCコンバーターを設置（48V→12V、48V→5V）
- [ ] モーターコントローラーを設置（8つ）
- [ ] CANバスを配線し終端
- [ ] コンピュートプラットフォームを設置
- [ ] 緊急停止回路を配線しテスト
- [ ] すべてのコネクタを防水処理

### センサー（Tsuchiya）

- [ ] 3D LiDARを取り付けて接続
- [ ] フロントカメラを取り付けて接続
- [ ] リアカメラを取り付けて接続
- [ ] IMUを設置しキャリブレーション
- [ ] 駆動エンコーダーを設置（4つ）
- [ ] ステアリングエンコーダーを設置（4つ）
- [ ] バンパーを設置
- [ ] バッテリー監視を接続

### eHMI（Kiril）

- [ ] ESP32-S3を設置
- [ ] LEDストリップを設置し配線
- [ ] スピーカーを設置
- [ ] オーディオアンプを設置
- [ ] コンピュートへのシリアル接続
- [ ] 電源供給を確認（5V）
- [ ] eHMIファームウェアをアップロード（Pankajが実施）

### 外装（Kiril）

- [ ] ボディパネルを設置
- [ ] ヘッドライト/テールライトを設置
- [ ] LiDAR保護カバーを設置
- [ ] カメラカバーを設置
- [ ] ブランディング/ロゴを適用
- [ ] IP54+防水を確認

---

## 🧪 テストと検証

### 単体テスト（コンポーネントレベル）

**電源システム:**
- [ ] バッテリー電圧が正しい（48V ±2V）
- [ ] DC-DCコンバーターの出力が正しい（12V、5V）
- [ ] BMSがCAN経由でデータを報告
- [ ] 充電システムが動作している

**モーター:**
- [ ] すべての駆動モーター4つがCANコマンドに応答
- [ ] すべてのステアリングモーター4つがコマンドに応答
- [ ] エンコーダーが正しい値を報告
- [ ] 負荷下で過熱なし

**センサー:**
- [ ] LiDARがポイントクラウドを公開
- [ ] カメラが画像をキャプチャ
- [ ] IMUが方向を報告
- [ ] バンパーが接触を検出
- [ ] 緊急停止が正しく機能

**eHMI:**
- [ ] LEDがシリアルコマンドで制御可能
- [ ] スピーカーがオーディオを再生
- [ ] ステータスメッセージがコンピュートに送信される

### 統合テスト（Pankajのソフトウェアと）

**Pankajとの調整:**
- [ ] ROS 2トピックを確認（正しいメッセージタイプ、周波数）
- [ ] CANバスコマンドが動作している
- [ ] シリアルプロトコルをテスト
- [ ] レイテンシーを測定（安全上重要なもので<100ms）

### 安全テスト

- [ ] 緊急停止がすべてのモーターを<100msで停止
- [ ] バンパーが緊急停止をトリガー
- [ ] バッテリーBMSが過電流から保護
- [ ] サーマルシャットダウンが動作
- [ ] フェイルセーフ動作を確認

### 環境テスト

- [ ] IP54+防水を確認（水スプレーテスト）
- [ ] 屋外動作をテスト（雨、太陽、風）
- [ ] 温度範囲をテスト（-10°Cから+40°C）
- [ ] 振動テスト（荒れた地形）

---

## 📋 依存関係

### Pankaj（ソフトウェアチーム）から

**彼から必要なもの:**
- [ ] ROS 2トピック定義（HARDWARE_SOFTWARE_INTERFACE.md）
- [ ] 制御コマンドフォーマット（速度、ステアリング）
- [ ] eHMIシリアルプロトコル仕様
- [ ] コンピュートにUbuntu 22.04 + ROS 2 Humbleをインストール
- [ ] センサー用ROS 2ドライバーノード

**調整:**
- `shared/INTERFACES/HARDWARE_SOFTWARE_INTERFACE.md`を一緒に確認
- 各インターフェースを段階的にテスト
- 週次統合会議

### Unno（TVMサーバーチーム）から

**直接の依存関係なし** - Pankajのソフトウェア経由で通信

---

## ⚠️ 重要な注意事項

### 安全性は重要

**このロボットは人を輸送します:**
- ハードウェア緊急停止はフェイルセーフである必要があります（デュアルチャネル）
- バンパーは緊急停止をトリガーする必要があります
- バッテリーには過電流保護が必要です
- すべての安全回路をテストし検証する必要があります

### インターフェースコントラクトは凍結されています

**Pankajと調整せずにインターフェースを変更しないでください:**
- ROSトピック名、メッセージタイプ、周波数は定義されています
- CANバスプロトコルは定義されています
- シリアルプロトコルは定義されています

**インターフェース変更が必要な場合:**
1. Pankajと議論
2. HARDWARE_SOFTWARE_INTERFACE.mdを更新（両者が同意）
3. 更新されたインターフェースをテスト

### 防水処理

**ロボットは屋外で動作する必要があります:**
- すべての電子機器はIP54+定格（粉塵+水スプレー保護）
- すべてのコネクタは防水（自動車グレード）
- バッテリーは雨から保護
- センサーは保護されている（ただし機能的）

### ケーブル管理

**プロフェッショナルなケーブル配線:**
- 内部配線（外部にぶら下がるケーブルはなし）
- すべてのコネクタにストレインリリーフ
- カラーコード化されたワイヤー（電源、信号、グランド）
- メンテナンス用にラベル付けされたコネクタ

---

## 📞 連絡先

**あなたのチーム:**
- **Tsuchiya** - 機械、電気、センサー、電源
- **Kiril** - 外装、eHMIハードウェア

**ソフトウェアチーム:** Pankaj
- **インターフェース:** HARDWARE_SOFTWARE_INTERFACE.md
- **調整:** 週次統合会議
- **テスト:** プロトタイプ完成後の統合テスト

**サーバーチーム:** Unno
- **直接インターフェースなし** - Pankajのソフトウェア経由で通信

**上級者:** [名前]
- **承認:** 最終ハードウェア設計と調達

---

## ✅ 成功基準

### プロトタイプ（第5週）

- [ ] プラットフォームが前後に駆動できる
- [ ] LiDARがデータを公開
- [ ] カメラが画像を公開
- [ ] 電源システムが機能している
- [ ] Pankajが実際のハードウェアでソフトウェア開発を開始できる

### 完全プラットフォーム（第16週）

- [ ] スワーブドライブが完全に機能（全方向移動）
- [ ] すべてのセンサーが動作している
- [ ] ドッキングメカニズムが動作している
- [ ] eHMIが機能している（LED、スピーカー）
- [ ] 防水（IP54+）
- [ ] 安全システムが検証されている

### ソフトウェアとの統合

- [ ] すべてのROSトピックが正しく動作している
- [ ] 制御レイテンシー<100ms
- [ ] 通信エラーなし
- [ ] 安全システムがソフトウェアでテストされている

---

**ドキュメントバージョン:** 1.0
**最終更新日:** 2025年12月19日
**ステータス:** 実装準備完了
**次のアクション:** PankajからのHARDWARE_REQUIREMENTS_FOR_TSUCHIYA.mdを待つ

---

**ハッピービルディング！ 🔧**

# パーセプション要件

**文書ID:** REQ-PERC-001
**バージョン:** 1.0
**日付:** 2025年12月15日
**ステータス:** ドラフト
**分類:** 内部

---

## 文書管理

| バージョン | 日付 | 著者 | 変更内容 |
|---------|------|--------|---------|
| 1.0 | 2025-12-15 | Perception Lead | ParcelPalバイナリ障害物検出アーキテクチャに基づく初期パーセプション要件 |

---

## 1. はじめに

### 1.1 目的

この文書は、屋外優先車椅子搬送ロボットの**パーセプション要件**を規定します。パーセプションサブシステムは、センサーデータ（3D LiDAR、カメラ、IMU）を処理して障害物を検出し、自律ナビゲーションをサポートします。ParcelPalバイナリ障害物検出アプローチに従います（物体分類なし、ディープラーニングなし）。

### 1.2 範囲

この仕様は以下をカバーします:
- **3D LiDAR処理** - ポイントクラウドフィルタリング、障害物検出（バイナリ: 障害物または自由空間）
- **カメラ処理** - 画像取得、キャリブレーション、ArUcoマーカー検出サポート
- **IMU処理** - 姿勢推定、傾斜検出、センサーフュージョン
- **センサーフュージョン** - マルチセンサー統合、タイムスタンプ同期、TF2変換
- **障害物検出** - バイナリ占有グリッド、コストマップ生成（CPUベースPCL処理）
- **パフォーマンス** - 処理レイテンシ、CPU使用量、データレート

**範囲外:**
- ArUcoマーカー検出アルゴリズム（DOCKING_SYSTEM_REQUIREMENTS.mdでカバー）
- ナビゲーション経路計画（NAVIGATION_REQUIREMENTS.mdでカバー）
- 物体分類またはセマンティックセグメンテーション（不要 - ParcelPalアプローチ）
- ディープラーニングベースのパーセプション（GPU制約のため未使用）

### 1.3 関連文書

- **SYSTEM_REQUIREMENTS.md** - セクション1.4（PERC-REQ-001から009）
- **OVERALL_SYSTEM_ARCHITECTURE.md** - セクション3.3（パーセプションサブシステム）
- **PARCELPAL_EXPLORATION_SUMMARY.md** - バイナリ障害物検出アーキテクチャ
- **question_answers.md** - GPU制約、物体分類なし

### 1.4 パーセプション哲学

システムは**ParcelPalバイナリ障害物検出**アプローチに従います:

**処理パイプライン:**
```
3D LiDARポイントクラウド
    ↓
地面平面除去（RANSAC）
    ↓
自車フィルター（ロボットポイントを除去）
    ↓
ボクセルグリッドダウンサンプリング（0.05m）
    ↓
占有グリッド（2D: 障害物=100、自由=0）
    ↓
コストマップ（膨張半径0.5m）
    ↓
Nav2衝突チェッカー
```

**重要な洞察:** 物体分類は不要！すべての障害物を等しく扱う（人=障害物、車=障害物、壁=障害物）。これによりGPU依存性とディープラーニングの複雑さが排除されます。

---

## 2. 3D LiDAR処理要件

### 2.1 ポイントクラウド取得（PERC-LIDAR-ACQ）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-LIDAR-ACQ-001 | システムは、屋外グレード3D LiDAR（IP65+防水）を使用しなければならない | Critical | ハードウェア検査 |
| PERC-LIDAR-ACQ-002 | LiDARは、360°水平視野を提供しなければならない | Critical | データシート |
| PERC-LIDAR-ACQ-003 | LiDARは、≥30°垂直視野を提供しなければならない | High | データシート |
| PERC-LIDAR-ACQ-004 | LiDARは、屋外で50-100mの範囲を持たなければならない | Critical | フィールドテスト |
| PERC-LIDAR-ACQ-005 | LiDARは、最低10 Hzで動作しなければならない | Critical | パフォーマンステスト |
| PERC-LIDAR-ACQ-006 | LiDARは、>100,000ポイント/秒を提供しなければならない | High | データシート |
| PERC-LIDAR-ACQ-007 | LiDARは、<±3cm範囲精度を持たなければならない | High | キャリブレーションテスト |
| PERC-LIDAR-ACQ-008 | システムは、/pointsトピックにポイントクラウドを公開しなければならない（sensor_msgs/PointCloud2） | Critical | トピック検査 |

**要件合計: 8**

---

### 2.2 ポイントクラウドフィルタリング（PERC-LIDAR-FILTER）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-LIDAR-FILTER-001 | システムは、RANSACまたは平面フィッティングを使用して地面平面を除去しなければならない | Critical | 統合テスト |
| PERC-LIDAR-FILTER-002 | システムは、自車両ポイント（ロボットフットプリント内）を除去しなければならない | Critical | 統合テスト |
| PERC-LIDAR-FILTER-003 | システムは、高さでポイントをフィルタリングしなければならない（地面から0.1m〜2.5m） | Critical | 設定 |
| PERC-LIDAR-FILTER-004 | システムは、範囲でポイントをフィルタリングしなければならない（障害物検出用<15m） | High | 設定 |
| PERC-LIDAR-FILTER-005 | システムは、ボクセルグリッドを使用してポイントクラウドをダウンサンプリングしなければならない（0.05m） | High | 設定 |
| PERC-LIDAR-FILTER-006 | システムは、統計的外れ値除去を使用して外れ値を除去しなければならない | Medium | 統合テスト |
| PERC-LIDAR-FILTER-007 | システムは、/points_filteredトピックにフィルタリングされたポイントクラウドを公開しなければならない | High | トピック検査 |

**要件合計: 7**

---

### 2.3 障害物検出（PERC-LIDAR-OBS）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-LIDAR-OBS-001 | システムは、バイナリ分類（障害物または自由空間）を使用して障害物を検出しなければならない | Critical | 統合テスト |
| PERC-LIDAR-OBS-002 | システムは、物体分類を実行してはならない（人/車/木の区別なし） | Critical | アーキテクチャレビュー |
| PERC-LIDAR-OBS-003 | システムは、≥0.1m高さ、≥0.05m直径の障害物を検出しなければならない | Critical | 障害物テスト |
| PERC-LIDAR-OBS-004 | システムは、最大15m範囲の障害物を検出しなければならない | High | フィールドテスト |
| PERC-LIDAR-OBS-005 | システムは、最低10 Hzで障害物検出を更新しなければならない | Critical | パフォーマンステスト |
| PERC-LIDAR-OBS-006 | システムは、/occupancy_gridトピックに占有グリッドを公開しなければならない | Critical | トピック検査 |
| PERC-LIDAR-OBS-007 | システムは、処理にPCL（Point Cloud Library）を使用しなければならない（CPUのみ） | Critical | アーキテクチャレビュー |
| PERC-LIDAR-OBS-008 | システムは、ディープラーニングまたはGPU処理を使用してはならない | Critical | アーキテクチャレビュー |

**要件合計: 8**

---

### 2.4 占有グリッド生成（PERC-LIDAR-GRID）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-LIDAR-GRID-001 | システムは、フィルタリングされたポイントクラウドから2D占有グリッドを生成しなければならない | Critical | 統合テスト |
| PERC-LIDAR-GRID-002 | 占有グリッドは、0.05m（5cmセル）の解像度を持たなければならない | High | 設定 |
| PERC-LIDAR-GRID-003 | 占有グリッドは、30m × 30m（ロボット中心）のサイズを持たなければならない | High | 設定 |
| PERC-LIDAR-GRID-004 | 占有は、バイナリでなければならない: FREE（0）またはOCCUPIED（100） | Critical | 設定 |
| PERC-LIDAR-GRID-005 | システムは、最低5 Hzで占有グリッドを更新しなければならない | High | パフォーマンステスト |
| PERC-LIDAR-GRID-006 | システムは、最近の観測がないセルをクリアしなければならない（減衰率1 Hz） | Medium | 統合テスト |
| PERC-LIDAR-GRID-007 | システムは、/occupancy_gridトピックに占有グリッドを公開しなければならない（nav_msgs/OccupancyGrid） | Critical | トピック検査 |

**要件合計: 7**

---

### 2.5 コストマップ生成（PERC-LIDAR-COST）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-LIDAR-COST-001 | システムは、Nav2用の占有グリッドからコストマップを生成しなければならない | Critical | 統合テスト |
| PERC-LIDAR-COST-002 | システムは、膨張半径0.5m（ロボット + 安全マージン）を使用しなければならない | Critical | 設定 |
| PERC-LIDAR-COST-003 | システムは、障害物をLETHAL（コスト254）としてマークしなければならない | Critical | 設定 |
| PERC-LIDAR-COST-004 | システムは、グラデーション膨張（距離とともにコストが減少）を使用しなければならない | High | 設定 |
| PERC-LIDAR-COST-005 | システムは、最低5 Hzでコストマップを更新しなければならない | Critical | パフォーマンステスト |
| PERC-LIDAR-COST-006 | システムは、/local_costmapトピックにコストマップを公開しなければならない | Critical | トピック検査 |

**要件合計: 6**

---

## 3. カメラ処理要件

### 3.1 カメラ取得（PERC-CAM-ACQ）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-CAM-ACQ-001 | システムは、2×RGBカメラ（前左、前右）を使用しなければならない | Critical | ハードウェア検査 |
| PERC-CAM-ACQ-002 | カメラは、最低1920×1080解像度を提供しなければならない | Critical | データシート |
| PERC-CAM-ACQ-003 | カメラは、最低30 FPSで動作しなければならない | Critical | データシート |
| PERC-CAM-ACQ-004 | カメラは、≥90°水平視野を持たなければならない | High | データシート |
| PERC-CAM-ACQ-005 | カメラは、IP66+防水またはハウジングを持たなければならない | Critical | データシート |
| PERC-CAM-ACQ-006 | システムは、/camera_X/image_rawトピックに画像を公開しなければならない | Critical | トピック検査 |
| PERC-CAM-ACQ-007 | システムは、/camera_X/camera_infoトピックにcamera_infoを公開しなければならない | Critical | トピック検査 |

**要件合計: 7**

---

### 3.2 カメラキャリブレーション（PERC-CAM-CAL）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-CAM-CAL-001 | システムは、カメラ内部パラメーター（K行列、歪み）をキャリブレーションしなければならない | Critical | キャリブレーション手順 |
| PERC-CAM-CAL-002 | システムは、カメラ外部パラメーター（camera → base_link TF）をキャリブレーションしなければならない | Critical | キャリブレーション手順 |
| PERC-CAM-CAL-003 | システムは、<1ピクセルRMSのキャリブレーション精度を維持しなければならない | High | キャリブレーションテスト |
| PERC-CAM-CAL-004 | システムは、起動時にキャリブレーションを検証しなければならない | High | 統合テスト |
| PERC-CAM-CAL-005 | システムは、キャリブレーションパラメーターをYAMLファイルに保存しなければならない | High | 設定 |
| PERC-CAM-CAL-006 | システムは、再コンパイルなしでキャリブレーション再実行をサポートしなければならない | Medium | 統合テスト |

**要件合計: 6**

---

### 3.3 画像処理（PERC-CAM-PROC）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-CAM-PROC-001 | システムは、カメラキャリブレーションを使用して画像を補正しなければならない | High | 統合テスト |
| PERC-CAM-PROC-002 | システムは、ロギング用の画像圧縮（JPEG、PNG）をサポートしなければならない | Medium | 設定 |
| PERC-CAM-PROC-003 | システムは、画像とLiDARタイムスタンプを同期しなければならない（±50ms） | High | 統合テスト |
| PERC-CAM-PROC-004 | システムは、/camera_X/image_rectトピックに補正画像を公開しなければならない | Medium | トピック検査 |

**要件合計: 4**

---

## 4. IMU処理要件

### 4.1 IMU取得（PERC-IMU-ACQ）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-IMU-ACQ-001 | システムは、9-DOF IMU（加速度計 + ジャイロスコープ + 磁力計）を使用しなければならない | Critical | ハードウェア検査 |
| PERC-IMU-ACQ-002 | IMUは、最低50 Hzで動作しなければならない | Critical | パフォーマンステスト |
| PERC-IMU-ACQ-003 | IMUは、<0.5°姿勢精度を持たなければならない | High | キャリブレーションテスト |
| PERC-IMU-ACQ-004 | システムは、/imu/dataトピックにIMUデータを公開しなければならない（sensor_msgs/Imu） | Critical | トピック検査 |
| PERC-IMU-ACQ-005 | システムは、安全クリティカルな傾斜検出用に冗長IMUを提供しなければならない | High | ハードウェア検査 |

**要件合計: 5**

---

### 4.2 IMU処理（PERC-IMU-PROC）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-IMU-PROC-001 | システムは、IMUから姿勢（ロール、ピッチ、ヨー）を計算しなければならない | Critical | 統合テスト |
| PERC-IMU-PROC-002 | システムは、50 Hzで傾斜（ロール、ピッチ）を検出しなければならない | Critical | パフォーマンステスト |
| PERC-IMU-PROC-003 | システムは、磁気歪み（屋内環境）を補償しなければならない | Medium | フィールドテスト |
| PERC-IMU-PROC-004 | システムは、相補フィルターまたはカルマンフィルターを使用してIMUノイズをフィルタリングしなければならない | High | 統合テスト |
| PERC-IMU-PROC-005 | システムは、/imu/filteredトピックにフィルタリングされた姿勢を公開しなければならない | High | トピック検査 |

**要件合計: 5**

---

## 5. センサーフュージョン要件

### 5.1 マルチセンサー統合（PERC-FUSION-INT）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-FUSION-INT-001 | システムは、LiDAR + IMU + ホイールオドメトリを融合しなければならない | Critical | 統合テスト |
| PERC-FUSION-INT-002 | システムは、タイムスタンプを使用してセンサーデータを同期しなければならない | Critical | 統合テスト |
| PERC-FUSION-INT-003 | システムは、異なるレートのセンサーデータを処理しなければならない（LiDAR 10 Hz、IMU 50 Hz） | Critical | 統合テスト |
| PERC-FUSION-INT-004 | システムは、時間的アライメントのためにセンサーデータをバッファリングしなければならない（±100ms） | High | 統合テスト |
| PERC-FUSION-INT-005 | システムは、外れ値センサー読み取りを検出して拒否しなければならない | High | 故障注入テスト |

**要件合計: 5**

---

### 5.2 TF2変換（PERC-FUSION-TF）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-FUSION-TF-001 | システムは、すべてのセンサーフレームのTF2変換を公開しなければならない | Critical | TF検査 |
| PERC-FUSION-TF-002 | システムは、base_link → lidar_link変換を定義しなければならない | Critical | TFツリー |
| PERC-FUSION-TF-003 | システムは、base_link → camera_X_link変換を定義しなければならない | Critical | TFツリー |
| PERC-FUSION-TF-004 | システムは、base_link → imu_link変換を定義しなければならない | Critical | TFツリー |
| PERC-FUSION-TF-005 | システムは、最低50 Hzで変換を公開しなければならない | Critical | パフォーマンステスト |
| PERC-FUSION-TF-006 | システムは、起動時にTFツリーの完全性を検証しなければならない | High | 統合テスト |

**要件合計: 6**

---

### 5.3 ポイントクラウドマージ（PERC-FUSION-MERGE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-FUSION-MERGE-001 | システムは、複数のLiDARセンサーをサポートしなければならない（設定された場合） | Medium | 設定 |
| PERC-FUSION-MERGE-002 | システムは、共通フレーム（base_link）でポイントクラウドをマージしなければならない | Medium | 統合テスト |
| PERC-FUSION-MERGE-003 | システムは、マージされたクラウド内の重複ポイントを除去しなければならない | Low | 統合テスト |
| PERC-FUSION-MERGE-004 | システムは、/points_mergedトピックにマージされたポイントクラウドを公開しなければならない | Medium | トピック検査 |

**要件合計: 4**

---

## 6. パフォーマンス要件

### 6.1 処理レイテンシ（PERC-PERF-LAT）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-PERF-LAT-001 | LiDAR処理は、<100msのエンドツーエンドレイテンシを持たなければならない | Critical | レイテンシテスト |
| PERC-PERF-LAT-002 | カメラ処理は、<100msのエンドツーエンドレイテンシを持たなければならない | High | レイテンシテスト |
| PERC-PERF-LAT-003 | IMU処理は、<20msのエンドツーエンドレイテンシを持たなければならない | Critical | レイテンシテスト |
| PERC-PERF-LAT-004 | 占有グリッド生成は、<50msのレイテンシを持たなければならない | High | レイテンシテスト |
| PERC-PERF-LAT-005 | コストマップ生成は、<50msのレイテンシを持たなければならない | Critical | レイテンシテスト |

**要件合計: 5**

---

### 6.2 CPUとメモリ使用量（PERC-PERF-COMP）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-PERF-COMP-001 | LiDAR処理は、<20% CPUを使用しなければならない | High | リソース監視 |
| PERC-PERF-COMP-002 | カメラ処理は、<10% CPUを使用しなければならない | High | リソース監視 |
| PERC-PERF-COMP-003 | IMU処理は、<5% CPUを使用しなければならない | Medium | リソース監視 |
| PERC-PERF-COMP-004 | パーセプションサブシステムは、<3GB RAMを使用しなければならない | High | リソース監視 |
| PERC-PERF-COMP-005 | システムは、パーセプション処理にGPUを使用してはならない | Critical | アーキテクチャレビュー |

**要件合計: 5**

---

### 6.3 データレート（PERC-PERF-RATE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-PERF-RATE-001 | LiDARデータレートは、最低10 Hzでなければならない | Critical | パフォーマンステスト |
| PERC-PERF-RATE-002 | カメラデータレートは、最低30 Hzでなければならない | Critical | パフォーマンステスト |
| PERC-PERF-RATE-003 | IMUデータレートは、最低50 Hzでなければならない | Critical | パフォーマンステスト |
| PERC-PERF-RATE-004 | 占有グリッド更新レートは、最低5 Hzでなければならない | High | パフォーマンステスト |
| PERC-PERF-RATE-005 | コストマップ更新レートは、最低5 Hzでなければならない | Critical | パフォーマンステスト |

**要件合計: 5**

---

## 7. 環境要件

### 7.1 屋外動作条件（PERC-ENV-OUTDOOR）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-ENV-OUTDOOR-001 | LiDARは、日光下（1,000-100,000ルクス）で動作しなければならない | Critical | フィールドテスト |
| PERC-ENV-OUTDOOR-002 | LiDARは、夜間（<10ルクス）で動作しなければならない | High | 夜間テスト |
| PERC-ENV-OUTDOOR-003 | LiDARは、小雨（<2.5mm/hr）で動作しなければならない | High | 雨チャンバーテスト |
| PERC-ENV-OUTDOOR-004 | LiDARは、-10°C〜+45°Cの温度で動作しなければならない | High | 気候チャンバー |
| PERC-ENV-OUTDOOR-005 | カメラは、直射日光のグレアを処理しなければならない（自動露出） | High | フィールドテスト |
| PERC-ENV-OUTDOOR-006 | カメラは、アクティブLED照明を使用して夜間動作しなければならない | High | 夜間テスト |

**要件合計: 6**

---

### 7.2 屋内動作条件（PERC-ENV-INDOOR）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-ENV-INDOOR-001 | LiDARは、屋内照明（200-1,000ルクス）で動作しなければならない | High | 屋内テスト |
| PERC-ENV-INDOOR-002 | LiDARは、ガラスと反射面を処理しなければならない | Medium | 屋内テスト |
| PERC-ENV-INDOOR-003 | IMUは、屋内の磁気歪みを補償しなければならない | Medium | 屋内テスト |

**要件合計: 3**

---

## 8. 統合要件

### 8.1 Nav2統合（PERC-INT-NAV）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-INT-NAV-001 | システムは、Nav2ローカルプランナー用のコストマップを公開しなければならない | Critical | 統合テスト |
| PERC-INT-NAV-002 | システムは、衝突チェック用の障害物データを公開しなければならない | Critical | 統合テスト |
| PERC-INT-NAV-003 | システムは、Nav2コストマップレイヤー設定を尊重しなければならない | High | 設定テスト |
| PERC-INT-NAV-004 | システムは、Nav2コストマップクリア/リセットサービスをサポートしなければならない | Medium | 統合テスト |

**要件合計: 4**

---

### 8.2 ローカライゼーション統合（PERC-INT-LOC）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-INT-LOC-001 | システムは、NDTローカライゼーション用のポイントクラウドを公開しなければならない | Critical | 統合テスト |
| PERC-INT-LOC-002 | システムは、姿勢推定用のIMUデータを公開しなければならない | Critical | 統合テスト |
| PERC-INT-LOC-003 | システムは、センサーフュージョン用のホイールオドメトリを公開しなければならない | Critical | 統合テスト |

**要件合計: 3**

---

### 8.3 ドッキング統合（PERC-INT-DOCK）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-INT-DOCK-001 | システムは、ArUco検出用のカメラ画像を公開しなければならない | Critical | 統合テスト |
| PERC-INT-DOCK-002 | システムは、ArUco姿勢推定用のcamera_infoを公開しなければならない | Critical | 統合テスト |
| PERC-INT-DOCK-003 | システムは、ドッキング中にカメラフレームレートを維持しなければならない | High | パフォーマンステスト |

**要件合計: 3**

---

## 9. テストと検証

### 9.1 ユニットテスト（PERC-TEST-UNIT）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-TEST-UNIT-001 | ポイントクラウドフィルタリングは、>85%ユニットテストカバレッジを持たなければならない | High | コードカバレッジ |
| PERC-TEST-UNIT-002 | 障害物検出は、>80%ユニットテストカバレッジを持たなければならない | High | コードカバレッジ |
| PERC-TEST-UNIT-003 | IMU処理は、>85%ユニットテストカバレッジを持たなければならない | High | コードカバレッジ |

**要件合計: 3**

---

### 9.2 統合テスト（PERC-TEST-INT）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| PERC-TEST-INT-001 | システムは、100のフィールドテストシナリオで障害物を検出しなければならない | Critical | フィールドテスト |
| PERC-TEST-INT-002 | システムは、20の雨シナリオ（<2.5mm/hr）で動作しなければならない | High | 雨テスト |
| PERC-TEST-INT-003 | システムは、20の夜間シナリオで動作しなければならない | High | 夜間テスト |
| PERC-TEST-INT-004 | システムは、20のセンサー故障シナリオを処理しなければならない | High | 故障注入テスト |

**要件合計: 4**

---

### 9.3 受け入れ基準（PERC-TEST-ACCEPT）

| 基準 | 目標 | MVP目標 | 検証方法 |
|-----------|--------|------------|------------|
| 障害物検出率 | >99% | >95% | 1000障害物 |
| LiDAR処理レイテンシ | <100ms | <150ms | レイテンシテスト |
| カメラ処理レイテンシ | <100ms | <150ms | レイテンシテスト |
| IMU処理レイテンシ | <20ms | <30ms | レイテンシテスト |
| CPU使用量（パーセプション） | <35% | <50% | リソース監視 |
| 誤検出率 | <5% | <10% | 1000シナリオ |

---

## 10. 要件サマリー

### カテゴリー別要件数

| カテゴリー | 要件合計 | Critical | High | Medium | Low |
|----------|-------------------|----------|------|--------|-----|
| **3D LiDAR** | **36** | 23 | 11 | 2 | 0 |
| - 取得 | 8 | 6 | 2 | 0 | 0 |
| - フィルタリング | 7 | 4 | 2 | 1 | 0 |
| - 障害物検出 | 8 | 7 | 1 | 0 | 0 |
| - 占有グリッド | 7 | 3 | 3 | 1 | 0 |
| - コストマップ | 6 | 5 | 1 | 0 | 0 |
| **カメラ** | **17** | 10 | 5 | 2 | 0 |
| - 取得 | 7 | 6 | 1 | 0 | 0 |
| - キャリブレーション | 6 | 3 | 3 | 0 | 0 |
| - 処理 | 4 | 1 | 1 | 2 | 0 |
| **IMU** | **10** | 5 | 4 | 1 | 0 |
| - 取得 | 5 | 3 | 2 | 0 | 0 |
| - 処理 | 5 | 2 | 2 | 1 | 0 |
| **センサーフュージョン** | **15** | 10 | 5 | 0 | 0 |
| - マルチセンサー | 5 | 3 | 2 | 0 | 0 |
| - TF2変換 | 6 | 5 | 1 | 0 | 0 |
| - ポイントクラウドマージ | 4 | 0 | 2 | 1 | 1 |
| **パフォーマンス** | **15** | 6 | 7 | 2 | 0 |
| - レイテンシ | 5 | 3 | 2 | 0 | 0 |
| - CPUとメモリ | 5 | 2 | 2 | 1 | 0 |
| - データレート | 5 | 3 | 1 | 0 | 0 |
| **環境** | **9** | 2 | 6 | 1 | 0 |
| - 屋外 | 6 | 2 | 4 | 0 | 0 |
| - 屋内 | 3 | 0 | 1 | 2 | 0 |
| **統合** | **10** | 7 | 3 | 0 | 0 |
| - Nav2 | 4 | 3 | 1 | 0 | 0 |
| - ローカライゼーション | 3 | 3 | 0 | 0 | 0 |
| - ドッキング | 3 | 2 | 1 | 0 | 0 |
| **テスト** | **7** | 1 | 6 | 0 | 0 |
| - ユニットテスト | 3 | 0 | 3 | 0 | 0 |
| - 統合 | 4 | 1 | 3 | 0 | 0 |
| **合計** | **119** | **64 (54%)** | **47 (39%)** | **8 (7%)** | **0 (0%)** |

**優先度分布:**
- **Critical（64要件、54%）**: コアパーセプション機能、これらなしではシステムは環境を認識できない
- **High（47要件、39%）**: 信頼性と堅牢性に重要
- **Medium（8要件、7%）**: あると良い最適化
- **Low（0要件、0%）**: パーセプションサブシステムにはN/A

---

## 11. 受け入れ基準

### 11.1 最小実用製品（MVP）

**MVP定義:** 信頼性のあるバイナリ障害物検出、LiDAR + カメラ + IMU動作、<150msレイテンシ。

**MVP要件:**
- ✅ すべてのCritical要件（64合計）を満たす必要あり
- ✅ バイナリ障害物検出を備えた3D LiDARが動作
- ✅ ArUco検出用の2×RGBカメラが動作
- ✅ 傾斜検出用の9-DOF IMUが動作
- ✅ >95%障害物検出率（1000テストケース）
- ✅ <150ms LiDAR処理レイテンシ
- ✅ <50% CPU使用量（パーセプションサブシステム）
- ✅ 屋外日光下での動作

**MVP除外:**
- 夜間動作（日光を要求可能）
- 雨天動作（乾燥条件を要求可能）
- 屋内反射面処理

---

### 11.2 本番準備完了

**本番定義:** 堅牢、全天候、24/7パーセプション、すべてのcritical + high要件を満たす。

**本番要件:**
- ✅ すべてのCritical（64）+ すべてのHigh（47）要件を満たす = 111合計
- ✅ >99%障害物検出率（10,000テストケース）
- ✅ <100ms LiDAR処理レイテンシ
- ✅ <35% CPU使用量（パーセプションサブシステム）
- ✅ アクティブ照明を使用した夜間動作
- ✅ 小雨動作（<2.5mm/hr）
- ✅ 屋内反射面処理
- ✅ <5%誤検出率
- ✅ 1000時間MTBF（平均故障間隔）

---

## 12. トレーサビリティ

### 12.1 親要件トレーサビリティ

この文書は、以下から要件を導出します:

**SYSTEM_REQUIREMENTS.md（PERC-REQ）:**
| システム要件 | 導出されたパーセプション要件 | ステータス |
|--------------------|------------------------------|--------|
| PERC-REQ-001（3D LiDAR 360°） | PERC-LIDAR-ACQ-002 | トレース済み |
| PERC-REQ-002（バイナリ障害物） | PERC-LIDAR-OBS-001〜008 | トレース済み |
| PERC-REQ-003（ディープラーニングなし） | PERC-LIDAR-OBS-008、PERC-PERF-COMP-005 | トレース済み |
| PERC-REQ-004（2×RGBカメラ） | PERC-CAM-ACQ-001 | トレース済み |
| PERC-REQ-005（9-DOF IMU） | PERC-IMU-ACQ-001 | トレース済み |
| PERC-REQ-006（PCL処理） | PERC-LIDAR-OBS-007 | トレース済み |
| PERC-REQ-007（占有グリッド） | PERC-LIDAR-GRID-001〜007 | トレース済み |
| PERC-REQ-008（Nav2用コストマップ） | PERC-LIDAR-COST-001〜006 | トレース済み |

**すべてのシステムレベルパーセプション要件がサブシステム要件にトレースされました。** ✅

---

## 13. 変更履歴

| バージョン | 日付 | 著者 | 変更内容 |
|---------|------|--------|---------|
| 1.0 | 2025-12-15 | Perception Lead | ParcelPalバイナリ障害物検出アーキテクチャに基づく初期パーセプション要件 |

---

**文書ステータス:** ドラフト
**次回レビュー:** LiDAR選択とPCLパイプライン実装後
**必要な承認:** Perception Lead、System Architect、Navigation Lead

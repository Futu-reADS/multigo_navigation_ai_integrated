# スワーブドライブシステム要件

**プロジェクト:** 屋外優先車椅子輸送ロボット（スワーブドライブ搭載）
**文書タイプ:** サブシステム要件仕様
**ステータス:** ドラフト v1.0
**日付:** 2025年12月15日
**親文書:** SYSTEM_REQUIREMENTS.md

---

## 文書目的

この文書は、車椅子輸送ロボットの全方向移動性を提供するスワーブドライブサブシステムの完全な要件を規定します。スワーブドライブは、ゼロ半径回転、横移動、斜め移動を可能にし、制約のある環境での精密な車椅子ドッキングに不可欠な機能を提供します。

---

## 1. 概要

### 1.1 サブシステム説明

スワーブドライブシステムは、それぞれ独立してステアリングと駆動が可能な4つの独立したホイールモジュールで構成されています。この構成は以下を提供します:
- 全方向移動（前進、後進、横移動、斜め）
- ゼロ半径回転（その場回転）
- メカナムホイールと比較した優れた屋外性能
- ドッキング操作のための精密位置制御

### 1.2 主要機能

| 機能 | 仕様 | 重要度 |
|------------|--------------|------------|
| 最大直線速度 | 1.5 m/s（乗客なし）、1.0 m/s（乗客あり） | Critical |
| 最大角速度 | 1.0 rad/s（57°/s） | High |
| 最大勾配 | 10°（17.6%勾配）、100kg荷重時 | Critical |
| 位置精度 | ±10mm、低速時（<0.2 m/s） | High |
| ゼロ半径回転 | その場回転（0m回転半径） | Critical |

---

## 2. 機能要件

### 2.1 モーション制御（SWERVE-MC）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-MC-001 | システムは全方向移動（vx、vy、ω）をサポートすること | Critical | 統合試験 |
| SWERVE-MC-002 | システムはゼロ半径回転（その場回転）を実行すること | Critical | 単体試験 |
| SWERVE-MC-003 | システムは前進/後進移動をサポートすること | Critical | 単体試験 |
| SWERVE-MC-004 | システムは横移動（左/右）をサポートすること | Critical | ドッキング試験 |
| SWERVE-MC-005 | システムは斜め移動をサポートすること | High | 統合試験 |
| SWERVE-MC-006 | システムは4モジュールすべての逆運動学を計算すること | Critical | 単体試験 |
| SWERVE-MC-007 | システムはホイールステアリングと駆動モーターを協調制御すること | Critical | 統合試験 |
| SWERVE-MC-008 | システムは最低20Hzで速度コマンド更新を処理すること | Critical | パフォーマンス試験 |
| SWERVE-MC-009 | システムは移動遷移を滑らかにブレンドすること | High | 快適性試験 |
| SWERVE-MC-010 | システムは設定された最大値（デフォルト0.5 m/s²）まで加速度を制限すること | Critical | 安全試験 |

**成功基準:** すべての方向での滑らかな全方向移動、速度追従誤差<5%

---

### 2.2 逆運動学（SWERVE-IK）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-IK-001 | システムは車体速度（vx、vy、ω）からホイール速度を計算すること | Critical | 単体試験 |
| SWERVE-IK-002 | システムは車体速度からホイール角度を計算すること | Critical | 単体試験 |
| SWERVE-IK-003 | システムは特異点（ゼロ速度コマンド）を処理すること | High | エッジケース試験 |
| SWERVE-IK-004 | システムはモーター制限を尊重するためにホイール速度を正規化すること | Critical | 安全試験 |
| SWERVE-IK-005 | システムは回転を最小化するためにホイール方向を最適化すること | High | パフォーマンス試験 |
| SWERVE-IK-006 | システムは最低50HzでIK計算を更新すること | Critical | パフォーマンス試験 |
| SWERVE-IK-007 | システムはホイールエンコーダーから正確なオドメトリを提供すること | High | 統合試験 |

**成功基準:** IK計算が1ms以内に完了、理論値との精度±1%

---

### 2.3 ホイールモジュール制御（SWERVE-WM）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-WM-001 | 各モジュールはステアリング角を独立制御すること | Critical | 単体試験 |
| SWERVE-WM-002 | 各モジュールは駆動速度を独立制御すること | Critical | 単体試験 |
| SWERVE-WM-003 | ステアリング角範囲は±180°（連続回転）であること | High | ハードウェア試験 |
| SWERVE-WM-004 | ステアリング角精度は±2°であること | High | キャリブレーション試験 |
| SWERVE-WM-005 | 駆動速度精度はコマンド速度の±5%であること | High | パフォーマンス試験 |
| SWERVE-WM-006 | モジュールは最低100Hzでエンコーダーフィードバックを報告すること | Critical | パフォーマンス試験 |
| SWERVE-WM-007 | モジュールは180°ステアリングせずに逆方向を処理すること | High | 効率試験 |
| SWERVE-WM-008 | モジュールは機械的制限に対して保護すること | Critical | 安全試験 |

**成功基準:** 4モジュールすべてが許容範囲内でコマンド位置を達成、応答時間<50ms

---

### 2.4 Nav2統合（SWERVE-NAV）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-NAV-001 | システムはNav2コントローラープラグインインターフェースを実装すること | Critical | 統合試験 |
| SWERVE-NAV-002 | システムはNav2ローカルプランナーからTwistコマンドを受け取ること | Critical | 統合試験 |
| SWERVE-NAV-003 | システムは/odomトピックにオドメトリをパブリッシュすること | Critical | 統合試験 |
| SWERVE-NAV-004 | システムはTF変換（odom → base_link）をパブリッシュすること | Critical | 統合試験 |
| SWERVE-NAV-005 | システムはパラメータの動的再構成をサポートすること | High | 統合試験 |
| SWERVE-NAV-006 | システムは緊急停止コマンドを処理すること（<100ms） | Critical | 安全試験 |
| SWERVE-NAV-007 | システムはROS 2診断経由で診断ステータスを提供すること | High | 統合試験 |

**成功基準:** Nav2スタックとのシームレスな統合、ロボットが計画経路に従う、誤差<10cm

---

## 3. パフォーマンス要件

### 3.1 速度と加速度（SWERVE-PERF-SPEED）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-PERF-001 | 最大直線速度は1.5 m/s（乗客なし）であること | Critical | フィールド試験 |
| SWERVE-PERF-002 | 最大直線速度は1.0 m/s（乗客あり）であること | Critical | 安全試験 |
| SWERVE-PERF-003 | 最大角速度は1.0 rad/sであること | High | フィールド試験 |
| SWERVE-PERF-004 | 最大直線加速度は0.5 m/s²（乗客あり）であること | Critical | 快適性試験 |
| SWERVE-PERF-005 | 最大直線加速度は1.0 m/s²（乗客なし）であること | High | フィールド試験 |
| SWERVE-PERF-006 | 最大角加速度は0.5 rad/s²であること | High | 快適性試験 |
| SWERVE-PERF-007 | ゼロ半径回転速度は≥30°/sであること | High | 操縦性試験 |

**成功基準:** すべての速度/加速度制限が強制され、滑らかなモーションプロファイル

---

### 3.2 精密度と精度（SWERVE-PERF-ACC）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-PERF-008 | 位置精度は速度<0.2 m/s時に±10mmであること | High | ドッキング試験 |
| SWERVE-PERF-009 | 方位精度は速度<0.2 m/s時に±2°であること | High | ドッキング試験 |
| SWERVE-PERF-010 | 速度追従誤差はコマンド速度の<5%であること | High | パフォーマンス試験 |
| SWERVE-PERF-011 | オドメトリドリフトは100m走行で<2%であること | High | フィールド試験 |
| SWERVE-PERF-012 | 再現性は同じモーションコマンドで±5mmであること | Medium | 精密試験 |

**成功基準:** ±2-5mmドッキング精度に十分な精密度（ビジュアルサーボイングと組み合わせた場合）

---

### 3.3 応答時間（SWERVE-PERF-TIME）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-PERF-013 | コントローラーは最低20Hzでcmd_velを処理すること | Critical | パフォーマンス試験 |
| SWERVE-PERF-014 | IK計算は<1msで完了すること | Critical | パフォーマンス試験 |
| SWERVE-PERF-015 | 緊急停止は<100msで起動すること | Critical | 安全試験 |
| SWERVE-PERF-016 | ホイールモジュール応答時間は<50msであること | High | ハードウェア試験 |
| SWERVE-PERF-017 | オドメトリパブリッシュレートは最低50Hzであること | High | 統合試験 |

**成功基準:** すべての動作条件下でリアルタイムパフォーマンスを維持

---

## 4. ハードウェア要件

### 4.1 ホイールモジュール（SWERVE-HW-MODULE）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-HW-001 | システムは4つの独立したスワーブドライブモジュールを使用すること | Critical | 設計レビュー |
| SWERVE-HW-002 | 各モジュールは6.5"（φ165mm）ホバーボードインホイールモーターを使用すること | Critical | ハードウェア仕様 |
| SWERVE-HW-003 | 駆動モーター出力はホイールあたり≥80Wであること | Critical | ハードウェア仕様 |
| SWERVE-HW-004 | ステアリングモータートルクは100kg荷重に十分であること | Critical | 負荷試験 |
| SWERVE-HW-005 | ホイールモジュールは長方形配置であること | Critical | 設計レビュー |
| SWERVE-HW-006 | ホイールベース（L）は0.6m ±0.05mであること | High | ハードウェア仕様 |
| SWERVE-HW-007 | トレッド幅（W）は0.5m ±0.05mであること | High | ハードウェア仕様 |

**成功基準:** 定格荷重下ですべてのパフォーマンス要件を満たせるハードウェア

---

### 4.2 センサー（SWERVE-HW-SENSOR）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-HW-008 | 各駆動モーターはエンコーダーを持つこと（分解能≥1000 CPR） | Critical | ハードウェア仕様 |
| SWERVE-HW-009 | 各ステアリングモーターはエンコーダーを持つこと（分解能≥1000 CPR） | Critical | ハードウェア仕様 |
| SWERVE-HW-010 | システムは方向/傾斜センシング用IMUを含むこと | Critical | ハードウェア仕様 |
| SWERVE-HW-011 | エンコーダーは最低100Hzでフィードバックを提供すること | Critical | パフォーマンス試験 |
| SWERVE-HW-012 | IMUは最低100Hzでデータを提供すること | High | パフォーマンス試験 |

**成功基準:** すべてのセンサーが閉ループ制御のための正確で高周波なフィードバックを提供

---

### 4.3 モーターコントローラー（SWERVE-HW-CTRL）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-HW-013 | 駆動モーターコントローラーは速度制御をサポートすること | Critical | ハードウェア仕様 |
| SWERVE-HW-014 | ステアリングモーターコントローラーは位置制御をサポートすること | Critical | ハードウェア仕様 |
| SWERVE-HW-015 | コントローラーは過電流保護を持つこと | Critical | 安全試験 |
| SWERVE-HW-016 | コントローラーは熱保護を持つこと | Critical | 安全試験 |
| SWERVE-HW-017 | コントローラーはCANバスまたはシリアル経由で通信すること | High | 統合試験 |
| SWERVE-HW-018 | コントローラー更新レートは最低100Hzであること | High | パフォーマンス試験 |

**成功基準:** 安全保護を備えた信頼性の高いリアルタイムモーター制御を提供するコントローラー

---

## 5. ソフトウェア要件

### 5.1 コントローラー実装（SWERVE-SW-CTRL）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-SW-001 | コントローラーはC++17で実装すること | Critical | コードレビュー |
| SWERVE-SW-002 | コントローラーはROS 2 Humbleを使用すること | Critical | 統合試験 |
| SWERVE-SW-003 | コントローラーはnav2_core::Controllerインターフェースを実装すること | Critical | 統合試験 |
| SWERVE-SW-004 | コントローラーはYAMLパラメータ経由で設定可能であること | High | 統合試験 |
| SWERVE-SW-005 | コントローラーは診断情報をログすること | High | 統合試験 |
| SWERVE-SW-006 | コントローラーはノードライフサイクル（configure/activate/deactivate）を処理すること | High | 統合試験 |

**成功基準:** Nav2とシームレスに統合するコントローラー、標準ROS 2メカニズム経由で設定可能

---

### 5.2 設定パラメータ（SWERVE-SW-CONFIG）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-SW-007 | システムはホイールベースパラメータを公開すること | Critical | 統合試験 |
| SWERVE-SW-008 | システムはトレッド幅パラメータを公開すること | Critical | 統合試験 |
| SWERVE-SW-009 | システムはホイール半径パラメータを公開すること | Critical | 統合試験 |
| SWERVE-SW-010 | システムは最大速度（直線、角）を公開すること | Critical | 安全試験 |
| SWERVE-SW-011 | システムは最大加速度を公開すること | Critical | 安全試験 |
| SWERVE-SW-012 | システムはホイール制御用PIDゲインを公開すること | High | チューニング試験 |
| SWERVE-SW-013 | システムは起動時にパラメータを検証すること | High | 統合試験 |

**成功基準:** すべてのクリティカルパラメータが設定可能、検証済み、文書化済み

---

## 6. 安全要件

### 6.1 運用安全（SWERVE-SAFE-OP）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-SAFE-001 | システムは最大速度制限を強制すること（オーバーライド不可） | Critical | 安全試験 |
| SWERVE-SAFE-002 | システムは最大加速度制限を強制すること | Critical | 安全試験 |
| SWERVE-SAFE-003 | システムは勾配>5°で速度を下げること | Critical | フィールド試験 |
| SWERVE-SAFE-004 | システムは勾配>10°で停止すること | Critical | 安全試験 |
| SWERVE-SAFE-005 | システムはホイールスリップを検出し速度を下げること | High | 安全試験 |
| SWERVE-SAFE-006 | システムはホイールモジュール障害時に動作しないこと | Critical | 障害試験 |
| SWERVE-SAFE-007 | システムは緊急停止機能を提供すること | Critical | 安全試験 |

**成功基準:** 1000回のテストミッションで安全インシデントゼロ

---

### 6.2 障害検出（SWERVE-SAFE-FAULT）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-SAFE-008 | システムはエンコーダー障害を検出すること | Critical | 障害試験 |
| SWERVE-SAFE-009 | システムはモーターコントローラー障害を検出すること | Critical | 障害試験 |
| SWERVE-SAFE-010 | システムは通信タイムアウトを検出すること | Critical | 障害試験 |
| SWERVE-SAFE-011 | システムは異常なモーター電流を検出すること | High | 障害試験 |
| SWERVE-SAFE-012 | システムはROS 2診断経由で障害を報告すること | High | 統合試験 |
| SWERVE-SAFE-013 | システムはクリティカル障害時に安全状態に入ること | Critical | 障害試験 |

**成功基準:** すべてのクリティカル障害が100ms以内に検出され、500ms以内に安全状態達成

---

## 7. 環境要件

### 7.1 動作条件（SWERVE-ENV）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-ENV-001 | システムは平坦な表面（0°勾配）で動作すること | Critical | フィールド試験 |
| SWERVE-ENV-002 | システムは100kg荷重で最大10°勾配で動作すること | Critical | フィールド試験 |
| SWERVE-ENV-003 | システムは芝生、アスファルト、コンクリートで動作すること | Critical | フィールド試験 |
| SWERVE-ENV-004 | システムは±20mm表面凹凸を処理すること | High | フィールド試験 |
| SWERVE-ENV-005 | システムは温度範囲-5°Cから40°Cで動作すること | High | 環境試験 |
| SWERVE-ENV-006 | システムは小雨で動作すること（IP54+モーター） | Critical | 環境試験 |
| SWERVE-ENV-007 | システムは損傷なしに埃/破片を処理すること | High | 環境試験 |

**成功基準:** 指定されたすべての環境条件での信頼性の高い動作

---

## 8. 統合要件

### 8.1 ROS 2統合（SWERVE-INT-ROS）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-INT-001 | システムは/cmd_vel（geometry_msgs/Twist）をサブスクライブすること | Critical | 統合試験 |
| SWERVE-INT-002 | システムは/odom（nav_msgs/Odometry）にパブリッシュすること | Critical | 統合試験 |
| SWERVE-INT-003 | システムはTF変換（odom → base_link）をパブリッシュすること | Critical | 統合試験 |
| SWERVE-INT-004 | システムはジョイント状態（sensor_msgs/JointState）をパブリッシュすること | High | 統合試験 |
| SWERVE-INT-005 | システムは/reset_odometryサービスを提供すること | Medium | 統合試験 |
| SWERVE-INT-006 | システムは診断（diagnostic_msgs/DiagnosticArray）をパブリッシュすること | High | 統合試験 |

**成功基準:** 完全なROS 2統合、標準Nav2スタックとの互換性

---

## 9. テストと検証要件

### 9.1 単体テスト（SWERVE-TEST-UNIT）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-TEST-001 | IK計算は単体テストを持つこと（80%以上カバレッジ） | Critical | CI/CD |
| SWERVE-TEST-002 | オドメトリ計算は単体テストを持つこと | Critical | CI/CD |
| SWERVE-TEST-003 | 設定検証は単体テストを持つこと | High | CI/CD |
| SWERVE-TEST-004 | 安全制限は単体テストを持つこと | Critical | CI/CD |

**成功基準:** 80%以上のコードカバレッジ、すべてのテストがコミットごとにパス

---

### 9.2 統合テスト（SWERVE-TEST-INT）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-TEST-005 | Nav2統合はエンドツーエンドでテストすること | Critical | 統合試験 |
| SWERVE-TEST-006 | すべての移動方向をテストすること | Critical | 統合試験 |
| SWERVE-TEST-007 | オドメトリ精度は100m以上でテストすること | High | 統合試験 |
| SWERVE-TEST-008 | 緊急停止をテストすること | Critical | 安全試験 |

**成功基準:** すべての統合テストがパス、フィールドテストの準備完了

---

### 9.3 フィールドテスト（SWERVE-TEST-FIELD）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-TEST-009 | システムは100km耐久テストを完了すること | High | フィールド試験 |
| SWERVE-TEST-010 | システムはさまざまな地形で動作すること | Critical | フィールド試験 |
| SWERVE-TEST-011 | システムは最大勾配（10°）で動作すること | Critical | フィールド試験 |
| SWERVE-TEST-012 | システムは最大荷重（100kg）で動作すること | Critical | 負荷試験 |

**成功基準:** フィールドテスト中に>98%アップタイム、安全インシデントゼロ

---

## 10. 文書化要件

### 10.1 技術文書（SWERVE-DOC）

| ID | 要件 | 優先度 | 検証方法 |
|----|-------------|----------|------------|
| SWERVE-DOC-001 | IK方程式を文書化すること | Critical | 文書レビュー |
| SWERVE-DOC-002 | 設定パラメータを文書化すること | Critical | 文書レビュー |
| SWERVE-DOC-003 | ROS 2インターフェースを文書化すること | Critical | 文書レビュー |
| SWERVE-DOC-004 | キャリブレーション手順を文書化すること | High | 文書レビュー |
| SWERVE-DOC-005 | トラブルシューティングガイドを提供すること | High | 文書レビュー |

**成功基準:** 独立した開発/メンテナンスを可能にする完全な文書化

---

## 11. 要件トレーサビリティ

### 11.1 親要件マッピング

| この文書 | 親（SYSTEM_REQUIREMENTS.md） |
|--------------|--------------------------------|
| SWERVE-MC-* | PERF-001（バッテリー寿命）、NAV-*（ナビゲーション） |
| SWERVE-PERF-* | PERF-001からPERF-008 |
| SWERVE-SAFE-* | SAFE-001からSAFE-014 |
| SWERVE-ENV-* | ENV-001からENV-007 |

### 11.2 依存サブシステム

| サブシステム | 依存関係 | インターフェース |
|-----------|-----------|-----------|
| ナビゲーション | スワーブドライブを必要 | /cmd_velトピック |
| ドッキング | 精密移動を必要 | /cmd_velトピック |
| 安全 | ドライブシステムを監視 | 緊急停止 |
| UI | ドライブステータスを表示 | 診断 |

---

## 12. 受入基準

### 12.1 最小実行可能製品（MVP）

- [ ] すべてのCRITICAL要件を検証
- [ ] ≥80% HIGH要件を検証
- [ ] Nav2統合が機能的
- [ ] 全方向移動が実証済み
- [ ] 緊急停止が機能的
- [ ] 基本フィールドテスト完了（10km）

### 12.2 本番環境対応

- [ ] 100% CRITICAL + HIGH要件を検証
- [ ] ≥50% MEDIUM要件を検証
- [ ] フィールドテスト: 100kmまたは30日間動作
- [ ] 安全インシデントゼロ
- [ ] 顧客受入テストにパス

---

## 13. 未解決項目 / TBD

| 項目 | ステータス | 担当 | 目標日 |
|------|--------|-------|-------------|
| 最終ホイールモジュールハードウェア選定 | TBD | ハードウェアチーム | スプリント3 |
| モーターコントローラー通信プロトコル | TBD | ハードウェアチーム | スプリント3 |
| PIDチューニングパラメータ | TBD | 制御チーム | スプリント4 |
| ホイールベース/トレッド幅最終寸法 | TBD | 機械チーム | スプリント3 |

---

## 14. 関連文書

**親文書:**
- `SYSTEM_REQUIREMENTS.md` - 全体のシステム要件

**関連サブシステム文書:**
- `NAVIGATION_REQUIREMENTS.md` - ナビゲーションサブシステム（スワーブドライブの消費者）
- `DOCKING_SYSTEM_REQUIREMENTS.md` - ドッキングサブシステム（スワーブドライブの消費者）
- `SAFETY_REQUIREMENTS.md` - 安全サブシステム（スワーブドライブを監視）

**アーキテクチャと設計:**
- `SWERVE_DRIVE_ARCHITECTURE.md` - 詳細アーキテクチャ
- `SWERVE_DRIVE_CONTROLLER_DESIGN.md` - コントローラー実装設計

---

**文書ステータス:** ドラフト v1.0
**レビューステータス:** 技術レビュー待ち
**次回レビュー:** スプリント3後（スワーブドライブハードウェア選定後）
**承認者:** システムアーキテクト、制御リード、安全リード
**バージョン履歴:**
- v1.0（2025年12月15日）: 初期スワーブドライブ要件仕様

# 車両UI要件

**プロジェクト:** 屋外車椅子輸送ロボット - マルチチームシステム
**文書タイプ:** 車両要件仕様
**チーム責任:** Pankaj（車両ソフトウェア）
**ステータス:** 週5 - アクティブ開発
**日付:** 2025年12月16日
**バージョン:** 1.0

---

## 文書管理

| バージョン | 日付 | 著者 | 変更内容 |
|---------|------|--------|---------|
| 1.0 | 2025年12月16日 | Pankajチーム | 初期車両UI要件 |

**関連文書:**
- UI_EHMI_REQUIREMENTS.md（外部ディスプレイ、eHMI ESP32）
- EXTERIOR_REQUIREMENTS.md（物理的タッチスクリーンマウント、IP定格）
- FLEET_UI_REQUIREMENTS.md（フリート管理Webダッシュボード）
- SAFETY_REQUIREMENTS.md（緊急停止UI統合）

---

## 1. 目的とスコープ

この文書は、以下の用途のためにロボットに搭載された10.1インチディスプレイである**車載タッチスクリーンUI**の要件を規定します:
- **ローカルステータス監視**（オペレーター、介護者が車両状態をチェック）
- **ミッション制御**（ミッションの開始/停止、目的地の選択）
- **診断**（エラーコード、センサーステータス、ログ）
- **設定**（WiFiセットアップ、車両設定 - 管理者のみ）
- **緊急操作**（手動緊急停止、助けを呼ぶ）

**設計原則:**
- 手袋をつけた高齢ユーザーのための大きなタッチターゲット（最小60mm）
- 高コントラストUI（明るい日光下で読み取り可能）
- シンプルでアイコンベースのインターフェース（テキストを最小化）
- バイリンガルサポート（英語/日本語）

**技術スタック:**
- ディスプレイ: 10.1" 1920×1200 産業用タッチスクリーン（IP65、1000 nits輝度）
- ソフトウェア: Qt 6 C++アプリケーション（ネイティブ、低レイテンシ）
- 通信: 車両ステータス、コマンド用のROS 2トピック

---

## 2. ハードウェア要件

### 2.1 タッチスクリーンディスプレイ仕様

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-HW-001 | 車両は10.1"タッチスクリーンディスプレイを持つこと（1920×1200解像度、16:10アスペクト比） | CRITICAL | ディスプレイがインストールされ機能的 |
| VEH-UI-HW-002 | ディスプレイ輝度は≥1000 nitsであること（直射日光下で読み取り可能） | HIGH | 輝度測定済み |
| VEH-UI-HW-003 | ディスプレイはIP65定格であること（屋外使用のための防水） | CRITICAL | IP65認証確認済み |
| VEH-UI-HW-004 | タッチスクリーンは静電容量式タッチをサポートすること（手袋モード有効） | HIGH | 手袋タッチが機能的 |
| VEH-UI-HW-005 | ディスプレイは光学ボンディングされていること（エアギャップなし）グレアを削減し日光可読性を向上 | MEDIUM | 光学ボンディング確認済み |
| VEH-UI-HW-006 | ディスプレイ視野角は≥170°水平、≥160°垂直であること | MEDIUM | 視野角測定済み |

### 2.2 物理マウント

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-MOUNT-001 | ディスプレイはロボット側面パネルの1200mm高さに取り付けること（立っている大人がアクセス可能） | HIGH | マウント高さ確認済み |
| VEH-UI-MOUNT-002 | ディスプレイは人間工学的視認のため15°上向きに角度をつけること | MEDIUM | 角度測定済み |
| VEH-UI-MOUNT-003 | ディスプレイエンクロージャはゴムガスケットシールを持つこと（IP65保護） | CRITICAL | 防水確認済み |
| VEH-UI-MOUNT-004 | ディスプレイは保護アクリルシールドを持つこと（傷防止、3mm厚） | MEDIUM | シールドインストール済み |

---

## 3. ホーム画面要件

### 3.1 ホーム画面レイアウト

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-HOME-001 | ホーム画面は大きな車両ステータスを表示すること: IDLE、NAVIGATING、DOCKING、TRANSPORTING、CHARGING、ERROR | CRITICAL | ステータスが目立つように表示 |
| VEH-UI-HOME-002 | ホーム画面はパーセンテージ付きバッテリーアイコンを表示すること（色分け: 緑>50%、黄30-50%、赤<30%） | CRITICAL | バッテリー表示が機能的 |
| VEH-UI-HOME-003 | ホーム画面はWiFi信号強度を表示すること（4バーインジケーター） | HIGH | WiFiインジケーターが機能的 |
| VEH-UI-HOME-004 | ホーム画面は現在のミッションを表示すること（アクティブな場合）: "建物Aへの歩行支援" | HIGH | ミッション説明が表示 |
| VEH-UI-HOME-005 | ホーム画面は目的地までのETAを表示すること（残り分数） | MEDIUM | ETA計算と表示 |
| VEH-UI-HOME-006 | ホーム画面は大きなボタンを提供すること: "地図を見る"、"診断"、"設定"、"緊急" | CRITICAL | ナビゲーションボタンが機能的 |

**ホーム画面レイアウト:**
```
┌─────────────────────────────────────────┐
│  車両 VEH-03          🔋 65%  📶 ●●●○│
├─────────────────────────────────────────┤
│                                         │
│          ステータス: IDLE                │
│           (大きく、中央)                 │
│                                         │
│  現在のミッション: なし                   │
│                                         │
├─────────────────────────────────────────┤
│  [📍 地図を見る]     [🔧 診断]          │
│                                         │
│  [⚙️ 設定]          [🚨 緊急]           │
└─────────────────────────────────────────┘
```

### 3.2 ステータスインジケーター

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-STATUS-001 | ステータステキストは大きくすること（最小80mm高さ、太字フォント） | HIGH | テキストサイズ確認済み |
| VEH-UI-STATUS-002 | ステータスは色分けすること: 緑（OK状態）、青（アクティブ）、黄（注意）、赤（エラー） | CRITICAL | 色分け適用済み |
| VEH-UI-STATUS-003 | エラーステータスは簡単なエラーメッセージを含めること（例: "ナビゲーション失敗 - 障害物"） | HIGH | エラーメッセージ表示 |
| VEH-UI-STATUS-004 | ホーム画面は2秒ごとに自動リフレッシュすること（ライブステータス更新） | HIGH | リフレッシュレート確認済み |

---

## 4. マップビュー要件

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-MAP-001 | マップビューは車両位置（赤い矢印）付きの2D占有グリッドマップを表示すること | HIGH | マップが正しく表示 |
| VEH-UI-MAP-002 | マップはミッションがアクティブな場合、現在のナビゲーション経路（青線）を表示すること | HIGH | 経路可視化が機能的 |
| VEH-UI-MAP-003 | マップはピンチズームジェスチャーをサポートすること（ズームイン/アウト） | MEDIUM | ピンチズームが機能的 |
| VEH-UI-MAP-004 | マップは近くの障害物を表示すること（LiDARスキャンオーバーレイ、半透明の赤） | MEDIUM | 障害物オーバーレイが機能的 |
| VEH-UI-MAP-005 | マップビューは"ホームに戻る"ボタンを持つこと（ホーム画面に戻る） | HIGH | ナビゲーションボタンが機能的 |
| VEH-UI-MAP-006 | マップはミッションがアクティブな場合、目的地マーカー（緑の旗アイコン）を表示すること | MEDIUM | 目的地マーカー表示 |

---

## 5. 診断ビュー要件

### 5.1 センサーステータス

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-DIAG-001 | 診断はセンサーステータスグリッドを表示すること: LiDAR、フロントカメラ、リアカメラ、IMU、BMS、モーター | CRITICAL | センサーグリッド表示 |
| VEH-UI-DIAG-002 | 各センサーはステータスアイコンを表示すること: ✅（OK）、⚠️（警告）、❌（失敗） | CRITICAL | ステータスアイコンが正しい |
| VEH-UI-DIAG-003 | センサーをタップすると詳細情報を表示すること: センサー名、データレート、最終更新時刻、エラーコード | HIGH | 詳細ビューが機能的 |
| VEH-UI-DIAG-004 | 診断はモーターコントローラーステータスを表示すること（8コントローラー、温度、電流） | HIGH | モーターステータス表示 |

### 5.2 エラーログ

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-DIAG-LOG-001 | 診断は最近のエラーログを表示すること（最新20エントリー） | HIGH | エラーログ表示 |
| VEH-UI-DIAG-LOG-002 | エラーログエントリーは以下を含めること: タイムスタンプ、深刻度（INFO/WARN/ERROR）、メッセージ | HIGH | ログフィールド完全 |
| VEH-UI-DIAG-LOG-003 | エラーログはスクロールをサポートすること（上/下スワイプ） | MEDIUM | スクロールが機能的 |
| VEH-UI-DIAG-LOG-004 | エラーログは5秒ごとに自動リフレッシュすること | MEDIUM | 自動リフレッシュが機能的 |

### 5.3 システム情報

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-DIAG-SYS-001 | 診断はシステム情報を表示すること: 車両ID、ソフトウェアバージョン、IPアドレス、アップタイム | MEDIUM | システム情報表示 |
| VEH-UI-DIAG-SYS-002 | 診断はリソース使用状況を表示すること: CPU %、メモリ使用率、ディスク使用率 | MEDIUM | リソース使用状況表示 |

---

## 6. 設定ビュー要件

### 6.1 ネットワーク設定

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-SET-NET-001 | 管理者はWiFi SSIDとパスワードを設定できること（オンスクリーンキーボード） | HIGH | WiFi設定が機能的 |
| VEH-UI-SET-NET-002 | 設定は現在のWiFi接続ステータスとIPアドレスを表示すること | HIGH | WiFiステータス表示 |
| VEH-UI-SET-NET-003 | 設定はWiFi接続のテストを許可すること（TVMサーバーにping） | MEDIUM | 接続テストが機能的 |

### 6.2 車両設定

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-SET-VEH-001 | 管理者は車両IDを設定できること（英数字、最大10文字） | MEDIUM | 車両IDが編集可能 |
| VEH-UI-SET-VEH-002 | 管理者は最大速度制限を設定できること（0.5 - 1.5 m/s） | MEDIUM | 速度制限が設定可能 |
| VEH-UI-SET-VEH-003 | 設定はバッテリー健全性を表示すること（SOH %、サイクル数、最終サービス日） | MEDIUM | バッテリー健全性表示 |

### 6.3 ディスプレイ設定

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-SET-DISP-001 | 設定はディスプレイ輝度を調整できること（10% - 100%） | MEDIUM | 輝度調整が機能的 |
| VEH-UI-SET-DISP-002 | 設定は言語選択を許可すること: 英語または日本語 | HIGH | 言語選択が機能的 |
| VEH-UI-SET-DISP-003 | 設定は自動輝度の切り替えを許可すること（環境光に適応） | LOW | 自動輝度トグルが機能的 |

### 6.4 アクセス制御

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-SET-ACCESS-001 | 設定ビューはアクセスに管理者PIN（4桁コード）を要求すること | CRITICAL | PIN保護が強制 |
| VEH-UI-SET-ACCESS-002 | 設定は非アクティブ2分後に自動的にロックすること | HIGH | 自動ロックが機能的 |
| VEH-UI-SET-ACCESS-003 | PIN試行失敗はログされること（セキュリティ監査） | MEDIUM | 失敗試行がログ |

---

## 7. 緊急ビュー要件

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-EMERG-001 | 緊急ビューは大きな"緊急停止"ボタンを表示すること（300mm × 150mm、赤） | CRITICAL | 緊急停止ボタンが目立つ |
| VEH-UI-EMERG-002 | 緊急停止ボタンを押すと即座に車両が停止すること（物理緊急停止ボタンと同じ） | CRITICAL | UI緊急停止が機能的 |
| VEH-UI-EMERG-003 | 緊急ビューは"オペレーターに電話"ボタンを表示すること（音声/ビデオ通話を開始） | HIGH | 通話ボタンが機能的 |
| VEH-UI-EMERG-004 | 緊急ビューは現在のGPS座標を表示すること（緊急サービス用） | MEDIUM | GPS座標表示 |
| VEH-UI-EMERG-005 | 緊急ビューは"緊急キャンセル"ボタンを持つこと（通常動作に復元） | HIGH | 緊急停止解除が機能的 |
| VEH-UI-EMERG-006 | 緊急起動は即座にTVMサーバーにアラートを送信すること | CRITICAL | アラート送信が機能的 |

---

## 8. タッチ操作要件

### 8.1 タッチターゲットとジェスチャー

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-TOUCH-001 | すべてのインタラクティブ要素は最小60mm × 60mmであること（手袋でアクセス可能） | CRITICAL | タッチターゲットサイズ確認済み |
| VEH-UI-TOUCH-002 | タッチターゲットは10mm間隔を持つこと（誤って隣接するプレスを防止） | HIGH | 間隔確認済み |
| VEH-UI-TOUCH-003 | システムは触覚フィードバックを提供すること（ボタンプレスアニメーション、100msハイライト） | MEDIUM | 視覚フィードバックが機能的 |
| VEH-UI-TOUCH-004 | システムはマルチタッチジェスチャーをサポートすること: ピンチズーム、スワイプ | MEDIUM | ジェスチャーが機能的 |
| VEH-UI-TOUCH-005 | タッチ応答レイテンシは<100msであること（即座と認識される） | HIGH | レイテンシ測定済み |

### 8.2 オンスクリーンキーボード

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-KB-001 | システムはテキスト入力用のオンスクリーンキーボードを提供すること（英数字、記号） | HIGH | キーボードが機能的 |
| VEH-UI-KB-002 | キーボードキーは大きいこと（40mm × 40mm最小） | HIGH | キーサイズ確認済み |
| VEH-UI-KB-003 | キーボードは英語と日本語入力をサポートすること（文字切り替え） | HIGH | バイリンガル入力が機能的 |

---

## 9. ビジュアルデザイン要件

### 9.1 カラースキームとコントラスト

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-VISUAL-001 | UIは高コントラスト色を使用すること（WCAG AAA基準で最小7:1コントラスト比） | HIGH | コントラスト比測定済み |
| VEH-UI-VISUAL-002 | UIは暗い背景を使用すること（明るい日光下での目の疲労を軽減） | MEDIUM | ダークテーマ適用済み |
| VEH-UI-VISUAL-003 | ステータス色は一貫していること: 緑=OK、青=アクティブ、黄=注意、赤=エラー | CRITICAL | 色分けが一貫 |
| VEH-UI-VISUAL-004 | テキストはサンセリフフォントであること（RobotoまたはNoto Sans）、最小18pt | HIGH | フォント確認済み |

### 9.2 アイコンとシンボル

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-ICON-001 | UIは国際的に認識されたアイコンを使用すること（該当する場合ISO 7000標準） | MEDIUM | アイコンが直感的 |
| VEH-UI-ICON-002 | クリティカルアイコン（緊急、バッテリー、エラー）は≥40mmサイズであること | HIGH | アイコンサイズ確認済み |
| VEH-UI-ICON-003 | アイコンは下にテキストラベルを持つこと（バイリンガル: 英語/日本語） | HIGH | ラベル存在 |

---

## 10. ローカライゼーションと言語サポート

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-L10N-001 | UIは英語と日本語をサポートすること | CRITICAL | 両言語が機能的 |
| VEH-UI-L10N-002 | 言語は設定ビュー経由で選択可能であること（再起動後も永続） | HIGH | 言語選択が永続的 |
| VEH-UI-L10N-003 | すべてのUIテキストは翻訳ファイルに外部化されること（ハードコードされた文字列なし） | MEDIUM | 翻訳ファイル使用 |
| VEH-UI-L10N-004 | 日付/時刻形式は選択された言語に適応すること（EN: MM/DD/YYYY、JA: YYYY/MM/DD） | MEDIUM | 日付形式がローカライズ |

---

## 11. パフォーマンス要件

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-PERF-001 | UIアプリケーション起動時間は<5秒であること（電源投入からホーム画面まで） | HIGH | 起動時間測定済み |
| VEH-UI-PERF-002 | UIフレームレートは≥30 fpsであること（滑らかなアニメーション） | MEDIUM | フレームレート測定済み |
| VEH-UI-PERF-003 | タッチ入力レイテンシは<100msであること（応答性の高い感覚） | HIGH | レイテンシ測定済み |
| VEH-UI-PERF-004 | UI CPU使用率はJetson Orin Nanoで<20%であること（ナビゲーション用にリソースを残す） | MEDIUM | CPU使用率プロファイル済み |
| VEH-UI-PERF-005 | UIメモリ使用量は<500 MBであること | LOW | メモリ使用量測定済み |

---

## 12. 電源管理

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-PWR-001 | ディスプレイはタッチ入力なし60秒後に30%輝度に暗くなること（省電力） | MEDIUM | 自動暗転が機能的 |
| VEH-UI-PWR-002 | ディスプレイはタッチ入力なし5分後にオフになること（スクリーンセーバー） | MEDIUM | スクリーンセーバーが機能的 |
| VEH-UI-PWR-003 | 画面をタッチすると即座にディスプレイがウェイクアップすること（500ms以内） | HIGH | ウェイクアップが機能的 |
| VEH-UI-PWR-004 | ディスプレイ消費電力は最大輝度で<15Wであること | LOW | 消費電力測定済み |

---

## 13. アクセシビリティ要件

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-A11Y-001 | UIは大きなタッチターゲットをサポートすること（60mm最小、高齢ユーザーに適切） | CRITICAL | タッチターゲットがアクセス可能 |
| VEH-UI-A11Y-002 | UIは大きなフォントを使用すること（最小18pt本文テキスト、32pt見出し） | HIGH | フォントサイズがアクセス可能 |
| VEH-UI-A11Y-003 | UIは音声フィードバックオプションを提供すること（音声ステータス更新） | LOW | 音声フィードバック利用可能 |
| VEH-UI-A11Y-004 | UIは手袋モードをサポートすること（手袋付き静電容量式タッチ） | HIGH | 手袋タッチが機能的 |

---

## 14. 安全と耐障害性

| ID | 要件 | 優先度 | 受入基準 |
|----|-------------|----------|---------------------|
| VEH-UI-SAFE-001 | UIはディスプレイ故障時に車両制御機能を維持すること（例: 外部緊急停止はまだ動作） | CRITICAL | ディスプレイ故障が安全に影響しない |
| VEH-UI-SAFE-002 | UIは点滅する赤い境界線付きクリティカル警告を表示すること（見逃すことが不可能） | CRITICAL | 警告表示が目立つ |
| VEH-UI-SAFE-003 | UIはウォッチドッグタイマーを持つこと（5秒以上フリーズした場合UIアプリを再起動） | HIGH | ウォッチドッグが機能的 |
| VEH-UI-SAFE-004 | UIはセキュリティ監査のためすべてのユーザー操作をログすること（誰が何をいつ押したか） | MEDIUM | 操作ログが機能的 |

---

## 15. 要件サマリー

| カテゴリー | 数 | 優先度内訳 |
|----------|-------|-------------------|
| ハードウェア要件 | 10 | Critical: 4、High: 4、Medium: 2 |
| ホーム画面 | 10 | Critical: 4、High: 5、Medium: 1 |
| マップビュー | 6 | High: 3、Medium: 3 |
| 診断ビュー | 10 | Critical: 2、High: 6、Medium: 2 |
| 設定ビュー | 13 | Critical: 1、High: 4、Medium: 7、Low: 1 |
| 緊急ビュー | 6 | Critical: 3、High: 2、Medium: 1 |
| タッチ操作 | 8 | Critical: 1、High: 5、Medium: 2 |
| ビジュアルデザイン | 7 | Critical: 1、High: 4、Medium: 2 |
| ローカライゼーション | 4 | Critical: 1、High: 1、Medium: 2 |
| パフォーマンス | 5 | High: 2、Medium: 2、Low: 1 |
| 電源管理 | 4 | High: 1、Medium: 2、Low: 1 |
| アクセシビリティ | 4 | Critical: 1、High: 2、Low: 1 |
| 安全と耐障害性 | 4 | Critical: 2、High: 1、Medium: 1 |
| **合計** | **91** | **Critical: 20、High: 40、Medium: 25、Low: 6** |

---

## 16. 車両UIシステムアーキテクチャ

```
┌────────────────────────────────────────────────────┐
│        10.1" タッチスクリーンディスプレイ（Qt 6アプリ）  │
│                                                    │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │  ホーム   │  │ マップ   │  │  診断    │        │
│  │ 画面     │  │ ビュー   │  │ ビュー   │        │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘        │
│       │             │             │               │
│  ┌────┴─────┐  ┌────┴─────┐  ┌────┴─────┐        │
│  │  設定    │  │  緊急    │  │タッチ入力 │        │
│  │ ビュー   │  │ ビュー   │  │ハンドラー │        │
│  └──────────┘  └──────────┘  └──────────┘        │
│                                                    │
│       ROS 2 Qt統合（rclcpp、Qtシグナル）           │
└─────────────────────┬──────────────────────────────┘
                      │
                      ▼
         ┌────────────────────────────┐
         │   ROS 2トピック / サービス   │
         │                            │
         │  • /vehicle_status         │
         │  • /battery_status         │
         │  • /navigation/goal        │
         │  • /diagnostics            │
         │  • /emergency_stop         │
         └────────────────────────────┘
```

---

## 17. トレーサビリティマトリックス

| 車両UI要件カテゴリー | 関連システムコンポーネント |
|--------------------------------|---------------------------|
| ハードウェア | 10.1"産業用タッチスクリーン、マウントブラケット、電源 |
| ホーム画面 | ROS 2ステータストピック、バッテリー監視、ミッションプランナー |
| 診断 | ROS 2診断アグリゲーター、センサー健全性モニター |
| 設定 | ネットワーク設定、車両パラメータ、ユーザー認証 |
| 緊急 | 緊急停止コントローラー、TVMアラートシステム |

---

## 18. 改訂履歴

| バージョン | 日付 | 著者 | 変更内容 |
|---------|------|--------|---------|
| 1.0 | 2025年12月16日 | Pankajチーム | 初期車両UI要件（91要件） |

---

**文書終了**

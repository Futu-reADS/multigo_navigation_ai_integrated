# ソフトウェア要件

**文書ID:** REQ-SW-001
**バージョン:** 1.0
**日付:** 2025年12月15日
**ステータス:** ドラフト
**分類:** 社内

---

## 文書管理

| バージョン | 日付 | 著者 | 変更内容 |
|---------|------|--------|---------|
| 1.0 | 2025年12月15日 | ソフトウェアリード | すべてのソフトウェアスタック仕様を統合した初期ソフトウェア要件 |

---

## 1. はじめに

### 1.1 目的

この文書は、屋外優先車椅子輸送ロボットの**すべてのソフトウェア要件**を統合し、オペレーティングシステム、ミドルウェア（ROS 2）、ライブラリ、ツール、開発環境を含みます。

### 1.2 スコープ

この仕様は以下をカバーします:
- **オペレーティングシステム** - Ubuntu 22.04 LTS、カーネル要件
- **ミドルウェア** - ROS 2 Humble、Autoware、Nav2
- **コアライブラリ** - OpenCV、PCL、tf2、robot_localization
- **開発ツール** - ビルドシステム、デバッグ、バージョン管理
- **ソフトウェアアーキテクチャ** - ノード構造、起動ファイル、設定
- **デプロイメント** - インストール、更新、ログ記録

---

## 2. オペレーティングシステム要件

### 2.1 ベースOS（SW-OS-BASE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-OS-BASE-001 | システムはUbuntu 22.04 LTS（Jammy Jellyfish）を使用すること | Critical | OS検査 |
| SW-OS-BASE-002 | システムはリアルタイムパッチ付きLinuxカーネル5.15以上を使用すること | High | カーネルバージョン |
| SW-OS-BASE-003 | システムは64ビット（amd64）アーキテクチャであること | Critical | アーキテクチャチェック |
| SW-OS-BASE-004 | システムは5年間セキュリティ更新を受け取ること（LTS） | High | Ubuntuポリシー |
| SW-OS-BASE-005 | システムはGUIデスクトップを使用しないこと（ヘッドレス、リソース） | High | インストール設定 |

**要件総数: 5**

---

### 2.2 システム設定（SW-OS-CONFIG）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-OS-CONFIG-001 | システムはCPUガバナーを「performance」モードに設定すること | High | sysfsチェック |
| SW-OS-CONFIG-002 | システムはスワップを無効化すること（リアルタイムパフォーマンス） | High | swap -s |
| SW-OS-CONFIG-003 | システムはROS 2 DDS用のファイアウォールルールを設定すること | High | ufw/iptables |
| SW-OS-CONFIG-004 | システムはロボットユーザーアカウントの自動ログインを有効化すること | Medium | systemd設定 |
| SW-OS-CONFIG-005 | システムはネットワークインターフェースを設定すること（静的IPまたはDHCP） | High | netplan設定 |

**要件総数: 5**

---

## 3. ミドルウェア要件

### 3.1 ROS 2 Humble（SW-MW-ROS2）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-MW-ROS2-001 | システムはROS 2 Humble Hawksbill LTSを使用すること | Critical | ros2 --version |
| SW-MW-ROS2-002 | システムはros-humble-desktopまたはros-humble-ros-baseをインストールすること | Critical | dpkg -l |
| SW-MW-ROS2-003 | システムはCyclone DDSまたはFast DDSミドルウェアを使用すること | Critical | RMW環境変数 |
| SW-MW-ROS2-004 | システムはDDSドメインIDを設定すること（干渉回避） | High | ROS_DOMAIN_ID |
| SW-MW-ROS2-005 | システムはユーザー.bashrcでROS 2セットアップをソースすること | Critical | bashrc検査 |
| SW-MW-ROS2-006 | システムはビルド管理にcolconを使用すること | Critical | colcon --version |

**要件総数: 6**

---

### 3.2 Nav2（SW-MW-NAV2）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-MW-NAV2-001 | システムはros-humble-navigation2をインストールすること | Critical | dpkg -l |
| SW-MW-NAV2-002 | システムはros-humble-nav2-bringupをインストールすること | Critical | dpkg -l |
| SW-MW-NAV2-003 | システムはナビゲーションロジックにNav2ビヘイビアツリーを使用すること | High | コード検査 |
| SW-MW-NAV2-004 | システムはYAMLパラメータファイル経由でNav2を設定すること | Critical | 設定ファイル |

**要件総数: 4**

---

### 3.3 Autoware（SW-MW-AUTOWARE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-MW-AUTOWARE-001 | システムはAutoware.Core（ローカライゼーション、パーセプション）を使用すること | Critical | パッケージリスト |
| SW-MW-AUTOWARE-002 | システムはAutowareのNDTローカライゼーションを使用すること | Critical | 起動ファイル |
| SW-MW-AUTOWARE-003 | システムはAutowareをNav2と統合すること | Critical | ノードグラフ |
| SW-MW-AUTOWARE-004 | システムはYAMLパラメータファイル経由でAutowareを設定すること | High | 設定ファイル |

**要件総数: 4**

---

## 4. コアライブラリ要件

### 4.1 パーセプションライブラリ（SW-LIB-PERC）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-LIB-PERC-001 | システムはPCL（Point Cloud Library）1.12以上を使用すること | Critical | pkg-config |
| SW-LIB-PERC-002 | システムはOpenCV 4.xを使用すること | Critical | opencv_version |
| SW-LIB-PERC-003 | システムはTensorFlowまたはPyTorchを使用しないこと（GPU制約） | Critical | パッケージリスト |
| SW-LIB-PERC-004 | システムはROS 2 ↔ OpenCV変換にcv_bridgeを使用すること | Critical | パッケージリスト |
| SW-LIB-PERC-005 | システムは圧縮画像トピックにimage_transportを使用すること | High | パッケージリスト |

**要件総数: 5**

---

### 4.2 座標変換と時刻（SW-LIB-TF）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-LIB-TF-001 | システムは座標変換にtf2を使用すること | Critical | パッケージリスト |
| SW-LIB-TF-002 | システムはメッセージ変換にtf2_geometry_msgsを使用すること | Critical | パッケージリスト |
| SW-LIB-TF-003 | システムは変換のブロードキャスト/リスニングにtf2_rosを使用すること | Critical | パッケージリスト |
| SW-LIB-TF-004 | システムは変換を最低10秒間バッファすること | High | 設定 |

**要件総数: 4**

---

### 4.3 センサーフュージョン（SW-LIB-FUSION）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-LIB-FUSION-001 | システムはrobot_localizationパッケージを使用すること | Critical | パッケージリスト |
| SW-LIB-FUSION-002 | システムは拡張カルマンフィルター（EKF）を設定すること | High | YAML設定 |
| SW-LIB-FUSION-003 | システムはLiDAR + IMU + ホイールオドメトリを融合すること | Critical | 起動ファイル |

**要件総数: 3**

---

### 4.4 ユーティリティライブラリ（SW-LIB-UTIL）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-LIB-UTIL-001 | システムは線形代数にEigen 3.xを使用すること | High | pkg-config |
| SW-LIB-UTIL-002 | システムはBoost 1.74以上を使用すること（filesystem、thread、system） | High | dpkg -l |
| SW-LIB-UTIL-003 | システムは設定解析にyaml-cppを使用すること | High | pkg-config |
| SW-LIB-UTIL-004 | システムは構造化ログにspdlogを使用すること | Medium | CMake find |

**要件総数: 4**

---

## 5. ソフトウェアアーキテクチャ要件

### 5.1 ノード構造（SW-ARCH-NODE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-ARCH-NODE-001 | 各サブシステムはROS 2ノードとして実装すること | Critical | ノードリスト |
| SW-ARCH-NODE-002 | ノードはrclcpp（C++）またはrclpy（Python）を使用すること | Critical | コード検査 |
| SW-ARCH-NODE-003 | クリティカルノードはパフォーマンスのためC++を使用すること | High | コード検査 |
| SW-ARCH-NODE-004 | ノードは適切な場合にライフサイクル管理を実装すること | Medium | コード検査 |
| SW-ARCH-NODE-005 | ノードは/diagnosticsトピックに診断情報をパブリッシュすること | High | トピック検査 |
| SW-ARCH-NODE-006 | ノードは設定にROS 2パラメータを使用すること | Critical | 起動ファイル |

**要件総数: 6**

---

### 5.2 パッケージ構造（SW-ARCH-PKG）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-ARCH-PKG-001 | システムはコードをROS 2パッケージに整理すること | Critical | ワークスペース構造 |
| SW-ARCH-PKG-002 | 各パッケージはpackage.xml（format 3）を持つこと | Critical | ファイル検査 |
| SW-ARCH-PKG-003 | 各パッケージはCMakeLists.txtまたはsetup.pyを持つこと | Critical | ファイル検査 |
| SW-ARCH-PKG-004 | パッケージはROS 2命名規則に従うこと | High | パッケージ名 |
| SW-ARCH-PKG-005 | パッケージは依存関係を明示的に宣言すること | Critical | package.xml |

**要件総数: 5**

---

### 5.3 起動ファイル（SW-ARCH-LAUNCH）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-ARCH-LAUNCH-001 | システムはPython起動ファイル（launch.py）を使用すること | High | ファイル検査 |
| SW-ARCH-LAUNCH-002 | 起動ファイルはコマンドライン引数をサポートすること | High | 起動API |
| SW-ARCH-LAUNCH-003 | 起動ファイルはYAMLファイルからパラメータをロードすること | Critical | 起動ファイル |
| SW-ARCH-LAUNCH-004 | システムは全システム用のマスター起動ファイルを持つこと | Critical | 起動ファイル |
| SW-ARCH-LAUNCH-005 | 起動ファイルはノードライフサイクルイベントを処理すること | Medium | 起動API |

**要件総数: 5**

---

### 5.4 設定管理（SW-ARCH-CONFIG）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-ARCH-CONFIG-001 | システムはすべての設定にYAMLファイルを使用すること | Critical | 設定ファイル |
| SW-ARCH-CONFIG-002 | 設定はサブシステムごとに整理すること | High | ディレクトリ構造 |
| SW-ARCH-CONFIG-003 | システムは環境固有の設定をサポートすること（dev/prod） | High | 設定システム |
| SW-ARCH-CONFIG-004 | システムは起動時に設定を検証すること | High | 起動ログ |
| SW-ARCH-CONFIG-005 | システムはデフォルト設定を提供すること | Critical | 設定ファイル |

**要件総数: 5**

---

## 6. 開発ツール要件

### 6.1 ビルドシステム（SW-DEV-BUILD）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-DEV-BUILD-001 | システムはワークスペースビルドにcolconを使用すること | Critical | ビルドコマンド |
| SW-DEV-BUILD-002 | システムはCMake 3.16以上をサポートすること | Critical | cmake --version |
| SW-DEV-BUILD-003 | システムはコンパイラ警告を有効化すること（-Wall -Wextra） | High | CMakeLists.txt |
| SW-DEV-BUILD-004 | システムはリリース用に最適化してビルドすること（-O3） | High | CMakeLists.txt |
| SW-DEV-BUILD-005 | システムは並列ビルドをサポートすること（-j） | High | ビルドコマンド |

**要件総数: 5**

---

### 6.2 テストフレームワーク（SW-DEV-TEST）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-DEV-TEST-001 | システムはC++単体テストにgtestを使用すること | Critical | CMakeLists.txt |
| SW-DEV-TEST-002 | システムはPython単体テストにpytestを使用すること | Critical | setup.py |
| SW-DEV-TEST-003 | システムは統合テストにlaunch_testingを使用すること | High | テストファイル |
| SW-DEV-TEST-004 | システムはすべてのテスト実行にcolcon testをサポートすること | Critical | テストコマンド |
| SW-DEV-TEST-005 | システムはコードカバレッジを測定すること（>80%目標） | High | カバレッジレポート |

**要件総数: 5**

---

### 6.3 デバッグとプロファイリング（SW-DEV-DEBUG）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-DEV-DEBUG-001 | システムはC++デバッグにgdbをサポートすること | High | ツール可用性 |
| SW-DEV-DEBUG-002 | システムはランタイムデバッグにrqtツールをサポートすること | High | rqt --list |
| SW-DEV-DEBUG-003 | システムはros2 topic/service/action CLIツールをサポートすること | Critical | CLIテスト |
| SW-DEV-DEBUG-004 | システムはメモリリーク検出にvalgrindをサポートすること | Medium | ツール可用性 |
| SW-DEV-DEBUG-005 | システムはCPUプロファイリングにperfをサポートすること | Medium | ツール可用性 |

**要件総数: 5**

---

### 6.4 バージョン管理（SW-DEV-VCS）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-DEV-VCS-001 | システムはバージョン管理にGitを使用すること | Critical | git --version |
| SW-DEV-VCS-002 | リポジトリはビルド成果物用の.gitignoreを持つこと | High | ファイル検査 |
| SW-DEV-VCS-003 | システムはマルチリポジトリ管理にvcstoolを使用すること | Medium | ツール可用性 |
| SW-DEV-VCS-004 | システムはセマンティックバージョニングでリリースをタグ付けすること | High | Gitタグ |

**要件総数: 4**

---

## 7. デプロイメント要件

### 7.1 インストール（SW-DEPLOY-INSTALL）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-DEPLOY-INSTALL-001 | システムはインストールスクリプト（setup.sh）を提供すること | Critical | スクリプトファイル |
| SW-DEPLOY-INSTALL-002 | インストールはすべての依存関係を自動処理すること | High | スクリプトテスト |
| SW-DEPLOY-INSTALL-003 | インストールはsystemdサービスを設定すること | Critical | systemdユニット |
| SW-DEPLOY-INSTALL-004 | インストールは環境変数を設定すること | Critical | bashrc/profile |
| SW-DEPLOY-INSTALL-005 | インストールはインストール成功を検証すること | High | 検証スクリプト |

**要件総数: 5**

---

### 7.2 システムサービス（SW-DEPLOY-SERVICE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-DEPLOY-SERVICE-001 | システムはメインナビゲーションスタック用のsystemdサービスを持つこと | Critical | サービスファイル |
| SW-DEPLOY-SERVICE-002 | サービスは起動時に自動起動すること | Critical | systemd enable |
| SW-DEPLOY-SERVICE-003 | サービスは障害時に自動再起動すること | High | 再起動ポリシー |
| SW-DEPLOY-SERVICE-004 | サービスは適切な依存関係を持つこと（After=network.target） | High | サービスファイル |
| SW-DEPLOY-SERVICE-005 | サービスはjournaldにログすること | Critical | journalctl |

**要件総数: 5**

---

### 7.3 更新とアップグレード（SW-DEPLOY-UPDATE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-DEPLOY-UPDATE-001 | システムはOTA（Over-The-Air）ソフトウェア更新をサポートすること | High | 更新メカニズム |
| SW-DEPLOY-UPDATE-002 | 更新は失敗時のロールバックメカニズムを持つこと | High | バックアップシステム |
| SW-DEPLOY-UPDATE-003 | 更新は明示的なオペレーター承認を必要とすること | Critical | 更新UI |
| SW-DEPLOY-UPDATE-004 | システムはすべての更新試行をログすること | High | 更新ログ |

**要件総数: 4**

---

### 7.4 ログ記録（SW-DEPLOY-LOG）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-DEPLOY-LOG-001 | システムは~/.ros/log/ディレクトリにログすること | Critical | ログ位置 |
| SW-DEPLOY-LOG-002 | システムはログを毎日または100 MBサイズでローテートすること | High | logrotate設定 |
| SW-DEPLOY-LOG-003 | システムはログを最低30日間保持すること | High | 保持ポリシー |
| SW-DEPLOY-LOG-004 | システムはタイムスタンプ付きでログすること（ISO 8601形式） | Critical | ログ形式 |
| SW-DEPLOY-LOG-005 | システムは設定可能なレベルでログすること（DEBUG/INFO/WARN/ERROR） | High | ログ設定 |
| SW-DEPLOY-LOG-006 | システムはログをTVMサービスにアップロードすること（question_answers.md参照） | Medium | TVM統合 |

**要件総数: 6**

---

## 8. パフォーマンスと最適化要件

### 8.1 CPU使用率（SW-PERF-CPU）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-PERF-CPU-001 | システムは通常動作中にCPU使用率<70%であること | High | htop/top監視 |
| SW-PERF-CPU-002 | 個々のノードはそれぞれCPU使用率<20%であること | High | ros2 top |
| SW-PERF-CPU-003 | システムはクリティカルノードを優先すること（RT優先度） | High | chrt/nice |
| SW-PERF-CPU-004 | システムはビジーウェイトループを避けること（コールバック/タイマーを使用） | High | コードレビュー |

**要件総数: 4**

---

### 8.2 メモリ管理（SW-PERF-MEM）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-PERF-MEM-001 | システムは通常動作中にRAM使用<20 GBであること | High | free -h |
| SW-PERF-MEM-002 | システムはメモリリークがないこと | Critical | valgrindテスト |
| SW-PERF-MEM-003 | システムは起動時に大きなバッファを事前割り当てすること | Medium | コード検査 |
| SW-PERF-MEM-004 | システムは頻繁な割り当てにメモリプールを使用すること | Medium | コード検査 |

**要件総数: 4**

---

### 8.3 ネットワーク帯域幅（SW-PERF-NET）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-PERF-NET-001 | DDSトラフィックは平均<50 MB/sであること | High | ネットワーク監視 |
| SW-PERF-NET-002 | システムは適切な場合に圧縮画像転送を使用すること | High | トピック検査 |
| SW-PERF-NET-003 | システムは信頼性/レイテンシのトレードオフにDDS QoSを設定すること | High | QoSプロファイル |

**要件総数: 3**

---

## 9. セキュリティ要件

### 9.1 アクセス制御（SW-SEC-ACCESS）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-SEC-ACCESS-001 | システムは非rootユーザーアカウントで実行すること | Critical | ユーザーチェック |
| SW-SEC-ACCESS-002 | システムはパスワード保護されたSSHアクセスを使用すること | Critical | sshd_config |
| SW-SEC-ACCESS-003 | システムは未使用のネットワークサービスを無効化すること | High | netstat/ss |
| SW-SEC-ACCESS-004 | システムはファイアウォールを有効化すること（ufw/iptables） | High | ファイアウォールステータス |

**要件総数: 4**

---

### 9.2 ソフトウェア更新（SW-SEC-UPDATE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|----------------|-------------|----------|------------|
| SW-SEC-UPDATE-001 | システムはOSセキュリティ更新を受信すること | Critical | apt update |
| SW-SEC-UPDATE-002 | システムはパッケージ署名を検証すること | Critical | apt設定 |
| SW-SEC-UPDATE-003 | システムはunattended-upgradesを設定すること | High | パッケージチェック |

**要件総数: 3**

---

## 10. 要件サマリー

### カテゴリー別要件数

| カテゴリー | 要件総数 | Critical | High | Medium | Low |
|----------|-------------------|----------|------|--------|-----|
| **オペレーティングシステム** | **10** | 5 | 5 | 0 | 0 |
| **ミドルウェア** | **14** | 11 | 3 | 0 | 0 |
| **コアライブラリ** | **16** | 10 | 5 | 1 | 0 |
| **ソフトウェアアーキテクチャ** | **21** | 12 | 7 | 2 | 0 |
| **開発ツール** | **19** | 8 | 8 | 3 | 0 |
| **デプロイメント** | **20** | 12 | 7 | 1 | 0 |
| **パフォーマンス** | **11** | 1 | 8 | 2 | 0 |
| **セキュリティ** | **7** | 5 | 2 | 0 | 0 |
| **合計** | **118** | **64 (54%)** | **45 (38%)** | **9 (8%)** | **0 (0%)** |

---

## 11. 受入基準

### 11.1 MVP ソフトウェア

- ✅ Ubuntu 22.04 + ROS 2 Humbleインストール済み
- ✅ Nav2 + Autoware動作可能
- ✅ コアライブラリ（PCL、OpenCV、tf2）機能的
- ✅ 基本的な起動ファイルと設定
- ✅ 手動インストール文書化済み

### 11.2 プロダクション ソフトウェア

- ✅ すべてのMVP + すべての高優先度要件
- ✅ systemdサービス設定済み
- ✅ OTA更新メカニズム
- ✅ 包括的なログ記録
- ✅ セキュリティ強化
- ✅ >80%テストカバレッジ

---

**文書ステータス:** ドラフト
**次回レビュー:** ソフトウェアスタック統合とテスト後
**必要な承認:** ソフトウェアリード、システムアーキテクト、DevOpsエンジニア

# 要件トレーサビリティマトリックス

**最終更新日:** 2025年12月4日
**ドキュメントバージョン:** 1.0
**総要件数:** 91

---

## ドキュメントの目的

本ドキュメントは以下の間の**完全なトレーサビリティ**を提供します:
1. **システム要件** ([REQUIREMENTS.md](./REQUIREMENTS.md)) - 何を構築する必要があるか
2. **実装ガイド** ([IMPLEMENTATION-GUIDE.md](./IMPLEMENTATION-GUIDE.md)) - いつ、どのように構築するか
3. **システムアーキテクチャ** ([SYSTEM-ARCHITECTURE.md](./SYSTEM-ARCHITECTURE.md)) - 設計の詳細
4. **問題と修正** ([ISSUES-AND-FIXES.md](./ISSUES-AND-FIXES.md)) - 既知の問題

**本ドキュメントの使用目的:**
- ✅ すべての要件が実装計画で対応されていることを検証
- ✅ 各要件がどのフェーズで完了するかを追跡
- ✅ 各要件の工数を見積もり
- ✅ 各要件のテスト戦略を計画
- ✅ 実装計画のギャップを特定

---

## クイックサマリー

| フェーズ | 要件数 | 工数 | ステータス |
|-------|-------------|--------|--------|
| **既存** | 47 | - | ✅ 完了 |
| **フェーズ1** | 10 | 144h | 🔴 クリティカル (バグ + 安全性) |
| **フェーズ2** | 6 | 96h | 🔴 クリティカル (テスト) |
| **フェーズ3** | 16 | 104h | 🟡 高 (ROS 2 ベストプラクティス) |
| **フェーズ4** | 9 | 104h | 🟡 高 (デプロイ) |
| **将来** | 3 | TBD | 🟢 あると良い |
| **合計** | **91** | **448h** | **52% 完了** |

---

## ナビゲーションガイド

### セクションへジャンプ:
- [マスターコントロール要件](#マスターコントロール要件-mcr) (9要件)
- [起動と統合要件](#起動と統合要件-lir) (8要件)
- [ナビゲーション要件](#ナビゲーション要件-nr) (7要件)
- [ドッキング要件](#ドッキング要件-dr) (15要件)
- [認識要件](#認識要件-pr) (9要件)
- [モーション制御要件](#モーション制御要件-mr) (9要件)
- [キャリブレーションとテスト要件](#キャリブレーションとテスト要件-ctr) (4要件)
- [安全性要件](#安全性要件-sr) (10要件)
- [品質要件](#品質要件-qr) (12要件)
- [ドキュメント要件](#ドキュメント要件-docr) (5要件)
- [デプロイ要件](#デプロイ要件-dpr) (3要件)

---

## マスターコントロール要件 (MCR)

**合計:** 9要件 | **完了:** 4 (44%) | **フェーズフォーカス:** フェーズ1、フェーズ4

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **MCR-1.1** | アプローチ前確認 | ✅ 完了 | 既存 | - | `multigo_master/nav_master.cpp` | 手動テスト |
| **MCR-1.2** | ドッキング前確認 | ✅ 完了 | 既存 | - | `multigo_master/nav_master.cpp` | 手動テスト |
| **MCR-2.1** | アプローチアクションクライアント | ✅ 完了 | 既存 | - | `multigo_master/nav_master.cpp` | 統合テスト |
| **MCR-2.2** | ドックアクションクライアント | ✅ 完了 | 既存 | - | `multigo_master/nav_master.cpp` | 統合テスト |
| **MCR-2.3** | リッチアクションフィードバック | ❌ 未実装 | フェーズ3 | 12h | IMPL-GUIDE フェーズ3 第11週<br>ARCH セクション 8.3 | ユニットテスト (アクションメッセージ)<br>統合テスト |
| **MCR-3.1** | 高レベル状態機械 | 🟡 部分的 | フェーズ1 | 24h | IMPL-GUIDE フェーズ1 第2週<br>ARCH セクション 7.2<br>ISSUE: 明示的FSMなし | ユニットテスト (状態遷移)<br>統合テスト (ワークフロー) |
| **MCR-4.1** | ステータスレポート | 🟡 部分的 | フェーズ3 | 4h | IMPL-GUIDE フェーズ3 (MCR-2.3と共に) | 手動テスト |
| **MCR-5.1** | ウェイポイントマネージャー | ❌ 未実装 | フェーズ4 | 20h | IMPL-GUIDE フェーズ4 第13週<br>ARCH セクション 10.3<br>ISSUE CRIT-06 | ユニットテスト (保存/読込)<br>統合テスト |
| **MCR-5.2** | 手動ティーチングモード | ❌ 未実装 | フェーズ4 | 20h | IMPL-GUIDE フェーズ4 第14週<br>ARCH セクション 10.3 | フィールドテスト (マップ品質) |

**サマリー:**
- 🔴 **クリティカルギャップ:** フェーズ1に必要な状態機械 (MCR-3.1)
- 🟡 **フェーズ4成果物:** ティーチングモード (MCR-5.1, MCR-5.2)
- ✅ **プロダクション準備完了:** フェーズ4後

---

## 起動と統合要件 (LIR)

**合計:** 8要件 | **完了:** 7 (88%) | **フェーズフォーカス:** 既存 + フェーズ4

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **LIR-1.1** | ブート起動ファイル | ✅ 完了 | 既存 | - | `multigo_launch/launch/boot.launch.py` | 起動テスト |
| **LIR-1.2** | 実行起動ファイル | ✅ 完了 | 既存 | - | `multigo_launch/launch/run.launch.py` | 起動テスト |
| **LIR-1.3** | シミュレーション起動 | ✅ 完了 | 既存 | - | `multigo_launch/launch/simulation.launch.py` | 起動テスト |
| **LIR-2.1** | ナビゲーションパラメータ | ✅ 完了 | 既存 | - | `multigo_launch/config/nav2_params.yaml` | 設定検証 |
| **LIR-2.2** | ドッキングパラメータ | ✅ 完了 | 既存 | - | `run.launch.py` パラメータ | 設定検証 |
| **LIR-2.3** | 階層的設定管理 | ❌ 未実装 | フェーズ4 | 24h | IMPL-GUIDE フェーズ4 第15週<br>ARCH セクション 10.2 | ユニットテスト (設定マージ)<br>統合テスト |
| **LIR-2.4** | ロボット記述 (URDF) | ✅ 完了 | 既存 | - | 起動ファイルで想定 | URDF検証 |
| **LIR-3.1** | パッケージ依存関係 | ✅ 完了 | 既存 | - | package.xml ファイル | ビルドテスト |

**サマリー:**
- ✅ **ほぼ完了:** 階層的設定のみ未実装
- 🟡 **フェーズ4追加:** マルチロボット設定サポート (LIR-2.3)

---

## ナビゲーション要件 (NR)

**合計:** 7要件 | **完了:** 6 (86%) | **フェーズフォーカス:** フェーズ3

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **NR-1.1** | グローバル経路計画 | ✅ 完了 | 既存 | - | Nav2 NavFnプランナー | 統合テスト |
| **NR-1.2** | 経路再計画 | ✅ 完了 | 既存 | - | Nav2プランナーサーバー | 統合テスト |
| **NR-2.1** | 差動駆動キネマティクス | ✅ 完了 | 既存 | - | Nav2 DWBコントローラー | ユニットテスト |
| **NR-2.2** | ホロノミックモーションサポート | 🟡 部分的 | フェーズ3 | 8h | IMPL-GUIDE フェーズ3 第11週<br>ARCH セクション 8 (CRIT-09)<br>ISSUE CRIT-09 | 統合テスト (横移動) |
| **NR-3.1** | コストマップ管理 | ✅ 完了 | 既存 | - | Nav2 costmap_2d | 統合テスト |
| **NR-4.1** | 障害物回避 | ✅ 完了 | 既存 | - | Nav2 DWB + コストマップ | 統合テスト |
| **NR-4.2** | リカバリー動作 | ✅ 完了 | 既存 | - | Nav2リカバリーサーバー | 統合テスト |

**サマリー:**
- ✅ **良好な実装:** Nav2統合完了
- 🟡 **フェーズ3修正:** ホロノミックモーション有効化 (NR-2.2)

---

## ドッキング要件 (DR)

**合計:** 15要件 | **完了:** 9 (60%) | **フェーズフォーカス:** フェーズ1 (バグ)

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **DR-1.1** | マーカーベースアプローチ | ✅ 完了 | 既存 | - | `nav_goal/nav_goal.cpp` | 統合テスト |
| **DR-1.2** | アプローチ距離オフセット | ✅ 完了 | 既存 | - | `nav_goal.cpp:calculateGoal()` | ユニットテスト |
| **DR-2.1** | 単一マーカーアライメント | 🐛 **バグ** | フェーズ1 | 4h | `nav_docking.cpp:frontMarkerCmdVel()`<br>**ISSUE CRIT-01** (PIDバグ) | ユニットテスト (PID)<br>統合テスト |
| **DR-2.2** | デュアルマーカーセンタリング | 🐛 **バグ** | フェーズ1 | 1h | `nav_docking.cpp:dualMarkerCmdVel()`<br>**ISSUE CRIT-02** (距離計算) | ユニットテスト (中心計算) |
| **DR-3.1** | PID制御 X軸 | 🐛 **バグ** | フェーズ1 | 4h | `nav_docking.cpp:197`<br>**ISSUE CRIT-01** | ユニットテスト (積分) |
| **DR-3.2** | PID制御 Y軸 | ✅ 完了 | 既存 | - | `nav_docking.cpp` | ユニットテスト |
| **DR-3.3** | PID制御 ヨー | ✅ 完了 | 既存 | - | `nav_docking.cpp` | ユニットテスト |
| **DR-4.1** | ステージ遷移ロジック | ✅ 完了 | 既存 | - | `nav_docking.cpp` (距離閾値) | 統合テスト |
| **DR-4.2** | 二段階確認 | ✅ 完了 | 既存 | - | `nav_docking.cpp:checkCompletion()` | 統合テスト |
| **DR-5.1** | マーカーロス処理 | ✅ 完了 | 既存 | - | `nav_docking.cpp` (タイムアウト) | ユニットテスト |
| **DR-5.2** | 位置安定性チェック | ✅ 完了 | 既存 | - | `nav_docking.cpp` (3秒検証) | 統合テスト |
| **DR-5.3** | 衝突検出 | ❌ 未実装 | フェーズ1 | 20h | IMPL-GUIDE フェーズ1 タスク 3.2<br>ARCH セクション 6 (SR-2.2)<br>**ISSUE CRIT-03** | 統合テスト (障害物) |
| **DR-6.1** | アンドッキングアクション | ❌ 未実装 | フェーズ3/4 | 20h | **IMPL-GUIDEにない**<br>**未実装** | 統合テスト |
| **DR-7.1** | ドッキングアクションサーバー | ✅ 完了 | 既存 | - | `nav_docking.cpp` | 統合テスト |
| **DR-7.2** | アクションフィードバック | 🟡 部分的 | フェーズ3 | MCR-2.3に含む | IMPL-GUIDE フェーズ3 第11週 | 統合テスト |

**サマリー:**
- 🔴 **クリティカル:** 3つのバグ (CRIT-01, CRIT-02, HIGH-01) - フェーズ1第1週で修正
- 🔴 **クリティカル:** LiDAR安全性未実装 (CRIT-03) - フェーズ1で追加
- ⚠️ **ギャップ:** アンドッキング計画なし - **実装ガイドに追加必要**

---

## 認識要件 (PR)

**合計:** 9要件 | **完了:** 9 (100%) | **フェーズフォーカス:** 既存 (完了)

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **PR-1.1** | ArUcoマーカー検出 | ✅ 完了 | 既存 | - | `aruco_detect/aruco_detect.cpp` | ユニットテスト |
| **PR-1.2** | マルチマーカーサポート | ✅ 完了 | 既存 | - | `aruco_detect.cpp` (ID 20, 21) | 統合テスト |
| **PR-2.1** | 6自由度姿勢推定 | ✅ 完了 | 既存 | - | `cv::aruco::estimatePoseSingleMarkers()` | ユニットテスト |
| **PR-2.2** | カメラフレーム変換 | ✅ 完了 | 既存 | - | `aruco_detect.cpp` (OpenCV→ROS) | ユニットテスト |
| **PR-3.1** | デュアルカメラサポート | ✅ 完了 | 既存 | - | 左 + 右カメラトピック | 統合テスト |
| **PR-3.2** | カメラキャリブレーション | ✅ 完了 | 既存 | - | `MultiGoArucoTest` パッケージ | 手動キャリブレーション |
| **PR-4.1** | TFブロードキャスト | ✅ 完了 | 既存 | - | `aruco_detect.cpp` | 統合テスト |
| **PR-4.2** | マーカーからマップへの変換 | ✅ 完了 | 既存 | - | TF2変換 | 統合テスト |
| **PR-5.1** | LiDAR統合 | ✅ 完了 | 既存 | - | `/scan` トピックからNav2へ | 統合テスト |

**サマリー:**
- ✅ **100% 完了:** 変更不要
- ✅ **プロダクション準備完了:** すでにプロダクション品質

---

## モーション制御要件 (MR)

**合計:** 9要件 | **完了:** 7 (78%) | **フェーズフォーカス:** フェーズ1、フェーズ3

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **MR-1.1** | メカナムキネマティクス | ✅ 完了 | 既存 | - | `mecanum_wheels/mecanum_wheels.cpp` | ユニットテスト |
| **MR-1.2** | 回転中心調整 | ✅ 完了 | 既存 | - | `nav_control/nav_control.cpp` | ユニットテスト |
| **MR-2.1** | ホイールごとのPID制御 | ✅ 完了 | 既存 | - | `mecanum_wheels.cpp` | ユニットテスト |
| **MR-2.2** | ホイールオドメトリ | ✅ 完了 | 既存 | - | `mecanum_wheels.cpp` | 統合テスト |
| **MR-3.1** | 速度制限 | ✅ 完了 | 既存 | - | Nav2パラメータ + mecanum_wheels | 設定テスト |
| **MR-3.2** | 加速度制限 | 🟡 部分的 | フェーズ3 | 8h | IMPL-GUIDE フェーズ3 (オプション)<br>**ギャップ:** ドッキング時のランピングなし | ユニットテスト |
| **MR-4.1** | コマンド調停 | ❌ 未実装 | フェーズ3 | 16h | IMPL-GUIDE フェーズ3 第12週<br>ARCH セクション 8 (command_arbitrator) | 統合テスト |
| **MR-5.1** | モーターハードウェアインターフェース | ✅ 完了 | 既存 | - | `mecanum_wheels.cpp` (Phidget22) | ハードウェアテスト |
| **MR-5.2** | 安全停止統合 | 🟡 部分的 | フェーズ1 | SR-1.2に含む | IMPL-GUIDE フェーズ1 タスク 2.2 | 統合テスト |

**サマリー:**
- 🔴 **フェーズ1:** 緊急停止統合 (MR-5.2)
- 🟡 **フェーズ3:** コマンド調停追加 (MR-4.1)

---

## キャリブレーションとテスト要件 (CTR)

**合計:** 4要件 | **完了:** 2 (50%) | **フェーズフォーカス:** 既存 + フェーズ2

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **CTR-1.1** | カメラキャリブレーションツール | ✅ 完了 | 既存 | - | `MultiGoArucoTest/calibration.cpp` | 手動ツール |
| **CTR-1.2** | キャリブレーションパラメータ保存 | 🟡 部分的 | 既存 | - | YAMLファイル (想定) | 設定検証 |
| **CTR-2.1** | ドッキング精度テスト | ✅ 完了 | 既存 | - | 手動テスト (ドキュメントに記載) | フィールドテスト |
| **CTR-2.2** | 検出範囲テスト | ❌ 未実装 | フェーズ2 | 8h | **IMPL-GUIDEにない**<br>**未実装** | フィールドテスト (範囲) |

**サマリー:**
- ✅ **ツール存在:** キャリブレーションインフラ完了
- ⚠️ **ギャップ:** 検出範囲テスト計画なし - **フェーズ2に追加**

---

## 安全性要件 (SR)

**合計:** 10要件 | **完了:** 2 (20%) | **フェーズフォーカス:** フェーズ1 (クリティカル)

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **SR-1.1** | ハードウェア緊急停止ボタン | ❓ 不明 | フェーズ1 | 4h | IMPL-GUIDE フェーズ1 タスク 2.1<br>**調査必要** | ハードウェアテスト |
| **SR-1.2** | ソフトウェア緊急停止トピック | ❌ 未実装 | フェーズ1 | 12h | IMPL-GUIDE フェーズ1 タスク 2.2<br>ARCH セクション 6.2<br>**ISSUE CRIT-05** | 統合テスト |
| **SR-2.1** | 速度制限の実施 | ✅ 完了 | 既存 | - | Nav2 + mecanum_wheels | 設定テスト |
| **SR-2.2** | ドッキング時の衝突検出 | ❌ 未実装 | フェーズ1 | 20h | IMPL-GUIDE フェーズ1 タスク 3.2<br>ARCH セクション 6<br>**ISSUE CRIT-03** | 統合テスト |
| **SR-3.1** | アクション実行タイムアウト | ❌ 未実装 | フェーズ3 | 12h | IMPL-GUIDE フェーズ3 第12週<br>ARCH セクション 8.3<br>**ISSUE CRIT-10** | ユニットテスト |
| **SR-4.1** | マーカーロス検出 | ✅ 完了 | 既存 | - | `nav_docking.cpp` | 統合テスト |
| **SR-4.2** | モーター故障検出 | ❓ 不明 | フェーズ4 | TBD | **検証必要** | ハードウェアテスト |
| **SR-5.1** | 安全性監視ノード | ❌ 未実装 | フェーズ1 | 40h | IMPL-GUIDE フェーズ1 第2-3週<br>ARCH セクション 6.2 | ユニット + 統合テスト |
| **SR-5.2** | 安全状態管理 | ❌ 未実装 | フェーズ1 | SR-5.1に含む | ARCH セクション 6.2 | ユニットテスト (状態機械) |
| **SR-6.1** | ジオフェンシング (進入禁止ゾーン) | ❌ 未実装 | フェーズ1/4 | 16h基本<br>40hフル | IMPL-GUIDE フェーズ1 タスク 4.1<br>ARCH セクション 6.3<br>**ISSUE CRIT-08** | 統合テスト |

**サマリー:**
- 🔴 **クリティカル - フェーズ1:** 安全性監視 (SR-5.1, SR-5.2)、緊急停止 (SR-1.2)、LiDAR安全性 (SR-2.2)
- 🔴 **20%のみ完了:** フェーズ1の最優先事項

---

## 品質要件 (QR)

**合計:** 12要件 | **完了:** 0 (0%) | **フェーズフォーカス:** フェーズ2、フェーズ3

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **QR-1.1** | ユニットテストカバレッジ (80%) | ❌ 未実装 | フェーズ2 | 60h | IMPL-GUIDE フェーズ2 第5-6週<br>ARCH セクション 9.1<br>**ISSUE CRIT-04** | 40-50ユニットテスト |
| **QR-1.2** | 統合テスト | ❌ 未実装 | フェーズ2 | 30h | IMPL-GUIDE フェーズ2 第7週<br>ARCH セクション 9.2 | 10-15統合テスト |
| **QR-1.3** | CI/CDパイプライン | ❌ 未実装 | フェーズ2 | 16h | IMPL-GUIDE フェーズ2 第8週<br>ARCH セクション 9.3 | GitHub Actions |
| **QR-2.1** | ドッキング成功率 >95% | ❓ 不明 | フェーズ2 | - | フェーズ1修正後に測定 | フィールドテスト (100回試行) |
| **QR-2.2** | ナビゲーション信頼性 | ✅ 想定 | 既存 | - | Nav2実証済み信頼性 | 統合テスト |
| **QR-2.3** | ドッキング精度 ±1mm | ❓ 不明 | フェーズ1 | - | バグ修正 + 再調整後 | 精密測定 |
| **QR-3.1** | コード品質 | 🟡 部分的 | 既存 | - | 一般的に良好、一部問題あり | コードレビュー |
| **QR-3.2** | 静的解析 | ❌ 未実装 | フェーズ2/3 | 8h | **IMPL-GUIDEにない**<br>**未実装** | cppcheck、clang-tidy in CI |
| **QR-4.1** | ライフサイクルノード | ❌ 未実装 | フェーズ3 | 48h | IMPL-GUIDE フェーズ3 第9-10週<br>ARCH セクション 8.1 | ユニットテスト (遷移) |
| **QR-5.1** | 明示的QoSポリシー | ❌ 未実装 | フェーズ3 | 8h | IMPL-GUIDE フェーズ3 第10週<br>ARCH セクション 8.2 | 統合テスト |
| **QR-6.1** | 診断システム | ❌ 未実装 | フェーズ4 | 16h | IMPL-GUIDE フェーズ4 第16週<br>ARCH セクション 10.1 | 統合テスト |
| **QR-7.1** | トピック命名標準 | ❌ 未実装 | フェーズ3 | 16h | IMPL-GUIDE フェーズ3 第11週<br>ARCH セクション 8.4 | 設定テスト |

**サマリー:**
- 🔴 **クリティカル - フェーズ2:** テスト (QR-1.1, QR-1.2, QR-1.3) - **ISSUE CRIT-04**
- 🟡 **フェーズ3:** ROS 2ベストプラクティス (QR-4.1, QR-5.1, QR-7.1)
- ⚠️ **ギャップ:** 静的解析 (QR-3.2) が実装ガイドにない - **フェーズ2に追加**

---

## ドキュメント要件 (DOCR)

**合計:** 5要件 | **完了:** 1 (20%) | **フェーズフォーカス:** フェーズ4 (低優先度)

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **DOCR-1.1** | ユーザーマニュアル | ❌ 未実装 | フェーズ4 | 16h | IMPL-GUIDE フェーズ4 第16週<br>(オペレータードキュメント) | 手動レビュー |
| **DOCR-1.2** | キャリブレーションガイド | ❌ 未実装 | フェーズ4 | 8h | **IMPL-GUIDEにない**<br>**未実装** | 手動レビュー |
| **DOCR-2.1** | アーキテクチャドキュメント | ✅ 完了 | 既存 | - | **docs/active/** (このプロジェクト!) | 手動レビュー |
| **DOCR-2.2** | APIドキュメント | 🟡 部分的 | フェーズ3 | 8h | **IMPL-GUIDEにない**<br>(Doxygen) | 自動生成 |
| **DOCR-2.3** | テストドキュメント | ❌ 未実装 | フェーズ2 | テストに含む | IMPL-GUIDE フェーズ2 | 手動レビュー |

**サマリー:**
- ✅ **アーキテクチャ完了:** アクティブドキュメントプロジェクト完了!
- 🟡 **フェーズ4:** ユーザーマニュアル (DOCR-1.1)
- ⚠️ **ギャップ:** キャリブレーションガイド (DOCR-1.2)、APIドキュメント (DOCR-2.2) が実装ガイドにない

---

## デプロイ要件 (DPR)

**合計:** 3要件 | **完了:** 0 (0%) | **フェーズフォーカス:** フェーズ4

| 要件ID | 要件 | ステータス | フェーズ | 工数 | 実装リファレンス | テスト戦略 |
|--------|------------|--------|-------|--------|------------------------|---------------|
| **DPR-1.1** | Dockerサポート | ❌ 未実装 | フェーズ4 | 40h | IMPL-GUIDE フェーズ4 第15週<br>ARCH セクション 10.1 | デプロイテスト |
| **DPR-1.2** | コンテナレジストリ | ❌ 未実装 | フェーズ4 | DPR-1.1に含む | IMPL-GUIDE フェーズ4 第15週 | CI/CDテスト |
| **DPR-2.1** | 環境設定 | ❌ 未実装 | フェーズ4 | LIR-2.3に含む | IMPL-GUIDE フェーズ4 第15週<br>ARCH セクション 10.2 | デプロイテスト |

**サマリー:**
- 🟡 **フェーズ4:** 完全なデプロイインフラ
- ✅ **良好な計画:** すべて実装ガイドに含まれる

---

## クロスリファレンス: 問題から要件へ

| 問題ID | 要件 | 説明 | フェーズ |
|----------|---------------|-------------|-------|
| **CRIT-01** | DR-2.1, DR-3.1 | PID積分が蓄積されない | フェーズ1第1週 |
| **CRIT-02** | DR-2.2 | デュアルマーカー距離計算バグ | フェーズ1第1週 |
| **HIGH-01** | DR-* (全般) | 未初期化変数 | フェーズ1第1週 |
| **CRIT-03** | SR-2.2, DR-5.3 | ドッキング時のLiDARなし | フェーズ1タスク 3.2 |
| **CRIT-04** | QR-1.1, QR-1.2, QR-1.3 | テストカバレッジゼロ | フェーズ2 |
| **CRIT-05** | SR-1.2 | 緊急停止なし | フェーズ1タスク 2.2 |
| **CRIT-06** | MCR-5.1, MCR-5.2 | ティーチングモードなし | フェーズ4第13-14週 |
| **CRIT-07** | (将来) | 崖検出なし | 将来 (ハードウェア) |
| **CRIT-08** | SR-6.1 | ジオフェンシングなし | フェーズ1タスク 4.1 |
| **CRIT-09** | NR-2.2 | ホロノミックモーション無効 | フェーズ3第11週 |
| **CRIT-10** | SR-3.1 | アクションタイムアウトなし | フェーズ3第12週 |

---

## 実装ガイドのギャップ

**IMPLEMENTATION-GUIDE.mdで完全に対応されていない要件:**

| 要件 | ギャップの説明 | 推奨事項 |
|------------|-----------------|----------------|
| **DR-6.1** | アンドッキングアクション | **フェーズ3またはフェーズ4に追加** (20時間) |
| **CTR-2.2** | 検出範囲テスト | **フェーズ2に追加** (8時間) |
| **QR-3.2** | 静的解析 (cppcheck、clang-tidy) | **フェーズ2またはフェーズ3に追加** (8時間) |
| **DOCR-1.2** | キャリブレーションガイド | **フェーズ4に追加** (8時間) |
| **DOCR-2.2** | APIドキュメント (Doxygen) | **フェーズ3に追加** (8時間) |
| **SR-1.1** | ハードウェア緊急停止調査 | **フェーズ1に追加** (4時間調査) |
| **SR-4.2** | モーター故障検出検証 | **フェーズ4に追加** (TBD時間) |

**総ギャップ工数:** 約56時間 (実装ガイドを448h → 504hに増加すべき)

---

## テスト戦略サマリー

| テストタイプ | カバーする要件 | 工数 | フェーズ |
|-----------|---------------------|--------|-------|
| **ユニットテスト** | DR、MR、PR、SR、QRをカバーする40-50テスト | 60h | フェーズ2 |
| **統合テスト** | ワークフロー、安全性をカバーする10-15テスト | 30h | フェーズ2 |
| **フィールドテスト** | ドッキング精度、成功率、範囲 | 20h | フェーズ1-2 |
| **手動テスト** | ユーザーインターフェース、キャリブレーション、ドキュメント | 10h | 全フェーズ |
| **ハードウェアテスト** | モーター故障、緊急停止、センサー | 10h | フェーズ1、4 |
| **CI/CDテスト** | 自動回帰テスト | 16hセットアップ | フェーズ2 |

**総テスト工数:** 146時間

---

## フェーズ完了基準

### フェーズ1完了時:
- ✅ すべての3つのクリティカルバグ修正 (CRIT-01、CRIT-02、HIGH-01)
- ✅ 安全性監視動作 (SR-5.1、SR-5.2)
- ✅ 緊急停止実装 (SR-1.2)
- ✅ ドッキング時のLiDAR安全性 (SR-2.2)
- ✅ マスターコントロールの状態機械 (MCR-3.1)
- ✅ 基本的なジオフェンシング (SR-6.1)

**要件:** 10 | **工数:** 144h | **ステータス:** 監視下テストに安全

### フェーズ2完了時:
- ✅ 80%ユニットテストカバレッジ (QR-1.1)
- ✅ 10-15統合テスト (QR-1.2)
- ✅ CI/CDパイプライン動作 (QR-1.3)
- ✅ >95%ドッキング成功率 (QR-2.1)
- ✅ ±1mm精度検証 (QR-2.3)
- ✅ テストドキュメント完了 (DOCR-2.3)

**要件:** 6 | **工数:** 96h | **ステータス:** 検証済みプロダクション準備完了

### フェーズ3完了時:
- ✅ 4つのライフサイクルノード変換 (QR-4.1)
- ✅ QoSポリシー適用 (QR-5.1)
- ✅ REP-144へのトピック改名 (QR-7.1)
- ✅ コマンド調停動作 (MR-4.1)
- ✅ リッチアクションフィードバック (MCR-2.3)
- ✅ ホロノミックモーション有効化 (NR-2.2)
- ✅ アクションタイムアウト実施 (SR-3.1)

**要件:** 16 | **工数:** 104h | **ステータス:** ROS 2ベストプラクティス準拠

### フェーズ4完了時:
- ✅ ティーチングモード機能 (MCR-5.1、MCR-5.2)
- ✅ Dockerデプロイ準備完了 (DPR-1.1、DPR-1.2)
- ✅ 階層的設定 (LIR-2.3)
- ✅ 診断システム動作 (QR-6.1)
- ✅ ユーザーマニュアル完了 (DOCR-1.1)

**要件:** 9 | **工数:** 104h | **ステータス:** 完全にデプロイ可能なシステム

---

## 本ドキュメントの使用方法

### プロジェクトマネージャー向け:
1. **進捗追跡:** 要件ステータス列を確認
2. **タイムライン見積もり:** フェーズごとの工数時間を合計
3. **リスク特定:** クリティカル要件の❌を探す
4. **リソース計画:** 要件を開発者に割り当て

### 開発者向け:
1. **タスク検索:** 要件ID (例: DR-2.1) で検索
2. **コンテキスト取得:** 実装リファレンスリンクをクリック
3. **受け入れ基準を知る:** テスト戦略列を確認
4. **依存関係追跡:** どの要件が他をブロックしているか確認

### QAエンジニア向け:
1. **テスト計画:** テスト戦略列を使用
2. **テストケース作成:** 各要件にマッピング
3. **カバレッジ測定:** どの要件にテストがあるか追跡
4. **完了検証:** すべての受け入れ基準が満たされていることを確認

### ステークホルダー向け:
1. **スコープ理解:** 総要件数 (91) を確認
2. **完了追跡:** 現在52% (47/91)
3. **優先度レビュー:** フェーズ1 = クリティカル、フェーズ4 = 拡張
4. **予算計画:** 448h実装 + 146hテスト = 594h合計

---

## ドキュメントメンテナンス

**このドキュメントを更新するタイミング:**
- ✅ 要件ステータス変更時 (❌ → 🟡 → ✅)
- ✅ 実装フェーズシフト時
- ✅ 新要件特定時
- ✅ 工数見積もり改善時
- ✅ テスト戦略更新時

**頻度:** アクティブ開発中は週次、メンテナンス中は月次

**オーナー:** プロジェクトリード / システムアーキテクト

---

## 関連ドキュメント

- 📋 [REQUIREMENTS.md](./REQUIREMENTS.md) - 受け入れ基準を含む完全な要件詳細
- 📝 [IMPLEMENTATION-GUIDE.md](./IMPLEMENTATION-GUIDE.md) - フェーズごとの実装計画
- 🏗️ [SYSTEM-ARCHITECTURE.md](./SYSTEM-ARCHITECTURE.md) - 現在および提案されたアーキテクチャ
- 🐛 [ISSUES-AND-FIXES.md](./ISSUES-AND-FIXES.md) - 既知のバグと修正
- 🚀 [START-HERE.md](./START-HERE.md) - すべてのドキュメントのエントリーポイント

---

**最終更新日:** 2025年12月4日 | **ドキュメントバージョン:** 1.0 | **総要件数:** 91

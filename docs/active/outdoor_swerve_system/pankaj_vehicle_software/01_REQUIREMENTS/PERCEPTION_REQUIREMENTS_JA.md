# 知覚要件

**文書ID:** REQ-PERC-001
**バージョン:** 1.0
**日付:** 2025年12月15日
**ステータス:** ドラフト
**分類:** 内部

---

## 文書管理

| バージョン | 日付 | 作成者 | 変更内容 |
|---------|------|--------|---------|
| 1.0 | 2025-12-15 | 知覚リード | ParcelPalバイナリ障害物検出アーキテクチャに基づく初版知覚要件 |

---

## 1. はじめに

### 1.1 目的

本文書は、屋外優先車椅子輸送ロボットの**知覚要件**を規定します。知覚サブシステムは、センサーデータ（3D LiDAR、カメラ、IMU）を処理して障害物を検出し、ParcelPalバイナリ障害物検出アプローチ（物体分類なし、深層学習なし）に従って自律ナビゲーションをサポートします。

### 1.2 スコープ

本仕様は以下をカバーします:
- **3D LiDAR処理** - 点群フィルタリング、障害物検出（バイナリ: 障害物または自由空間）
- **カメラ処理** - 画像取得、校正、ArUcoマーカー検出サポート
- **IMU処理** - 姿勢推定、傾斜検出、センサーフュージョン
- **センサーフュージョン** - マルチセンサー統合、タイムスタンプ同期、TF2変換
- **障害物検出** - バイナリ占有グリッド、コストマップ生成（CPUベースPCL処理）
- **性能** - 処理遅延、CPU使用率、データレート

### 1.4 知覚哲学

システムは**ParcelPalバイナリ障害物検出**アプローチに従います:

**処理パイプライン:**
```
3D LiDAR点群
    ↓
地面除去（RANSAC）
    ↓
エゴ車両フィルター（ロボット点除去）
    ↓
ボクセルグリッドダウンサンプリング（0.05m）
    ↓
占有グリッド（2D: 障害物=100、自由=0）
    ↓
コストマップ（膨張半径0.5m）
    ↓
Nav2衝突チェッカー
```

**重要な洞察:** 物体分類不要！すべての障害物を同等に扱う（人=障害物、車=障害物、壁=障害物）。これによりGPU依存性と深層学習の複雑さが排除されます。

---

## 2. 3D LiDAR処理要件

### 2.1 点群取得（PERC-LIDAR-ACQ）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| PERC-LIDAR-ACQ-001 | システムは屋外グレード3D LiDAR（IP65+防水）を使用しなければならない | 必須 | ハードウェア検査 |
| PERC-LIDAR-ACQ-002 | LiDARは360°水平視野を提供しなければならない | 必須 | データシート |
| PERC-LIDAR-ACQ-003 | LiDARは≥30°垂直視野を提供しなければならない | 高 | データシート |
| PERC-LIDAR-ACQ-004 | LiDARは屋外で50-100m範囲を持たなければならない | 必須 | フィールドテスト |
| PERC-LIDAR-ACQ-005 | LiDARは最低10 Hzで動作しなければならない | 必須 | 性能テスト |
| PERC-LIDAR-ACQ-006 | LiDARは>100,000点/秒を提供しなければならない | 高 | データシート |
| PERC-LIDAR-ACQ-007 | LiDARは<±3cm範囲精度を持たなければならない | 高 | 校正テスト |
| PERC-LIDAR-ACQ-008 | システムは/pointsトピックへ点群を発行しなければならない（sensor_msgs/PointCloud2） | 必須 | トピック検査 |

**合計要件: 8**

---

## 10. 要件サマリー

### カテゴリ別要件数

| カテゴリ | 合計要件 | 必須 | 高 | 中 | 低 |
|---------|---------|------|-----|-----|-----|
| **3D LiDAR** | **36** | 23 | 11 | 2 | 0 |
| - 取得 | 8 | 6 | 2 | 0 | 0 |
| - フィルタリング | 7 | 4 | 2 | 1 | 0 |
| - 障害物検出 | 8 | 7 | 1 | 0 | 0 |
| - 占有グリッド | 7 | 3 | 3 | 1 | 0 |
| - コストマップ | 6 | 5 | 1 | 0 | 0 |
| **カメラ** | **17** | 10 | 5 | 2 | 0 |
| - 取得 | 7 | 6 | 1 | 0 | 0 |
| - 校正 | 6 | 3 | 3 | 0 | 0 |
| - 処理 | 4 | 1 | 1 | 2 | 0 |
| **IMU** | **10** | 5 | 4 | 1 | 0 |
| - 取得 | 5 | 3 | 2 | 0 | 0 |
| - 処理 | 5 | 2 | 2 | 1 | 0 |
| **センサーフュージョン** | **15** | 10 | 5 | 0 | 0 |
| - マルチセンサー | 5 | 3 | 2 | 0 | 0 |
| - TF2変換 | 6 | 5 | 1 | 0 | 0 |
| - 点群マージ | 4 | 0 | 2 | 1 | 1 |
| **性能** | **15** | 6 | 7 | 2 | 0 |
| - 遅延 | 5 | 3 | 2 | 0 | 0 |
| - CPUとメモリ | 5 | 2 | 2 | 1 | 0 |
| - データレート | 5 | 3 | 1 | 0 | 0 |
| **環境** | **9** | 2 | 6 | 1 | 0 |
| - 屋外 | 6 | 2 | 4 | 0 | 0 |
| - 屋内 | 3 | 0 | 1 | 2 | 0 |
| **統合** | **10** | 7 | 3 | 0 | 0 |
| - Nav2 | 4 | 3 | 1 | 0 | 0 |
| - ローカライゼーション | 3 | 3 | 0 | 0 | 0 |
| - ドッキング | 3 | 2 | 1 | 0 | 0 |
| **テスト** | **7** | 1 | 6 | 0 | 0 |
| - 単体テスト | 3 | 0 | 3 | 0 | 0 |
| - 統合 | 4 | 1 | 3 | 0 | 0 |
| **合計** | **119** | **64 (54%)** | **47 (39%)** | **8 (7%)** | **0 (0%)** |

**優先度分布:**
- **必須（64要件、54%）**: コア知覚機能、これなしでシステムは環境を知覚できない
- **高（47要件、39%）**: 信頼性と堅牢性に重要
- **中（8要件、7%）**: あると良い最適化
- **低（0要件、0%）**: 知覚サブシステムにはN/A

---

## 11. 受入基準

### 11.1 最小実行可能製品（MVP）

**MVP定義:** 信頼性あるバイナリ障害物検出、LiDAR + カメラ + IMU動作、<150ms遅延。

**MVP要件:**
- ✅ すべての必須要件（64合計）を満たさなければならない
- ✅ バイナリ障害物検出付き3D LiDAR動作
- ✅ ArUco検出用の2× RGBカメラ動作
- ✅ 傾斜検出用の9自由度IMU動作
- ✅ >95%障害物検出率（1000テストケース）
- ✅ <150ms LiDAR処理遅延
- ✅ <50% CPU使用率（知覚サブシステム）
- ✅ 屋外日光運用

### 11.2 製品準備完了

**製品定義:** すべての必須+高要件を満たす堅牢、全天候、24/7知覚。

**製品要件:**
- ✅ すべての必須（64）+すべての高（47）要件満足 = 111合計
- ✅ >99%障害物検出率（10,000テストケース）
- ✅ <100ms LiDAR処理遅延
- ✅ <35% CPU使用率（知覚サブシステム）
- ✅ アクティブ照明での夜間運用
- ✅ 小雨運用（<2.5mm/hr）
- ✅ 屋内反射面処理
- ✅ <5%偽陽性率
- ✅ 1000時間MTBF（平均故障間隔）

---

**文書ステータス:** ドラフト
**次回レビュー:** LiDAR選定とPCLパイプライン実装後
**承認必要:** 知覚リード、システムアーキテクト、ナビゲーションリード

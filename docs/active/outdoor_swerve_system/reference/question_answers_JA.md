# シニアレビューQ&A - 車椅子輸送ロボット

**日付:** 2025年12月15日
**目的:** シニアからのフィードバックと重要な設計決定の明確化
**ステータス:** レビュー済み、設計更新完了

---

## 重要な知見サマリー

### シニアレビューからの主要フィードバック

#### ① GPS除外（コスト制約）
**決定:** RTK-GNSS除外（$1,500-3,000削減）

**影響:**
- ✅ **コスト削減:** 大幅なコストセーブ
- ✅ **屋内性能:** 変更なし（もともとGPS不要）
- ⚠️ **屋外課題:** 純粋なSLAMに依存（GPS補正なし）

**解決策:**
- 手動SLAMマッピング（1回のみ） + NDTローカライゼーション（運用時）
- 保存マップ上でのローカライゼーション（ドリフトなし）
- ParcelPal実績アプローチ

---

#### ② コンピュートプラットフォーム: GMKtec Nucbox K6

**仕様:**
- **CPU:** AMD Ryzen 7 7840HS（8コア、16スレッド、3.8-5.1 GHz）
- **RAM:** 32GB DDR5 5600MHz
- **GPU:** Radeon 780M（統合GPU）
- **ストレージ:** 1TB PCIe 4.0 SSD

**評価:**
- ✅ **優秀なCPU:** ROS 2ノード、Nav2、SLAM処理に十分
- ✅ **十分なRAM:** 32GBは必要十分
- 🟡 **GPU制限:** 統合GPUのため深層学習不可

**GPU制約の影響:**
❌ **不可:**
- リアルタイム深層学習物体検出（YOLOv8等）
- 重い物体認識（インスタンスセグメンテーション等）

✅ **可能:**
- ArUcoマーカー検出（OpenCV - 非常に高速）
- ビジュアルSLAM（ORB、SIFT - 十分高速）
- 点群処理（CPUでPCL）
- 伝統的コンピュータビジョン

**解決策:** 深層学習を避け、伝統的CVを使用（ParcelPalアプローチ）

---

#### ③ 動作範囲: 500m-1km（200mではない）

**重要な理解:**
複数停車ルーティング = SLAM成功要因！

**例ルート（1km合計）:**
```
始点 → 停留所1 (200m) → 停留所2 (300m) → 停留所3 (250m) → 目的地 (250m)
  ↓        ↓              ↓              ↓             ↓
原点    ランドマーク1   ランドマーク2   ランドマーク3   最終停留所
  ↓        ↓              ↓              ↓             ↓
(0,0)   ループクロージャ  ループクロージャ  ループクロージャ   ドッキング
        ドリフトリセット  ドリフトリセット  ドリフトリセット
```

各停留所:
- ✅ ArUcoマーカー配置可能（絶対姿勢補正）
- ✅ ループクロージャ機会（既知エリア再訪問時）
- ✅ 累積ドリフトリセット
- ✅ セグメント管理可能（<300m各）

**評価:** 500m-1km範囲は実現可能！🟢

---

#### ④ 気象耐性: 小雨動作

**要件:**
- IP54+防水（水飛沫防護）

**防水要件:**
| コンポーネント | IP等級必要 | コスト影響 |
|-------------|----------|----------|
| GMKtec Nucbox K6 | IP54筐体 | +$200-300 |
| 3D LiDAR | IP65+（ほとんど標準） | $0 |
| カメラ | IP66ハウジング | +$100-200 |
| スワーブモーター | 密閉/保護 | +$200-400 |

**合計防水コスト:** +$600-1,300

---

#### ⑤ 物体分類なし（ParcelPalアプローチ）

**ParcelPalアプローチ:**
- ✅ 3D LiDAR → 点群 → 占有グリッド
- ✅ バイナリ分類のみ: 障害物 or 自由空間
- ✅ 人 = 障害物、車 = 障害物、壁 = 障害物
- ✅ 深層学習不要、GPU不要
- ✅ CPU処理のみ（PCL）

**システムへの影響:**
✅ **GPU制限問題解決!** Radeon 780M制限が問題にならない

**処理フロー:**
```
3D LiDAR点群
    ↓
点群フィルター（地面除去、エゴ車両除去）
    ↓
占有グリッド（2D/3D）
    ↓
コストマップ（バイナリ: 0 = 自由、100 = 障害物）
    ↓
Nav2プランナー（すべての障害物を同等に回避）
```

---

## ParcelPalマッピング戦略（重要）

### 2段階アプローチ

#### 段階1: オフラインマッピング（1回の初期設定）

```
手動遠隔操作ドライブ
    ↓
LiDARデータ + オドメトリ記録
    ↓
ループクロージャ付きSLAM
    ↓
最終マップ保存
    ↓
ウェイポイントピンポイント（停留所、充電、ドッキングゾーン）
```

#### 段階2: オンラインモード（日常運用）

```
保存マップロード
    ↓
保存マップ上でローカライゼーション（AMCLまたはスキャンマッチング）
    ↓
ウェイポイントへナビゲート
    ↓
継続的SLAM不要！（ローカライゼーションのみ）
```

**主な利点:**
- ✅ **ドリフト蓄積なし**（運用中は継続的SLAM不使用）
- ✅ **ループクロージャ不要**（運用時、マッピング時のみ）
- ✅ **再現可能、信頼性高い**（毎日同じマップ）
- ✅ **高速**（ローカライゼーション << SLAM）
- ✅ **実績あり**（ParcelPal既稼働中）

**重要な理解:**
- ❌ **ではない:** 運用中の継続的オンラインSLAM（ドリフト蓄積）
- ✅ **正しい:** 事前構築マップ + 保存マップ上ローカライゼーション（Googleマップのよう！）

---

## ドッキング戦略

### 2つのシナリオ

#### シナリオ1: ロボットがArUcoマーカー付近

```
ロボットが車椅子に近い
    ↓
カメラが既にArUcoマーカー視認
    ↓
直接ビジュアルサーボイング
    ↓
精密ドッキング（±2-5mm）
```

#### シナリオ2: ロボットがArUcoマーカーから遠い

```
ロボットが遠隔地にある
    ↓
"ドッキング接近ゾーン"へナビゲート（マップ上固定場所）
    ↓
接近ゾーンで停止（カメラ範囲内）
    ↓
ArUcoマーカー検索/検出
    ↓
ビジュアルサーボモードへ切替
    ↓
精密ドッキング（±2-5mm）
```

---

## ArUcoマーカー配置

### 配置戦略

**ドッキングステーションのみ（ルート沿いではない）:**

| 場所 | マーカー数 | 目的 |
|-----|----------|------|
| 主要車椅子ドッキング | 2個 | デュアルマーカーセンタリング |
| 充電ステーション | 2個 | デュアルマーカーセンタリング |
| バックアップドッキングポイント | 2-4個 | 冗長性 |
| **合計** | **4-8個** | コスト: ~$200-400 |

**重要:** ルート沿いにはマーカー不要！保存マップローカライゼーションがドリフトを防ぐため。

---

## TVM（Total Vehicle Management）

### 理解

**現在:**
- ログアップロードサービス（フォルダ → 中国サーバー）
- 統合不要、フォルダパスのみ指定
- TBD: 将来的なフリート管理（未定義）

**当システムへの影響:**
✅ **簡単!** ただのロギングサービス
✅ **追加コーディング不要**
✅ **ドキュメント:** 標準ROS 2ログフォルダ場所記載のみ

**ドキュメント必要事項:**
- 標準ROS 2ログ場所（~/.ros/log/）
- カスタムログフォルダ（ミッション固有ログ）
- TVMがこれらフォルダ自動監視

---

## 未定事項（TBD）

### 車椅子予約システム
**ステータス:** ⏸️ TBD - チーム議論後定義
- 予約システム設計: 未定
- Web/モバイルアプリ: 未定
- 機能（ユーザー登録、追跡、ETA）: 未定

### ロボット搭載UI仕様
**ステータス:** ⏸️ TBD - チーム議論後定義
- 場所選択リスト: 未定
- ステータス表示内容: 未定
- タッチスクリーンサイズ: 未定

### eHMI詳細
**ステータス:** ⏸️ TBD - チーム議論後定義
- LEDストリップパターン: 未定
- 音声アナウンス: 未定
- LEDスクリーンメッセージ: 未定

### 3D LiDAR選定
**ステータス:** ⏸️ TBD - 評価中

**オプション（予算非記載）:**
- Velodyne VLP-16 Lite（実績あり）
- Ouster OS1-64（高解像度）
- Livox Mid-70（ソリッドステート）
- すべてIP65+評価（小雨対応）

**要件:**
- ✅ 360°カバレッジ（または準360°）
- ✅ IP65+防水
- ✅ 範囲: 50-100m屋外
- ✅ ROS 2互換（ドライバ利用可能）

---

## 更新システム設計

### アーキテクチャ比較

| サブシステム | ParcelPal | 当システム | 変更 |
|----------|-----------|----------|------|
| 知覚 | 3D LiDAR（バイナリ障害物） | 3D LiDAR（バイナリ障害物） | ✅ 同じ |
| ローカライゼーション | 3D LiDAR SLAM | 3D LiDAR SLAM + ArUcoランドマーク | ✅ 強化 |
| ナビゲーション | Nav2（ターゲットベース） | Nav2（ターゲットベース） | ✅ 同じ |
| ドライブシステム | アッカーマン | スワーブ（ホロノミック） | 🔄 異なる（より高機能） |
| ドッキング | ❌ なし | ✅ ArUcoビジュアルサーボイング | ✅ 新規 |
| UI | タッチスクリーン + eHMI | タッチスクリーン + eHMI | ✅ 同じ |

---

## 主要設計決定

### 1. マッピング戦略

**オフライン段階:**
1. 手動遠隔操作ドライブ
2. 3D LiDARスキャン + オドメトリ + IMU記録
3. SLAM Toolbox/Cartographer（マッピングモード）
4. ループクロージャ検出 & グラフ最適化
5. 最終マップ保存
6. ウェイポイントアノテート
7. ドッキング接近ゾーンマーク

**オンライン段階:**
1. 保存マップロード
2. 3D LiDAR → 保存マップ上スキャンマッチング
3. AMCLまたはCartographerローカライゼーションモード
4. 固定マップ上姿勢推定（ドリフトなし！）
5. センサーフュージョン（オドメトリ + IMU + LiDAR）

### 2. ナビゲーション戦略

1. グローバルプランナー: A*/Dijkstra（保存マップ上）
2. ローカルプランナー: DWB（スワーブドライブ運動学）
3. コストマップ: 保存マップ + 動的障害物
4. ターゲットウェイポイントへナビゲート
5. ドッキング時"ドッキング接近ゾーン"で停止

### 3. ドッキング戦略

**モードA: ロボットがマーカー付近（カメラ範囲内）**
- 直接ビジュアルサーボイング → 精密ドッキング

**モードB: ロボットがマーカーから遠い**
- ドッキング接近ゾーンへナビゲート
- 接近ゾーン到着
- ArUcoマーカー検索（回転/スキャン）
- マーカー検出 → ビジュアルサーボモードへ切替
- 精密ドッキング（PID: X、Y、Yaw）

---

## コスト影響サマリー

| 項目 | 元見積 | 更新見積 | 変更 |
|-----|-------|---------|------|
| GPS/RTK-GNSS | $1,500-3,000 | ❌ 除外 | -$1,500〜-$3,000 ✅ |
| 防水（小雨） | $0（乾燥のみ） | $600-1,300 | +$600-1,300 ⚠️ |
| ArUcoランドマーク | 含む | $200-400（4-8個） | 最小限 |
| **正味変更** | - | - | **-$400〜-$1,100 ✅** |

**全体:** GPS除外による大幅コストセーブ！

---

## 最終推奨

### ✅ 更新設計で進行！

**理由:**
1. ✅ 実績ある参照（ParcelPal） - ゼロから開始せず
2. ✅ GPUボトルネックなし - バイナリ障害物検出、DL不要
3. ✅ 複数停車ルーティング - 500m-1km SLAM管理可能
4. ✅ コストセーブ - GPS除外が防水コストを相殺
5. ✅ 明確要件 - ParcelPalアーキテクチャがテンプレート提供

**重要成功要因:**
1. 🔴 **クリティカル:** 優秀SLAM（SLAM Toolbox + ループクロージャ + チューニング）
2. 🟡 **重要:** 各停留所ArUcoランドマーク（姿勢補正）
3. 🟡 **重要:** 複数停車ルーティング戦略（セグメント<300m）
4. 🟡 **重要:** IP54+防水（小雨）
5. 🟢 **あると良い:** 車椅子予約システム（スコープ内の場合）

---

**ドキュメントステータス:** レビュー済み
**次回レビュー:** ParcelPal深掘り前
**バージョン履歴:**
- v1.0 (2025-12-15): シニアレビューQ&A初版

# ParcelPalシステム探索サマリー

**日付:** 2025年12月15日
**目的:** 屋外優先車椅子輸送ロボットドキュメンテーションのための実績あるアーキテクチャ理解
**ソース:** /home/pankaj/autoware.FTD/ (ParcelPal自律配送ロボット)

---

## エグゼクティブサマリー

ParcelPalは **Autowareフレームワーク** ベースの **ROS 2 Humble** 上で動作する製品準備完了自律配送ロボットです。本システムは、**1回の手動SLAMマッピング** 後に運用モード中は **NDTスキャンマッチャーローカライゼーション** を使用する屋外自律ナビゲーションの実績あるアーキテクチャを示します。このアプローチはドリフト蓄積を排除し、GPSなしで信頼性の高い500m-1km範囲動作を可能にします。

**重要な洞察:** ParcelPalは運用中に継続的オンラインSLAMを使用**しません**。マップはループクロージャ付きでオフライン作成され、その後ロボットはNDTスキャンマッチングを使用して保存マップ上でローカライズします。

---

## 1. システムアーキテクチャ概要

車椅子ロボットのために **60-70%再利用可能** な実績あるParcelPalアーキテクチャ:

- **ローカライゼーション:** NDTスキャンマッチャー（100%再利用）
- **経路計画:** Nav2（90%再利用、スワーブドライブ適応必要）
- **知覚:** LiDARバイナリ検出（100%再利用）
- **UI:** React + Next.js（70%再利用、車椅子予約フロー追加）
- **eHMI:** ESP32-S3（90%再利用、車椅子状態21-28追加）
- **オーケストレーション:** Python状態機械（80%再利用、ドッキング状態追加）

---

## 2. マッピング & ローカライゼーション戦略（重要）

### 2段階アプローチ

**段階1: オフラインマッピング（1回のセットアップ）**
```
手動SLAMマッピング → ループクロージャ → マップ保存 → 停止場所定義
```

**段階2: オンラインローカライゼーション（運用モード）**
```
NDTスキャンマッチャー → 保存マップ上でローカライゼーション → ドリフト蓄積なし
```

**主な利点:**
- ✅ 時間経過によるドリフトなし（マップは固定基準）
- ✅ 500m-1km範囲達成可能
- ✅ 再現可能、決定論的パス
- ✅ オンラインSLAMより低計算コスト
- ✅ 製品での実績ある信頼性

---

## 3. 再利用マトリクス

| コンポーネント | ParcelPal再利用率 | 適応内容 | 新規開発 |
|------------|----------------|---------|---------|
| **Autoware Localization** | 100% | 設定調整のみ | なし |
| **Autoware Planning** | 90% | スワーブドライブ運動学 | スワーブIK |
| **Autoware Perception** | 100% | パラメータチューニング | ArUco検出 |
| **ftd_master** | 80% | 車椅子状態追加 | ドッキングロジック |
| **UI Framework** | 70% | 予約フロー | 車椅子予約UI |
| **eHMI** | 90% | 新規状態21-28 | 車椅子音声 |

---

## 4. 主要な知見

### マッピング戦略
✅ **実行:** 手動SLAM 1回 + NDTローカライゼーション
❌ **実行しない:** 継続的オンラインSLAM
**理由:** ドリフト防止、再現性、計算効率

### GPS依存
✅ **実行:** GPS不要の500m-1km範囲動作
❌ **実行しない:** RTK GPSやビーコン依存
**理由:** コスト削減、NDT信頼性、<1km範囲で十分

### 新規開発フォーカス
**集中領域:**
- スワーブドライブコントローラ（ParcelPalは差動駆動）
- 車椅子ドッキングサブシステム（ArUco + ビジュアルサーボイング）
- 乗客安全監視（新規安全要件）

**再利用領域:**
- Autowareナビゲーションスタック
- UIフレームワーク
- eHMIコントローラ
- メインオーケストレーションパターン

---

**ドキュメントステータス:** 完了
**バージョン履歴:**
- v1.0 (2025-12-15): ParcelPal探索初版サマリー

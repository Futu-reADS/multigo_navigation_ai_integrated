# チーム責任範囲 - マルチチーム開発

**文書ID:** DOC-TEAM-001
**バージョン:** 1.0
**日付:** 2025年12月16日
**ステータス:** 有効

---

## エグゼクティブサマリー

本文書は、車椅子搬送ロボットプロジェクトにおける3つの開発チームの**明確なスコープ分離**を定義します:

1. **チーム1:** Pankaj（車体ソフトウェア） - 自律ナビゲーション、ドッキング、ローカルUI、TVMクライアント
2. **チーム2:** Unno（フリート管理） - TVMサーバー、ダッシュボード、予約システム、ユーザー管理
3. **チーム3:** Tsuchiya + Kiril（ハードウェア） - 機械、電気、外装ハードウェア組立

**重要なインターフェース（Week 1で定義）:**
- 車体 ↔ TVMサーバー: `TVM_API_SPECIFICATION.md` ⚠️ **CRITICAL**
- ソフトウェア ↔ ハードウェア: `HARDWARE_SOFTWARE_INTERFACES.md` ⚠️ **CRITICAL**

---

## チーム1: Pankaj（車体ソフトウェア）

### 主要責任
**車体側自律ソフトウェアとTVMクライアントインターフェース**

### 詳細スコープ

#### **1.1 自律ナビゲーション（Week 8-12）**
**責任:** 100% Pankaj
- NDTスキャンマッチャーローカリゼーション（±10cm精度）
- Nav2統合（パスプランニング、軌道追従）
- マルチウェイポイントナビゲーション
- ルート実行と復旧
- 運用時間管理

**成果物:**
- ROS 2パッケージ: `ndt_localization`、`nav_controller`、`waypoint_manager`
- ナビゲーションスタック用起動ファイル
- 設定ファイル（コストマップ、プランナーパラメータ）
- 単体 + 統合テスト

**依存関係:**
- ハードウェア: LiDAR、IMU、ホイールエンコーダー（Tsuchiya）
- マップ: 事前構築SLAMマップ（手動マッピングフェーズ）

---

#### **1.2 車椅子ドッキング（Week 13-16）**
**責任:** 100% Pankaj
- ArUcoマーカー検出（OpenCV）
- デュアルカメラ融合
- ビジュアルサーボイング制御（PID）
- ドッキングステートマシン
- 精密接続（±2-5mm）

**成果物:**
- ROS 2パッケージ: `aruco_detector`、`docking_controller`、`visual_servoing`
- ArUcoマーカー仕様（サイズ、ID、配置）
- キャリブレーション手順
- ドッキング成功指標（>90%成功率）

**依存関係:**
- ハードウェア: 2×RGBカメラ、車椅子ドッキング機構（Tsuchiya）
- マーカー: ArUcoマーカー印刷・取付（ハードウェアチーム）

---

#### **1.3 スワーブドライブ制御（Week 4-8）**
**責任:** 100% Pankaj
- 逆運動学（Twist → ホイールコマンド）
- 順運動学（エンコーダー → オドメトリ）
- Nav2コントローラープラグイン
- モーターコマンドインターフェース（CANバス）

**成果物:**
- ROS 2パッケージ: `swerve_drive_controller`
- 運動学モデル実装
- コントローラーパラメータ（PIDゲイン、速度制限）
- オドメトリパブリッシャー

**依存関係:**
- ハードウェア: 4×スワーブモジュール、エンコーダー、モーターコントローラー（Tsuchiya）
- CANバスインターフェース設定済み

---

#### **1.4 知覚（Week 9-12）**
**責任:** 100% Pankaj
- LiDAR点群処理
- 地面除去（RANSAC）
- 障害物検出（バイナリコストマップ）
- センサー融合（LiDAR + IMU）

**成果物:**
- ROS 2パッケージ: `pcl_processor`、`obstacle_detector`、`ground_removal`
- コストマップ統合（ローカル + グローバル）
- 性能最適化（CPUのみ、GPU不要）

**依存関係:**
- ハードウェア: 3D LiDAR、IMU（Tsuchiya）

---

#### **1.5 安全システム（Week 15-18）**
**責任:** 100% Pankaj
- 緊急停止処理
- 衝突検出（バンパーセンサー）
- ウォッチドッグ監視
- ヘルスチェック（センサー故障）
- 傾き検出（IMU）

**成果物:**
- ROS 2パッケージ: `safety_monitor`
- 安全ステートマシン
- 診断アグリゲーター
- フェールセーフ動作

**依存関係:**
- ハードウェア: 非常停止ボタン、バンパーセンサー、IMU（Tsuchiya）

---

#### **1.6 ローカルUI（Week 17-20）**
**責任:** 100% Pankaj
- タッチスクリーンインターフェース（React + Next.js）
- rosbridge WebSocket接続
- ミッション制御（目的地選択、開始/キャンセル）
- ステータスダッシュボード（バッテリー、位置、状態）
- 多言語サポート（EN/JA/ZH）

**成果物:**
- Next.jsウェブアプリケーション
- キオスクモード展開スクリプト
- UI/UXデザイン（レスポンシブ、アクセシブル）
- Chromiumキオスク設定

**依存関係:**
- ハードウェア: タッチスクリーン、マウント（Tsuchiya）

---

#### **1.7 eHMI統合（Week 19-21）**
**責任:** 80% Pankaj（ROS 2統合）、20% Kiril（ファームウェア）
- ROS 2 → ESP32シリアルブリッジ
- 状態管理（車体状態 → eHMI状態）
- オーディオコマンドインターフェース
- 言語/音量設定

**成果物:**
- ROS 2パッケージ: `ehmi_interface`
- シリアルプロトコル実装
- 状態マッピング（車体状態0-50）

**依存関係:**
- ハードウェア: ESP32-S3、LED、スピーカー（Kiril）
- ファームウェア: ESP32ファームウェア（Kiril - セクション3.3参照）

---

#### **1.8 TVMクライアントインターフェース（Week 20-22）⚠️ 新規**
**責任:** 100% Pankaj
- REST APIクライアント（位置、ステータス、バッテリー、エラー報告）
- WebSocketクライアント（コマンド受信: 配車、キャンセル、緊急停止）
- JWT認証
- オフラインキュー管理（最大1000メッセージ）
- 再接続時の一括アップロード

**成果物:**
- ROS 2パッケージ: `tvm_client`
- TVMクライアントライブラリ（C++またはPython）
- 設定（TVMサーバーURL、認証情報）
- モックTVMサーバーとの統合テスト

**依存関係:**
- **インターフェース仕様:** `TVM_API_SPECIFICATION.md` ⚠️ **CRITICAL**
- **データモデル:** `TVM_DATA_MODELS.md`
- フリート管理チーム: TVMサーバーAPI（Unno）

---

### 開発タイムライン（Pankaj）
**合計:** 32週間（8ヶ月、単独開発者 + AI支援）

| スプリント | 週 | サブシステム | ステータス |
|-----------|-------|-----------|--------|
| 1-2 | 1-4 | スワーブドライブ | ハードウェア改造並行 |
| 3-4 | 5-8 | ナビゲーション | - |
| 5-6 | 9-12 | 知覚 | - |
| 7-8 | 13-16 | ドッキング | - |
| 9-10 | 15-18 | 安全性 | ドッキングと重複 |
| 11-12 | 17-20 | UI | 安全性と重複 |
| 13 | 19-21 | eHMI | UIと重複 |
| 14-15 | 20-22 | TVMクライアント | 統合 |
| 16-17 | 21-24 | システム統合 | 全チーム |

---

### ツールと技術（Pankaj）
- **OS:** Ubuntu 22.04 LTS
- **ミドルウェア:** ROS 2 Humble
- **言語:** C++（制御、知覚）、Python（スクリプト、ツール）
- **ナビゲーション:** Nav2 + NDTスキャンマッチャー
- **ビジョン:** OpenCV、ArUco
- **UI:** React 18、Next.js 14、TypeScript
- **TVMクライアント:** Python（requests、websockets）またはC++（libcurl、Boost.Beast）
- **テスト:** pytest、gtest、統合テスト
- **AIツール:** Claude Code、GitHub Copilot（生産性2-3倍向上）

---

## チーム2: Unno（フリート管理 / TVMサーバー）

### 主要責任
**TVMサーバーバックエンド、フリート管理ダッシュボード、予約システム**

### 詳細スコープ

#### **2.1 TVMサーバーバックエンド（Week 2-4）**
**責任:** 100% Unno
- REST APIサーバー（7エンドポイント - TVM_API_SPECIFICATION.md参照）
- WebSocketサーバー（リアルタイムコマンド）
- JWT認証
- レート制限
- データベース統合
- ログとメトリクス

**成果物:**
- バックエンドサーバー（Node.js/Python/Java - Unno決定）
- `TVM_API_SPECIFICATION.md`に準拠したAPI実装
- データベーススキーマ（PostgreSQL/MySQL/MongoDB - Unno決定）
- 展開スクリプト（Docker、Kubernetes、またはVM）

**依存関係:**
- **インターフェース仕様:** `TVM_API_SPECIFICATION.md` ⚠️ **CRITICAL**
- **データモデル:** `TVM_DATA_MODELS.md`
- 車体チーム: TVMクライアント実装（Pankaj）

---

#### **2.2 フリート管理ダッシュボード（Week 5-8）**
**責任:** 100% Unno
- リアルタイム車両追跡（マップビュー）
- フリート全体のバッテリー監視
- ルート可視化
- アラート管理
- 緊急制御（リモート緊急停止）

**成果物:**
- ウェブアプリケーション（React/Vue/Angular - Unno決定）
- マップ統合（Google Maps、Mapbox、OpenStreetMap）
- リアルタイムWebSocket更新（1Hz車両位置）
- ダッシュボードUI/UXデザイン

**依存関係:**
- TVMサーバーバックエンド（セクション2.1）
- 車両テレメトリーデータ（PankajのTVMクライアント）

---

#### **2.3 予約システム（Week 6-10）**
**責任:** 100% Unno
- 歩行支援予約（介護者役割）
- 薬配送スケジューリング（看護師役割 - Ver2）
- ロボット配車アルゴリズム
- キュー管理
- 競合解決

**成果物:**
- 予約サービス（バックエンド）
- 予約インターフェース（ウェブUI）
- 配車アルゴリズム（最寄り利用可能ロボット）
- スケジュール管理

**依存関係:**
- TVMサーバーバックエンド（セクション2.1）

---

#### **2.4 ユーザー権限管理（Week 8-10）**
**責任:** 100% Unno
- 認証（ユーザー名/パスワード）
- 認可（RBAC: 管理者、介護者、看護師）
- ユーザーCRUD操作
- 権限管理

**成果物:**
- 認証サービス
- ロールベースアクセス制御（RBAC）
- 管理者ユーザー管理インターフェース

**依存関係:**
- TVMサーバーバックエンド（セクション2.1）

---

#### **2.5 音声通信システム（Week 11-14）**
**責任:** 100% Unno
- VoIP統合（Twilio、WebRTC、またはカスタム）
- スタッフ ↔ ロボット音声通話
- ダッシュボードからの通話開始
- オーディオストリーミング

**成果物:**
- VoIPサービス統合
- オーディオストリーミングインフラ
- ダッシュボード内通話UI

**依存関係:**
- TVMサーバーバックエンド（セクション2.1）
- ハードウェア: 車両上のマイク + スピーカー（Kiril）

---

#### **2.6 ログ管理（Week 12-14）**
**責任:** 100% Unno
- 車両ログ集約
- S3統合（アップロードログ表示）
- ダッシュボード内ログビューアー

**成果物:**
- ログ閲覧インターフェース
- 既存`tvm_upload`デーモンとの統合（別システム）

**依存関係:**
- 既存`tvm_upload`デーモン（既実装、別個）
- S3バケットアクセス（AWS China）

---

### 開発タイムライン（Unno）
**合計:** 12-16週間（Pankajの車体開発と並行）

| 週 | サブシステム | 成果物 |
|------|-----------|-------------|
| 1-2 | インターフェース定義 | TVM_API_SPECIFICATION.md承認 |
| 2-4 | TVMサーバーバックエンド | REST + WebSocket API |
| 5-8 | フリートダッシュボード | リアルタイム監視 |
| 6-10 | 予約システム | 予約 + 配車 |
| 8-10 | ユーザー管理 | 認証 + RBAC |
| 11-14 | 音声通信 | VoIP統合 |
| 12-14 | ログ管理 | ログビューアー |
| 15-16 | 統合テスト | 車両とのエンドツーエンド |

---

### ツールと技術（Unno - 決定予定）
**Unnoチームが決定:**
- **バックエンド:** Node.js（Express/NestJS）、Python（FastAPI/Django）、Java（Spring Boot）
- **データベース:** PostgreSQL、MySQL、MongoDB
- **フロントエンド:** React、Vue、Angular
- **リアルタイム:** WebSocket、Socket.io、Server-Sent Events
- **展開:** Docker、Kubernetes、AWS/Azure/GCP
- **VoIP:** Twilio、WebRTC、Asterisk

---

## チーム3: Tsuchiya + Kiril（ハードウェア）

### 主要責任
**物理的ロボット組立、電気統合、外装コンポーネント**

### 3.1 Tsuchiya（機械と電気）

#### **3.1.1 機械構造（Week 2-6）**
**責任:** 100% Tsuchiya
- シャーシ設計と製作
- スワーブドライブモジュール組立（4×モジュール）
- 車椅子ドッキング機構（物理接続、ロック）
- センサー取付（LiDAR、カメラ、IMU）
- 防水防塵（IP54+シーリング）

**成果物:**
- 組立済みロボットプラットフォーム
- スワーブドライブモジュール設置・校正済み
- ドッキング機構動作確認
- BOM（部品表）
- 組立手順書
- CADファイル（オプション、参照用）

**依存関係:**
- ソフトウェア: ROS 2インターフェース仕様（Pankaj - HARDWARE_SOFTWARE_INTERFACES.md参照）

---

#### **3.1.2 電気システム（Week 4-8）**
**責任:** 100% Tsuchiya
- 電源分配（48Vバッテリー、BMS、ヒューズ）
- モーターコントローラー（4×駆動 + 4×操舵、CANバス）
- ワイヤーハーネス（センサー、モーター、電源）
- ケーブル管理とストレインリリーフ
- 安全回路（非常停止をモーターに直結）

**成果物:**
- 完全電気システム
- 配線図
- 電源分配回路図
- BMS設定済み（CANバスインターフェース）
- すべてのケーブルにラベル付け

**依存関係:**
- ソフトウェア: CANバスプロトコル（Pankaj - HARDWARE_SOFTWARE_INTERFACES.md参照）

---

#### **3.1.3 センサー統合（Week 6-10）**
**責任:** 100% Tsuchiya
- LiDAR設置（IP65+屋外LiDAR）
- カメラ設置（2×RGB、防水ハウジング）
- IMU設置（重心、軸整列）
- ホイールエンコーダー（4×駆動 + 4×操舵）
- 安全センサー（バンパー、乗客重量、非常停止）
- バッテリー監視（CANインターフェース付きBMS）

**成果物:**
- すべてのセンサー設置・動作確認
- ROS 2ドライバーテスト済み（データ配信）
- センサー校正（カメラ: チェスボード、IMU: 磁力計）
- 静的TF変換文書化（センサー位置）

**依存関係:**
- ソフトウェア: ROS 2センサードライバー（Pankaj）
- 校正: カメラ校正手順（Pankaj + Tsuchiya共同）

---

### 3.2 Kiril（外装コンポーネント）

#### **3.2.1 eHMIシステム（Week 8-12）**
**責任:** 100% Kiril（ハードウェア + ファームウェア）
- ESP32-S3マイコンボード
- WS2812B LEDストリップ（2-3メートル、≥60 LEDs/メートル）
- HUB75 LEDマトリックス（オプション、64×32または128×64）
- I2Sオーディオアンプ（MAX98357Aまたは類似）
- スピーカー（≥5W、防水）
- SDカード（≥2GB、オーディオファイル用）
- メインコンピューターへのUARTインターフェース

**成果物:**
- eHMIハードウェア組立済み
- ESP32ファームウェア（ステートマシン、LEDパターン、オーディオ再生）
- オーディオファイル（EN/JA/ZHアナウンス）
- シリアルプロトコル実装（HARDWARE_SOFTWARE_INTERFACES.md参照）

**依存関係:**
- ソフトウェア: ROS 2 eHMIインターフェース（Pankaj - セクション1.7）
- オーディオファイル: 事前録音オーディオ（Kiril調達またはPankaj提供）

**ファームウェア責任:** 100% Kiril
- シリアルプロトコル実装（UART、115200ボー）
- ステートマシン（状態0-50受信、LED + オーディオ更新）
- LEDパターン（WS2812B制御、FastLEDライブラリ）
- オーディオ再生（I2S、SDカードからMP3/WAV再生）

**参照:** `EHMI_SYSTEM_REFERENCE.md`参照（既存ParcelPal eHMI文書）

---

#### **3.2.2 外装パネルと外観（Week 10-14）**
**責任:** 100% Kiril
- ボディパネル（防水防塵、IP54+）
- 塗装/仕上げ
- ブランディング（ロゴ、ラベル）
- 照明（ヘッドライト、テールライト、インジケーター）

**成果物:**
- 完成した外装
- 防水防塵検証（雨テスト）
- プロフェッショナルな外観

---

#### **3.2.3 乗客安全ハードウェア（Week 12-14）**
**責任:** 100% Kiril
- シートベルトシステム（車椅子接続に該当する場合）
- 手すり
- フットレスト
- 安全ラベルと説明書

**成果物:**
- 安全機能設置済み
- 乗客安全テスト済み

---

### 開発タイムライン（Tsuchiya + Kiril）
**合計:** ソフトウェアと並行（スプリント毎に必要に応じてハードウェア準備）

| 週 | Tsuchiya（機械/電気） | Kiril（外装） |
|------|----------------------|------------------|
| 1-2 | インターフェース承認 | インターフェース承認 |
| 2-6 | 機械構造、スワーブ組立 | - |
| 4-8 | 電気システム、電源分配 | - |
| 6-10 | センサー統合、校正 | - |
| 8-12 | - | eHMIハードウェア + ファームウェア |
| 10-14 | 最終組立、テスト | 外装パネル、照明 |
| 12-14 | - | 乗客安全ハードウェア |
| 15-16 | システム統合（全チーム） | システム統合 |

---

### ツールと技術（ハードウェア）
**Tsuchiya:**
- 機械: CADソフトウェア（SolidWorks、Fusion 360）、加工ツール
- 電気: 配線、CANバスツール、マルチメーター、オシロスコープ
- ソフトウェア: ROS 2ドライバー設定、CANバステスト

**Kiril:**
- 組込: Arduino IDE（ESP32）、FastLEDライブラリ、ESP32-AudioI2S
- ハードウェア: はんだ付け、LED設置、オーディオアンプセットアップ
- テスト: シリアルモニター、オーディオ再生テスト

---

## インターフェース所有マトリックス

| インターフェース | 所有者1 | 所有者2 | 文書 | ステータス |
|-----------|---------|---------|----------|--------|
| **車体 ↔ TVMサーバー** | Pankaj（クライアント） | Unno（サーバー） | TVM_API_SPECIFICATION.md | ✅ Week 1 |
| **ソフトウェア ↔ ハードウェア** | Pankaj（ROS 2） | Tsuchiya（センサー/モーター） | HARDWARE_SOFTWARE_INTERFACES.md | ✅ Week 1 |
| **ソフトウェア ↔ eHMI** | Pankaj（ROS 2ブリッジ） | Kiril（ESP32ファームウェア） | HARDWARE_SOFTWARE_INTERFACES.md（セクション4.1） | ✅ Week 1 |
| **TVM ↔ データベース** | Unno | Unno（内部） | DATABASE_SCHEMA.md | Week 2 |

---

## 意思決定権限

| 意思決定タイプ | 所有者 | 要相談 |
|---------------|-------|----------------------|
| 車体ソフトウェアアーキテクチャ | Pankaj | なし（単独決定） |
| TVMサーバー技術スタック | Unno | なし（Unno決定） |
| ハードウェアコンポーネント選定 | Tsuchiya + Kiril | Pankaj（互換性確認） |
| APIインターフェース変更 | Pankaj + Unno | **両者合意必須** ⚠️ |
| ROS 2トピック変更 | Pankaj + Tsuchiya | **両者合意必須** ⚠️ |
| 予算配分 | プロジェクトマネージャー | 全チーム（意見提供） |

---

## コミュニケーションプロトコル

### 週次同期ミーティング
**参加者:** Pankaj + Unno + Tsuchiya + Kiril
**時間:** 30分
**議題:**
1. 進捗報告（各チーム5分）
2. 障害と依存関係（10分）
3. 次週の優先事項（5分）

### インターフェースレビュー
**Week 1:** インターフェース仕様承認（TVM API + ハードウェアインターフェース）
**Week 8:** プロジェクト中間統合確認
**Week 16:** 最終統合テスト

### 問題エスカレーション
**レベル1:** チーム間直接コミュニケーション（メール、チャット）
**レベル2:** 週次同期ミーティング
**レベル3:** プロジェクトマネージャー（進捗を妨げている場合）

---

## 紛争解決

**インターフェース設計でチームが不一致の場合:**
1. 両チームが提案を文書化（利点/欠点）
2. 週次同期ミーティングでレビュー
3. 技術的メリットで決定（性能、保守性、安全性）
4. 合意に至らない場合、プロジェクトマネージャーが最終決定

**例:** Pankajがテレメトリ頻度を1Hzから2Hzに変更したい場合:
- Pankajが理由を文書化（より高い更新レートが必要）
- Unnoがサーバー負荷への影響を評価
- 両者が妥協案に合意、または一方が技術的根拠を提示
- 決定をインターフェース仕様に文書化（バージョン更新）

---

## 成功基準

**チーム1（Pankaj）成功:**
- ✅ 車両が自律ナビゲート（500m-1km範囲）
- ✅ ドッキング精度（±5mm、>90%成功率）
- ✅ TVMクライアント動作（1Hzテレメトリー、コマンド受信）
- ✅ すべてのROS 2ノード動作
- ✅ ローカルUI動作（タッチスクリーン）

**チーム2（Unno）成功:**
- ✅ TVMサーバー動作（10台の車両を1Hzで処理）
- ✅ フリートダッシュボード動作（リアルタイム監視）
- ✅ 予約システム動作（予約 + 配車）
- ✅ ユーザー管理動作（認証 + RBAC）

**チーム3（Tsuchiya + Kiril）成功:**
- ✅ ロボット組立完了（スワーブドライブ動作）
- ✅ すべてのセンサー動作（LiDAR、カメラ、IMU、エンコーダー）
- ✅ 電源システム動作（バッテリー、BMS、充電）
- ✅ eHMI動作（LED + オーディオ）
- ✅ 防水防塵検証（IP54+）

**システム統合成功（全チーム）:**
- ✅ エンドツーエンドミッション完了（TVM配車 → ナビゲーション → ドッキング → 帰還）
- ✅ >90%ミッション成功率
- ✅ すべてのインターフェース動作
- ✅ 安全システム検証済み

---

## 文書ステータス

**ステータス:** 有効
**保守担当:** プロジェクトマネージャー
**レビュー頻度:** 月次（またはチーム構造変更時）
**最終更新:** 2025年12月16日

---

**書類終了**

# システム要件 - 車椅子輸送ロボット

**プロジェクト:** 屋外優先車椅子輸送ロボット（スワーブドライブ）
**ドキュメントタイプ:** システム要件仕様書（SRS）
**ステータス:** ドラフト v1.0
**日付:** 2025年12月15日
**参照アーキテクチャ:** ParcelPal配送ロボット（Autowareベース）

---

## 1. 機能要件

### 1.1 自律ドッキング (DOCK-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| DOCK-001 | システムはLiDARを使用して10m以内の車椅子を自律検出すること | 最重要 | 統合テスト |
| DOCK-002 | システムは0.5-5m範囲でArUcoマーカーを検出すること | 最重要 | ユニットテスト |
| DOCK-003 | システムは屋外で±2-5mmのドッキング精度を達成すること | 最重要 | フィールドテスト（100回） |
| DOCK-004 | システムは屋内で±1mmのドッキング精度を達成すること（目標） | 高 | 実験室テスト |
| DOCK-005 | システムは2段階ドッキングを実行すること（粗ナビ + 精密サーボイング） | 最重要 | 統合テスト |
| DOCK-006 | システムは接続済みとマークする前に機械的結合を確認すること | 最重要 | ユニットテスト |
| DOCK-007 | システムは5°超勾配ではドッキングを試みないこと | 最重要 | 安全テスト |
| DOCK-008 | システムは失敗時に最大3回ドッキングを再試行すること | 中 | 統合テスト |
| DOCK-009 | システムは3回試行後も失敗した場合はドッキングを中止すること | 最重要 | 失敗テスト |
| DOCK-010 | システムは最低10HzでArUcoマーカー追跡を維持すること | 高 | 性能テスト |

**成功基準:** 屋外条件で95%超のドッキング成功率

### 1.2 自律ナビゲーション (NAV-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| NAV-001 | システムは保存マップ + NDTローカライゼーションで自律ナビゲートすること | 最重要 | 統合テスト |
| NAV-002 | システムは500m超で±10cm位置精度を達成すること（GPS不要） | 最重要 | フィールドテスト |
| NAV-003 | システムは複数ウェイポイントミッション（最大10停車）をサポートすること | 高 | 統合テスト |
| NAV-004 | システムは障害物検出から2秒以内に経路を再計画すること | 最重要 | 性能テスト |
| NAV-005 | システムは100kg荷重で最大10°勾配で動作すること | 最重要 | フィールドテスト |
| NAV-006 | システムは静的障害物（壁、縁石）を検出・回避すること | 最重要 | 安全テスト |
| NAV-007 | システムは動的障害物（人、車両）を検出・回避すること | 最重要 | 安全テスト |
| NAV-008 | システムは歩行者から1.5m距離を維持すること | 最重要 | 安全テスト |
| NAV-009 | システムは混雑エリアで0.5 m/sに減速すること | 高 | フィールドテスト |
| NAV-010 | システムはバッテリー<30%時に充電ステーションに帰還すること | 最重要 | 統合テスト |
| NAV-011 | システムは屋内/屋外遷移を自動的に処理すること | 高 | フィールドテスト |
| NAV-012 | システムは500m-1km範囲を確実にナビゲートすること | 最重要 | 耐久テスト |

**成功基準:** 1000kmテスト走行で衝突ゼロ

### 1.3 乗客安全 (SAFE-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| SAFE-001 | システムは輸送前に乗客存在を検出すること | 最重要 | ユニットテスト |
| SAFE-002 | システムは乗客乗車時に1.0 m/sを超えないこと | 最重要 | 安全テスト |
| SAFE-003 | システムは乗客乗車時に加速度を0.5 m/s²に制限すること | 最重要 | 快適性テスト |
| SAFE-004 | システムは緊急ボタン押下時に1.5m以内で停止すること | 最重要 | 安全テスト |
| SAFE-005 | システムは100ms以内に緊急停止に応答すること | 最重要 | 性能テスト |
| SAFE-006 | システムは5°超勾配で車椅子をピックアップしないこと | 最重要 | 安全テスト |
| SAFE-007 | システムは傾斜角を連続的に監視すること（最低10Hz） | 最重要 | 性能テスト |
| SAFE-008 | システムは予期せず傾斜が15°を超えた場合停止すること | 最重要 | 安全テスト |
| SAFE-009 | システムは移動前に車椅子接続を確認すること | 最重要 | ユニットテスト |
| SAFE-010 | システムは輸送中に在席状態を監視すること | 最重要 | 安全テスト |
| SAFE-011 | システムは移動前に音声警告を提供すること | 高 | フィールドテスト |
| SAFE-012 | システムはジオフェンシング（進入禁止エリア）を強制すること | 高 | 統合テスト |
| SAFE-013 | システムはセンサー故障時にフェイルセーフ（停止）すること | 最重要 | 失敗テスト |
| SAFE-014 | システムは冗長緊急停止（HW + SW）を持つこと | 最重要 | 安全テスト |

**成功基準:** 1000輸送ミッションで安全インシデントゼロ

### 1.4 手動制御 (MANUAL-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| MANUAL-001 | システムはジョイスティック遠隔操作をサポートすること | 高 | ユーザテスト |
| MANUAL-002 | システムは自律モードの手動オーバーライドを許可すること | 最重要 | 統合テスト |
| MANUAL-003 | システムは手動速度を1.0 m/sに制限すること | 高 | 安全テスト |
| MANUAL-004 | システムはティーチングモードでウェイポイント記録すること | 中 | 統合テスト |
| MANUAL-005 | システムはリクエストから500ms以内に手動モードに切替えること | 高 | 性能テスト |

### 1.5 ユーザインターフェース (UI-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| UI-001 | システムは車椅子予約用のタッチスクリーンインターフェースを提供すること | 高 | ユーザテスト |
| UI-002 | システムは英語、日本語、中国語をサポートすること | 高 | ユーザテスト |
| UI-003 | システムはリアルタイムロボット状態と位置を表示すること | 高 | 統合テスト |
| UI-004 | システムは輸送中にETAを表示すること | 中 | 統合テスト |
| UI-005 | システムは歩行者認識用のeHMI（LED + 音声）を提供すること | 最重要 | フィールドテスト |
| UI-006 | システムは状態変化を音声でアナウンスすること（多言語） | 高 | ユーザテスト |
| UI-007 | システムはバッテリーレベルと充電状態を表示すること | 中 | ユニットテスト |

---

## 2. 非機能要件

### 2.1 性能 (PERF-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| PERF-001 | システムは乗客輸送で4時間以上のバッテリー寿命を達成すること | 高 | 耐久テスト |
| PERF-002 | システムは60秒以内にドッキングを完了すること（接近から接続） | 高 | 性能テスト |
| PERF-003 | システムは最低10HzでLiDARデータを処理すること | 最重要 | 性能テスト |
| PERF-004 | システムは最低15Hzでカメラフレームを処理すること | 高 | 性能テスト |
| PERF-005 | システムは0.5秒以内に障害物に応答すること | 最重要 | 性能テスト |
| PERF-006 | システムは90秒以内に動作状態に起動すること | 中 | ユニットテスト |
| PERF-007 | システムは通常動作中CPU使用率を70%未満に維持すること | 中 | 性能テスト |
| PERF-008 | システムは10Hzのローカライゼーション更新レートを維持すること | 最重要 | 性能テスト |

### 2.2 信頼性 (REL-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| REL-001 | システムは98%超の稼働率を達成すること（メンテナンス除く） | 高 | フィールドテスト（30日間） |
| REL-002 | システムはセンサーグリッチから自動的に回復すること | 高 | 失敗テスト |
| REL-003 | システムは非重要センサー故障時に段階的に機能低下すること | 高 | 失敗テスト |
| REL-004 | システムはハードウェア故障を検出・報告すること | 最重要 | ユニットテスト |
| REL-005 | システムは保存マップの整合性を維持すること（チェックサム） | 高 | ユニットテスト |

### 2.3 環境 (ENV-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| ENV-001 | システムは小雨で動作すること（IP54+防水） | 最重要 | 環境テスト |
| ENV-002 | システムは-5°Cから40°Cの温度範囲で動作すること | 高 | 環境テスト |
| ENV-003 | システムは昼間と夜間の条件で動作すること | 最重要 | フィールドテスト |
| ENV-004 | システムは屋外照明変動を処理すること | 高 | フィールドテスト |
| ENV-005 | システムは芝生、アスファルト、コンクリート、タイルで動作すること | 最重要 | フィールドテスト |
| ENV-006 | システムは不整地（±20mm凹凸）を処理すること | 高 | フィールドテスト |
| ENV-007 | システムは大雨や雪では動作しないこと | 最重要 | ドキュメント |

### 2.4 安全規格 (STD-REQ)

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|---------|
| STD-001 | システムはISO 13482（パーソナルケアロボット）に準拠すること | 最重要 | 認証 |
| STD-002 | システムはIEC 61508（機能安全）に準拠すること | 最重要 | 認証 |
| STD-003 | システムは安全度水準（SIL）2を実装すること | 最重要 | 設計レビュー |
| STD-004 | システムはFMEA（故障モード影響解析）を受けること | 高 | 設計レビュー |
| STD-005 | システムはすべての側面からアクセス可能な緊急停止を持つこと | 最重要 | 設計レビュー |

---

## 3. ハードウェア要件サマリー

| コンポーネント | 仕様 | 理由 |
|-------------|------|------|
| **ドライブシステム** | スワーブドライブ（4モジュール、6.5"ホイール、80W/輪） | 最良の屋外性能、全方向移動 |
| **コンピュート** | GMKtec Nucbox K6（Ryzen 7 7840HS、32GB、Radeon 780M） | CPUベース処理に十分 |
| **3D LiDAR** | 屋外グレード、IP65+、360°、0.1-30m範囲（TBD） | 主要ナビゲーションセンサー |
| **カメラ** | RGBカメラ×2、最低720p、30fps | ArUco検出 + 視覚認識 |
| **IMU** | 9軸、100Hz更新レート | 傾斜補償、姿勢 |
| **ArUcoマーカー** | 4-8個（150mm × 150mm）ドッキングステーション | 精密ドッキング |
| **緊急停止** | ハードウェアボタン（全側面アクセス可能） | 重要安全機能 |
| **バッテリー** | リチウムイオン、4時間以上稼働（TBD Ah） | 動作要件 |
| **防水性** | IP54+筐体 | 小雨動作 |

**注:** GPS明示的に除外（コスト削減、<1km範囲ではNDTローカライゼーションで十分）

---

## 4. ソフトウェア要件サマリー

| コンポーネント | 技術 | バージョン | 目的 |
|-------------|------|----------|------|
| **OS** | Ubuntu | 22.04 LTS | ROS 2 Humbleサポート |
| **フレームワーク** | ROS 2 | Humble | ロボットミドルウェア |
| **ナビゲーション** | Autoware + Nav2 | 最新安定版 | 実証済み屋外ナビゲーション |
| **ローカライゼーション** | NDTスキャンマッチャー | SLAM Toolbox経由 | ドリフトフリーローカライゼーション |
| **SLAM** | SLAM Toolbox / Cartographer | 最新 | 手動マッピング（オフライン） |
| **知覚** | PCL | 1.12+ | LiDAR処理 |
| **ビジョン** | OpenCV | 4.x | ArUco検出 |
| **UI** | React + Next.js | 14.x | タッチスクリーンインターフェース |
| **eHMI** | Arduino（ESP32-S3）+ Dezyne | 最新 | LED/音声外部HMI |

---

## 5. 要件検証アプローチ

### 5.1 検証方法

| 方法 | 説明 | カバーする要件 |
|------|------|--------------|
| **ユニットテスト** | コンポーネントレベルテスト | 18要件 |
| **統合テスト** | サブシステム相互作用テスト | 24要件 |
| **フィールドテスト** | 実世界屋外/屋内テスト | 22要件 |
| **安全テスト** | 安全重要機能検証 | 16要件 |
| **性能テスト** | タイミング、スループット、リソース使用 | 10要件 |
| **ユーザテスト** | ユーザエクスペリエンスと使いやすさ | 5要件 |
| **認証** | 規格準拠 | 3要件 |

### 5.2 受入基準

**最小実行可能製品（MVP）:**
- すべての最重要要件（47）が検証に合格すること
- 高優先度要件の≥80%（26/32）が検証に合格すること
- テスト中の安全インシデントゼロ
- 95%超のドッキング成功率（屋外）
- 98%超のナビゲーション成功率（衝突なし）

**製品化準備完了:**
- 100%の最重要 + 高優先度要件検証済み
- ≥50%の中 + 低優先度要件検証済み
- フィールドテスト：1000ミッションまたは30日間動作
- 顧客受入テスト合格

---

## 6. TBD項目

| 項目 | ステータス | 担当 | 目標日 |
|-----|----------|------|--------|
| 3D LiDARモデル選定 | TBD | ハードウェアチーム | スプリント2 |
| バッテリー容量（Ah）と充電仕様 | TBD | ハードウェアチーム | スプリント2 |
| カメラ解像度とモデル | TBD | 知覚チーム | スプリント3 |
| 車椅子予約システム統合 | TBD | プロダクトチーム | スプリント8 |

---

## 7. 関連ドキュメント

**参照資料:**
- `../reference/PARCELPAL_EXPLORATION_SUMMARY.md` - ParcelPal実証済みアーキテクチャ
- `../reference/SWERVE_DRIVE_SYSTEM_TASK.md` - 元のタスク仕様
- `../reference/question_answers.md` - シニアレビュー明確化

**サブシステム要件:**
- `SWERVE_DRIVE_REQUIREMENTS.md` - ドライブシステム詳細要件
- `DOCKING_SYSTEM_REQUIREMENTS.md` - ドッキング精度要件
- `NAVIGATION_REQUIREMENTS.md` - ナビゲーションとローカライゼーション要件

---

**ドキュメントステータス:** ドラフト v1.0
**レビューステータス:** ステークホルダーレビュー待ち
**次回レビュー:** フェーズ1スプリント2後
**バージョン履歴:**
- v1.0 (2025-12-15): 初版要件仕様書

**注:** 詳細は英語版 SYSTEM_REQUIREMENTS.md を参照

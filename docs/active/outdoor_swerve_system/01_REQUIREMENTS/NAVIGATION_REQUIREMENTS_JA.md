# ナビゲーション要件

**文書ID:** REQ-NAV-001
**バージョン:** 1.0
**日付:** 2025年12月15日
**ステータス:** ドラフト
**分類:** 内部

---

## 文書管理

| バージョン | 日付 | 作成者 | 変更内容 |
|---------|------|--------|---------|
| 1.0 | 2025-12-15 | ナビゲーションリード | ParcelPal実績アーキテクチャに基づく初版ナビゲーション要件 |

---

## 1. はじめに

### 1.1 目的

本文書は、屋外優先車椅子輸送ロボットの**ナビゲーション要件**を規定します。ナビゲーションサブシステムは、ParcelPal配送ロボットアーキテクチャに基づく実績あるNDTローカライゼーションとNav2経路計画を使用して、自律的な地点間移動を実現します。

### 1.2 スコープ

本仕様は以下をカバーします:
- **ローカライゼーション** - 事前構築マップ上のNDTスキャンマッチング（運用中の継続的SLAM不使用）
- **経路計画** - Nav2によるグローバル（A*/Dijkstra）およびローカル（DWB）計画
- **マップ管理** - オフラインマッピング、マップ保存、マップ更新
- **マルチウェイポイントナビゲーション** - 500m-1kmミッションのための順次ウェイポイント実行
- **センサーフュージョン** - LiDAR + IMU + ホイールオドメトリ
- **ルート実行** - ゴールキュー管理、再計画、復旧動作
- **性能** - 500m超で±10cm精度、GPS不要

### 1.4 ナビゲーションアーキテクチャ概要

システムは**ParcelPal 2段階ナビゲーション戦略**を実装します:

**段階1: オフラインマッピング（1回、手動ドライブ）**
```
手動遠隔操作ドライブ
    ↓
LiDAR + オドメトリ + IMU記録
    ↓
ループクロージャ付きSLAM Toolbox（マッピングモード）
    ↓
最終マップ保存
    ↓
ウェイポイント注釈（停止、充電、ドッキングゾーン）
```

**段階2: オンラインローカライゼーション（日常運用）**
```
保存マップロード
    ↓
保存マップ上でNDTスキャンマッチング
    ↓
継続的姿勢推定（ドリフト蓄積なし！）
    ↓
ウェイポイントへのNav2経路計画
    ↓
スワーブドライブコントローラ実行
```

**重要な洞察:** このアプローチは固定の事前構築マップ上でローカライゼーションすることでドリフト蓄積を排除し、GPSなしで500m-1km範囲の信頼性ある航行を可能にします。

---

## 2. ローカライゼーション要件

### 2.1 NDTスキャンマッチング（NAV-LOC-NDT）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| NAV-LOC-NDT-001 | システムはローカライゼーションにNDT（正規分布変換）を使用しなければならない | 必須 | 構成 |
| NAV-LOC-NDT-002 | システムは事前構築静的マップ上でローカライズしなければならない（継続的SLAM不使用） | 必須 | アーキテクチャレビュー |
| NAV-LOC-NDT-003 | システムはGPSなしで500m超で±10cm位置精度を達成しなければならない | 必須 | フィールドテスト（100試行） |
| NAV-LOC-NDT-004 | システムは±2°姿勢精度を達成しなければならない | 高 | フィールドテスト |
| NAV-LOC-NDT-005 | システムは最低10 Hzで姿勢推定を発行しなければならない | 必須 | 性能テスト |
| NAV-LOC-NDT-006 | システムは姿勢共分散（不確実性推定）を計算しなければならない | 高 | 単体テスト |
| NAV-LOC-NDT-007 | システムはボクセルグリッドサイズ0.5m-1.0mを使用しなければならない（屋外チューニング） | 高 | 構成 |
| NAV-LOC-NDT-008 | システムは最大30反復のニュートン最適化を使用しなければならない | 中 | 構成 |

**合計要件: 8**

---

## 9. 要件サマリー

### カテゴリ別要件数

| カテゴリ | 合計要件 | 必須 | 高 | 中 | 低 |
|---------|---------|------|-----|-----|-----|
| **ローカライゼーション** | **32** | 18 | 11 | 3 | 0 |
| - NDTスキャンマッチング | 8 | 4 | 3 | 1 | 0 |
| - センサーフュージョン | 6 | 3 | 3 | 0 | 0 |
| - マップ管理 | 7 | 3 | 3 | 1 | 0 |
| - 初期姿勢 | 6 | 4 | 2 | 0 | 0 |
| - 故障処理 | 5 | 4 | 1 | 0 | 0 |
| **経路計画** | **28** | 16 | 10 | 2 | 0 |
| - グローバル計画 | 7 | 4 | 2 | 1 | 0 |
| - ローカル計画 | 7 | 5 | 2 | 0 | 0 |
| - コストマップ | 8 | 6 | 1 | 1 | 0 |
| - 動的障害物 | 6 | 3 | 3 | 0 | 0 |
| **マルチウェイポイント** | **20** | 8 | 11 | 1 | 0 |
| - ウェイポイント管理 | 6 | 3 | 2 | 1 | 0 |
| - ウェイポイント実行 | 7 | 4 | 3 | 0 | 0 |
| - ミッション計画 | 7 | 3 | 4 | 0 | 0 |
| **ルート実行** | **18** | 10 | 7 | 1 | 0 |
| - ゴール処理 | 6 | 4 | 2 | 0 | 0 |
| - 復旧動作 | 7 | 3 | 4 | 0 | 0 |
| - 再計画 | 5 | 3 | 2 | 0 | 0 |
| **性能** | **15** | 3 | 10 | 2 | 0 |
| - ナビゲーション精度 | 5 | 2 | 3 | 0 | 0 |
| - 速度と効率 | 5 | 0 | 3 | 2 | 0 |
| - 計算性能 | 5 | 1 | 4 | 0 | 0 |
| **統合** | **15** | 11 | 4 | 0 | 0 |
| - Nav2統合 | 6 | 5 | 1 | 0 | 0 |
| - スワーブドライブ | 4 | 4 | 0 | 0 | 0 |
| - センサー統合 | 5 | 3 | 2 | 0 | 0 |
| **テスト** | **8** | 2 | 6 | 0 | 0 |
| - 単体テスト | 3 | 0 | 3 | 0 | 0 |
| - 統合テスト | 5 | 2 | 3 | 0 | 0 |
| **合計** | **136** | **68 (50%)** | **59 (43%)** | **9 (7%)** | **0 (0%)** |

**優先度分布:**
- **必須（68要件、50%）**: コアナビゲーション機能、これなしでシステムは航行できない
- **高（59要件、43%）**: 信頼性と堅牢性に重要
- **中（9要件、7%）**: あると良い最適化
- **低（0要件、0%）**: ナビゲーションサブシステムにはN/A

---

## 10. 受入基準

### 10.1 最小実行可能製品（MVP）

**MVP定義:** 事前マップ済みルート上の信頼性ある地点間自律ナビゲーション、500m超で±20cm精度。

**MVP要件:**
- ✅ すべての必須要件（68合計）を満たさなければならない
- ✅ 事前構築マップ上でNDTローカライゼーション動作
- ✅ Nav2経路計画機能（グローバル+ローカル）
- ✅ 500m超で±20cm精度（ミッションの90%）
- ✅ >90%ミッション成功率（50テストミッション）
- ✅ マルチウェイポイントナビゲーション（最大5ウェイポイント）
- ✅ 基本復旧動作（クリア、回転、後退）
- ✅ <50% CPU使用率（ナビゲーションスタック）

### 10.2 製品準備完了

**製品定義:** すべての必須+高要件を満たす堅牢、効率的、全天候自律ナビゲーション。

**製品要件:**
- ✅ すべての必須（68）+すべての高（59）要件満足 = 127合計
- ✅ 500m超で±10cm精度、1km超で±20cm
- ✅ >95%ミッション成功率（1000テストミッション）
- ✅ 0.8 m/s平均ミッション速度
- ✅ マルチウェイポイントミッション（最大10ウェイポイント、1km合計）
- ✅ 動的障害物予測と回避
- ✅ 高度な復旧動作（>90%成功）
- ✅ <35% CPU使用率（ナビゲーションスタック）
- ✅ 夜間および小雨運用

---

**文書ステータス:** ドラフト
**次回レビュー:** Nav2構成と初期マッピング後
**承認必要:** ナビゲーションリード、システムアーキテクト、ローカライゼーションエンジニア

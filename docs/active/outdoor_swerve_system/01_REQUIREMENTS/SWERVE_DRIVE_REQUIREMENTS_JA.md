# スワーブドライブシステム要件

**プロジェクト:** スワーブドライブ式屋外優先車椅子輸送ロボット
**ドキュメントタイプ:** サブシステム要件仕様
**ステータス:** ドラフト v1.0
**日付:** 2025年12月15日
**親ドキュメント:** SYSTEM_REQUIREMENTS.md

---

## ドキュメント目的

本ドキュメントは、車椅子輸送ロボットに全方向移動性を提供するスワーブドライブサブシステムの完全な要件を規定します。スワーブドライブは、ゼロ半径旋回、横移動、斜め移動を可能にし、制約のある環境での精密な車椅子ドッキングに不可欠な機能です。

---

## 1. 概要

### 1.1 サブシステム説明

スワーブドライブシステムは、それぞれ独立してステアリングと駆動が可能な4つの独立ホイールモジュールで構成されます。この構成により以下を提供:
- 全方向移動（前進、後進、横移動、斜め移動）
- ゼロ半径旋回（その場回転）
- メカナムホイール比優れた屋外性能
- ドッキング動作用の精密位置制御

### 1.2 主要機能

| 機能 | 仕様 | 重要度 |
|------|------|--------|
| 最大直線速度 | 1.5 m/s（乗客なし）、1.0 m/s（乗客あり） | クリティカル |
| 最大角速度 | 1.0 rad/s（57°/s） | 高 |
| 最大勾配 | 10°（17.6%勾配）100kg荷重時 | クリティカル |
| 位置精度 | 低速時（<0.2 m/s）±10mm | 高 |
| ゼロ半径旋回 | その場回転（0m旋回半径） | クリティカル |

---

## 2. 機能要件

### 2.1 動作制御（SWERVE-MC）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-MC-001 | システムは全方向移動（vx、vy、ω）をサポートすること | クリティカル | 統合テスト |
| SWERVE-MC-002 | システムはゼロ半径旋回（その場回転）を実行すること | クリティカル | ユニットテスト |
| SWERVE-MC-003 | システムは前進/後進動作をサポートすること | クリティカル | ユニットテスト |
| SWERVE-MC-004 | システムは横移動（左/右）をサポートすること | クリティカル | ドッキングテスト |
| SWERVE-MC-005 | システムは斜め移動をサポートすること | 高 | 統合テスト |
| SWERVE-MC-006 | システムは全4モジュールの逆運動学を計算すること | クリティカル | ユニットテスト |
| SWERVE-MC-007 | システムはホイールステアリングと駆動モーターを調整すること | クリティカル | 統合テスト |
| SWERVE-MC-008 | システムは最低20Hzで速度コマンド更新を処理すること | クリティカル | 性能テスト |
| SWERVE-MC-009 | システムは動作遷移をスムーズにブレンドすること | 高 | 快適性テスト |
| SWERVE-MC-010 | システムは設定最大値（デフォルト0.5 m/s²）に加速度を制限すること | クリティカル | 安全テスト |

**成功基準:** 全方向でのスムーズな全方向移動、速度追従誤差<5%

---

### 2.2 逆運動学（SWERVE-IK）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-IK-001 | システムは車体速度（vx、vy、ω）からホイール速度を計算すること | クリティカル | ユニットテスト |
| SWERVE-IK-002 | システムは車体速度からホイール角度を計算すること | クリティカル | ユニットテスト |
| SWERVE-IK-003 | システムは特異点（ゼロ速度コマンド）を処理すること | 高 | エッジケーステスト |
| SWERVE-IK-004 | システムはモーター制限を尊重するようホイール速度を正規化すること | クリティカル | 安全テスト |
| SWERVE-IK-005 | システムは回転を最小化するようホイール方向を最適化すること | 高 | 性能テスト |
| SWERVE-IK-006 | システムは最低50HzでIK計算を更新すること | クリティカル | 性能テスト |
| SWERVE-IK-007 | システムはホイールエンコーダから正確なオドメトリを提供すること | 高 | 統合テスト |

**成功基準:** IK計算が1ms以内に完了、理論値比±1%精度

---

### 2.3 ホイールモジュール制御（SWERVE-WM）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-WM-001 | 各モジュールはステアリング角度を独立制御すること | クリティカル | ユニットテスト |
| SWERVE-WM-002 | 各モジュールは駆動速度を独立制御すること | クリティカル | ユニットテスト |
| SWERVE-WM-003 | ステアリング角度範囲は±180°（連続回転）であること | 高 | ハードウェアテスト |
| SWERVE-WM-004 | ステアリング角度精度は±2°であること | 高 | キャリブレーションテスト |
| SWERVE-WM-005 | 駆動速度精度は指令速度の±5%であること | 高 | 性能テスト |
| SWERVE-WM-006 | モジュールは最低100Hzでエンコーダフィードバックを報告すること | クリティカル | 性能テスト |
| SWERVE-WM-007 | モジュールは180°ステアリングなしで逆方向を処理すること | 高 | 効率テスト |
| SWERVE-WM-008 | モジュールは機械的限界から保護すること | クリティカル | 安全テスト |

**成功基準:** 全4モジュールが許容範囲内で指令位置達成、応答時間<50ms

---

### 2.4 Nav2統合（SWERVE-NAV）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-NAV-001 | システムはNav2コントローラプラグインインターフェースを実装すること | クリティカル | 統合テスト |
| SWERVE-NAV-002 | システムはNav2ローカルプランナーからTwistコマンドを受信すること | クリティカル | 統合テスト |
| SWERVE-NAV-003 | システムは/odomトピックにオドメトリをパブリッシュすること | クリティカル | 統合テスト |
| SWERVE-NAV-004 | システムはTF変換（odom → base_link）をパブリッシュすること | クリティカル | 統合テスト |
| SWERVE-NAV-005 | システムはパラメータの動的再設定をサポートすること | 高 | 統合テスト |
| SWERVE-NAV-006 | システムは緊急停止コマンドを処理すること（<100ms） | クリティカル | 安全テスト |
| SWERVE-NAV-007 | システムはROS 2診断経由で診断ステータスを提供すること | 高 | 統合テスト |

**成功基準:** Nav2スタックとシームレス統合、ロボットが計画経路を誤差<10cmで追従

---

## 3. 性能要件

### 3.1 速度と加速度（SWERVE-PERF-SPEED）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-PERF-001 | 最大直線速度は1.5 m/s（乗客なし）であること | クリティカル | フィールドテスト |
| SWERVE-PERF-002 | 最大直線速度は1.0 m/s（乗客あり）であること | クリティカル | 安全テスト |
| SWERVE-PERF-003 | 最大角速度は1.0 rad/sであること | 高 | フィールドテスト |
| SWERVE-PERF-004 | 最大直線加速度は0.5 m/s²（乗客あり）であること | クリティカル | 快適性テスト |
| SWERVE-PERF-005 | 最大直線加速度は1.0 m/s²（乗客なし）であること | 高 | フィールドテスト |
| SWERVE-PERF-006 | 最大角加速度は0.5 rad/s²であること | 高 | 快適性テスト |
| SWERVE-PERF-007 | ゼロ半径旋回速度は≥30°/sであること | 高 | 操縦性テスト |

**成功基準:** 全速度/加速度制限が強制され、スムーズな動作プロファイル

---

### 3.2 精度（SWERVE-PERF-ACC）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-PERF-008 | 位置精度は速度<0.2 m/s時±10mmであること | 高 | ドッキングテスト |
| SWERVE-PERF-009 | 方位精度は速度<0.2 m/s時±2°であること | 高 | ドッキングテスト |
| SWERVE-PERF-010 | 速度追従誤差は指令速度の<5%であること | 高 | 性能テスト |
| SWERVE-PERF-011 | オドメトリドリフトは100m走行で<2%であること | 高 | フィールドテスト |
| SWERVE-PERF-012 | 再現性は同一動作コマンドで±5mmであること | 中 | 精度テスト |

**成功基準:** ビジュアルサーボイングと組み合わせて±2-5mmドッキング精度に十分な精度

---

### 3.3 応答時間（SWERVE-PERF-TIME）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-PERF-013 | コントローラは最低20Hzでcmd_velを処理すること | クリティカル | 性能テスト |
| SWERVE-PERF-014 | IK計算は<1msで完了すること | クリティカル | 性能テスト |
| SWERVE-PERF-015 | 緊急停止は<100msで起動すること | クリティカル | 安全テスト |
| SWERVE-PERF-016 | ホイールモジュール応答時間は<50msであること | 高 | ハードウェアテスト |
| SWERVE-PERF-017 | オドメトリパブリッシュレートは最低50Hzであること | 高 | 統合テスト |

**成功基準:** 全動作条件下でリアルタイム性能維持

---

## 4. ハードウェア要件

### 4.1 ホイールモジュール（SWERVE-HW-MODULE）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-HW-001 | システムは4つの独立スワーブドライブモジュールを使用すること | クリティカル | 設計レビュー |
| SWERVE-HW-002 | 各モジュールは6.5"（φ165mm）ホバーボードインホイールモーターを使用すること | クリティカル | ハードウェア仕様 |
| SWERVE-HW-003 | 駆動モーター出力は≥80W/ホイールであること | クリティカル | ハードウェア仕様 |
| SWERVE-HW-004 | ステアリングモータートルクは100kg荷重に十分であること | クリティカル | 負荷テスト |
| SWERVE-HW-005 | ホイールモジュールは矩形配置であること | クリティカル | 設計レビュー |
| SWERVE-HW-006 | ホイールベース（L）は0.6m ±0.05mであること | 高 | ハードウェア仕様 |
| SWERVE-HW-007 | トレッド幅（W）は0.5m ±0.05mであること | 高 | ハードウェア仕様 |

**成功基準:** 定格荷重下で全性能要件を満たすハードウェア

---

### 4.2 センサー（SWERVE-HW-SENSOR）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-HW-008 | 各駆動モーターはエンコーダを持つこと（分解能≥1000 CPR） | クリティカル | ハードウェア仕様 |
| SWERVE-HW-009 | 各ステアリングモーターはエンコーダを持つこと（分解能≥1000 CPR） | クリティカル | ハードウェア仕様 |
| SWERVE-HW-010 | システムは方位/傾斜検知用IMUを含むこと | クリティカル | ハードウェア仕様 |
| SWERVE-HW-011 | エンコーダは最低100Hzでフィードバックを提供すること | クリティカル | 性能テスト |
| SWERVE-HW-012 | IMUは最低100Hzでデータを提供すること | 高 | 性能テスト |

**成功基準:** 全センサーがクローズドループ制御用の正確で高頻度フィードバック提供

---

## 5. ソフトウェア要件

### 5.1 コントローラ実装（SWERVE-SW-CTRL）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-SW-001 | コントローラはC++17で実装すること | クリティカル | コードレビュー |
| SWERVE-SW-002 | コントローラはROS 2 Humbleを使用すること | クリティカル | 統合テスト |
| SWERVE-SW-003 | コントローラはnav2_core::Controllerインターフェースを実装すること | クリティカル | 統合テスト |
| SWERVE-SW-004 | コントローラはYAMLパラメータ経由で設定可能であること | 高 | 統合テスト |
| SWERVE-SW-005 | コントローラは診断情報をログすること | 高 | 統合テスト |
| SWERVE-SW-006 | コントローラはノードライフサイクルを処理すること | 高 | 統合テスト |

**成功基準:** コントローラがNav2とシームレス統合、標準ROS 2メカニズム経由で設定可能

---

## 6. 安全要件

### 6.1 運用安全（SWERVE-SAFE-OP）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-SAFE-001 | システムは最大速度制限を強制すること（オーバーライドなし） | クリティカル | 安全テスト |
| SWERVE-SAFE-002 | システムは最大加速度制限を強制すること | クリティカル | 安全テスト |
| SWERVE-SAFE-003 | システムは5°超勾配で速度を減少すること | クリティカル | フィールドテスト |
| SWERVE-SAFE-004 | システムは10°超勾配で停止すること | クリティカル | 安全テスト |
| SWERVE-SAFE-005 | システムはホイールスリップを検出し速度を減少すること | 高 | 安全テスト |
| SWERVE-SAFE-006 | システムはホイールモジュール故障時動作しないこと | クリティカル | 故障テスト |
| SWERVE-SAFE-007 | システムは緊急停止機能を提供すること | クリティカル | 安全テスト |

**成功基準:** 1000テストミッションで安全インシデントゼロ

---

## 7. 環境要件

### 7.1 動作条件（SWERVE-ENV）

| ID | 要件 | 優先度 | 検証方法 |
|----|------|--------|----------|
| SWERVE-ENV-001 | システムは平坦面（0°勾配）で動作すること | クリティカル | フィールドテスト |
| SWERVE-ENV-002 | システムは100kg荷重で最大10°勾配で動作すること | クリティカル | フィールドテスト |
| SWERVE-ENV-003 | システムは草、アスファルト、コンクリートで動作すること | クリティカル | フィールドテスト |
| SWERVE-ENV-004 | システムは±20mm表面不規則性を処理すること | 高 | フィールドテスト |
| SWERVE-ENV-005 | システムは温度範囲-5°C〜40°Cで動作すること | 高 | 環境テスト |
| SWERVE-ENV-006 | システムは小雨で動作すること（IP54+モーター） | クリティカル | 環境テスト |
| SWERVE-ENV-007 | システムは損傷なく粉塵/破片を処理すること | 高 | 環境テスト |

**成功基準:** 指定全環境条件での信頼性ある動作

---

## 8. 受入基準

### 8.1 MVP（最小実行可能製品）

- [ ] 全クリティカル要件検証済み
- [ ] ≥80%高要件検証済み
- [ ] Nav2統合機能
- [ ] 全方向移動実証済み
- [ ] 緊急停止機能
- [ ] 基本フィールドテスト完了（10km）

### 8.2 製品準備完了

- [ ] 100%クリティカル+高要件検証済み
- [ ] ≥50%中要件検証済み
- [ ] フィールドテスト: 100kmまたは30日運用
- [ ] 安全インシデントゼロ
- [ ] 顧客受入テスト合格

---

## 9. 関連ドキュメント

**親ドキュメント:**
- `SYSTEM_REQUIREMENTS.md` - 全体システム要件

**関連サブシステムドキュメント:**
- `NAVIGATION_REQUIREMENTS.md` - ナビゲーションサブシステム
- `DOCKING_SYSTEM_REQUIREMENTS.md` - ドッキングサブシステム
- `SAFETY_REQUIREMENTS.md` - 安全サブシステム

**アーキテクチャ & 設計:**
- `SWERVE_DRIVE_ARCHITECTURE.md` - 詳細アーキテクチャ
- `SWERVE_DRIVE_CONTROLLER_DESIGN.md` - コントローラ実装設計

---

**ドキュメントステータス:** ドラフト v1.0
**レビューステータス:** 技術レビュー待ち
**次回レビュー:** スプリント3後（スワーブドライブハードウェア選定後）
**承認者:** システムアーキテクト、制御リード、安全リード
**バージョン履歴:**
- v1.0 (2025-12-15): スワーブドライブ要件仕様初版

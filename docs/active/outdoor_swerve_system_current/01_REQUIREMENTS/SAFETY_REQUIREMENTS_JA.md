# 安全要件

**文書ID:** REQ-SAFE-001
**バージョン:** 1.0
**日付:** 2025年12月15日
**ステータス:** ドラフト
**分類:** 内部

---

## 文書管理

| バージョン | 日付 | 作成者 | 変更内容 |
|---------|------|--------|---------|
| 1.0 | 2025-12-15 | 安全エンジニア | SYSTEM_REQUIREMENTS.mdおよび安全ベストプラクティスに基づく初版安全要件 |

---

## 1. はじめに

### 1.1 目的

本文書は、屋外優先車椅子輸送ロボットの**安全要件**を規定します。安全は最優先のサブシステムであり、すべての運用モード中の乗客安全、運用安全、環境安全を確保します。

### 1.2 スコープ

本仕様は以下をカバーします:
- **乗客安全** - 輸送中の車椅子乗車乗客の保護
- **運用安全** - 安全な自律運用（衝突回避、緊急停止）
- **環境安全** - 様々な気象、傾斜、照明条件での安全運用
- **システム安全** - 冗長性、故障検出、フェイルセーフモード
- **ソフトウェア安全** - 安全監視、速度ガバナー、衝突予測器
- **ハードウェア安全** - 緊急停止回路、センサー、ブレーキ

### 1.3 安全哲学

システムは4層の**多重防護**安全戦略に従います:

**層1: 緊急停止（ハードウェア）**
- 物理的緊急停止ボタン（乗客+遠隔操作者）
- ハードウェアベースのモーターカットオフ（<100ms応答）
- ソフトウェア制御から独立

**層2: システム監視（ソフトウェアウォッチドッグ）**
- すべての重要サブシステムのリアルタイム監視
- センサー故障時の自動劣化モード
- 通信タイムアウト時の安全状態

**層3: 衝突回避（知覚+計画）**
- 3D LiDAR障害物検出
- 動的障害物追跡
- 予測的衝突回避
- 安全ゾーン（停止<0.5m、減速<1.5m、注意<3m）

**層4: 運用安全（制約）**
- 速度制限（乗客有1.0 m/s、無1.5 m/s）
- 加速度制限（0.5 m/s²）
- 傾斜制限（最大10°）
- 気象制限（小雨のみ）

---

## 2. 乗客安全要件

### 2.1 速度制限（SAFE-PASS-SPEED）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-PASS-SPEED-001 | システムは乗客搭乗時に1.0 m/sを超えてはならない | 必須 | 安全テスト |
| SAFE-PASS-SPEED-002 | システムはドッキング作業中に速度を0.5 m/sに制限しなければならない | 必須 | 安全テスト |
| SAFE-PASS-SPEED-003 | システムは5°超の傾斜で速度を0.3 m/sに制限しなければならない | 必須 | 傾斜テスト |
| SAFE-PASS-SPEED-004 | システムは低視界（<10m）で速度を0.7 m/sに減速しなければならない | 高 | フィールドテスト |
| SAFE-PASS-SPEED-005 | システムはハードウェア速度ガバナー経由で速度制限を強制しなければならない | 必須 | ハードウェア検査 |

**合計要件: 5**

---

### 2.2 加速度制限（SAFE-PASS-ACCEL）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-PASS-ACCEL-001 | システムは乗客有で直線加速度を0.5 m/s²に制限しなければならない | 必須 | 安全テスト |
| SAFE-PASS-ACCEL-002 | システムは乗客有で角加速度を0.3 rad/s²に制限しなければならない | 必須 | 安全テスト |
| SAFE-PASS-ACCEL-003 | システムは乗客有でジャークを2.0 m/s³に制限しなければならない | 高 | 安全テスト |
| SAFE-PASS-ACCEL-004 | システムは速度変更を≥1秒かけてランプしなければならない | 高 | 安全テスト |
| SAFE-PASS-ACCEL-005 | システムはS曲線加速度プロファイル（スムーズ開始/停止）を使用しなければならない | 中 | 統合テスト |

**合計要件: 5**

---

### 2.3 乗客検出（SAFE-PASS-DETECT）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-PASS-DETECT-001 | システムは重量センサー経由で乗客存在を検出しなければならない（>20kg） | 必須 | ハードウェアテスト |
| SAFE-PASS-DETECT-002 | システムは輸送開始前に乗客検出を検証しなければならない | 必須 | 安全テスト |
| SAFE-PASS-DETECT-003 | システムは輸送中に乗客重量が閾値未満に低下した場合停止しなければならない | 必須 | 故障注入テスト |
| SAFE-PASS-DETECT-004 | システムは乗客検出後に操作者確認を要求しなければならない | 高 | 統合テスト |
| SAFE-PASS-DETECT-005 | システムは乗客検出イベントをタイムスタンプ付きでログ出力しなければならない | 中 | ログ検査 |

**合計要件: 5**

---

### 2.4 傾き検出と安定性（SAFE-PASS-TILT）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-PASS-TILT-001 | システムは最低50 Hzで傾斜角（ロール、ピッチ）を監視しなければならない | 必須 | 性能テスト |
| SAFE-PASS-TILT-002 | システムは傾斜が±15°を超える場合警告を発しなければならない（音声+eHMI） | 必須 | 傾斜テスト |
| SAFE-PASS-TILT-003 | システムは傾斜が±20°を超える場合即座に停止しなければならない | 必須 | 安全テスト |
| SAFE-PASS-TILT-004 | システムは10°超の傾斜での運用を拒否しなければならない | 必須 | 傾斜テスト |
| SAFE-PASS-TILT-005 | システムは動的安定性マージンを計算しなければならない（リアルタイム） | 高 | 単体テスト |
| SAFE-PASS-TILT-006 | システムは初期傾斜>5°の場合ミッションを拒否しなければならない | 高 | 統合テスト |

**合計要件: 6**

---

### 2.5 緊急停止（乗客開始）（SAFE-PASS-ESTOP）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-PASS-ESTOP-001 | システムは乗客がアクセス可能な物理的緊急停止ボタンを持たなければならない | 必須 | ハードウェア検査 |
| SAFE-PASS-ESTOP-002 | システムは緊急停止起動時に1.0 m/sから0.5m以内で停止しなければならない | 必須 | ブレーキテスト |
| SAFE-PASS-ESTOP-003 | システムは緊急停止の100ms以内にモーター電源を切断しなければならない | 必須 | ハードウェアテスト |
| SAFE-PASS-ESTOP-004 | システムはeHMI緊急状態を起動しなければならない（赤点滅、サイレン） | 必須 | 統合テスト |
| SAFE-PASS-ESTOP-005 | システムは緊急停止後に手動リセットを要求しなければならない | 必須 | 安全テスト |
| SAFE-PASS-ESTOP-006 | システムは緊急停止イベントを位置、タイムスタンプ、理由とともにログ出力しなければならない | 高 | ログ検査 |

**合計要件: 6**

---

### 2.6 シートベルトと拘束具（SAFE-PASS-RESTRAINT）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-PASS-RESTRAINT-001 | システムは磁気センサー経由でシートベルト装着を検出しなければならない | 必須 | ハードウェアテスト |
| SAFE-PASS-RESTRAINT-002 | システムはシートベルト未装着の場合輸送開始を拒否しなければならない | 必須 | 安全テスト |
| SAFE-PASS-RESTRAINT-003 | システムは輸送中にシートベルトが外れた場合操作者に警告しなければならない | 必須 | 故障注入テスト |
| SAFE-PASS-RESTRAINT-004 | システムは輸送中にシートベルトが外れた場合即座に停止しなければならない | 必須 | 安全テスト |

**合計要件: 4**

---

## 3. 運用安全要件

### 3.1 障害物検出（SAFE-OPS-OBS）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-OPS-OBS-001 | システムは360°視野で障害物を検出しなければならない | 必須 | フィールドテスト |
| SAFE-OPS-OBS-002 | システムは最低50 Hzで障害物を検出しなければならない（3D LiDAR） | 必須 | 性能テスト |
| SAFE-OPS-OBS-003 | システムは≥0.1m高さ、≥0.05m直径の障害物を検出しなければならない | 必須 | 障害物テスト |
| SAFE-OPS-OBS-004 | システムは15m範囲まで障害物を検出しなければならない | 高 | フィールドテスト |
| SAFE-OPS-OBS-005 | システムは距離で障害物を分類しなければならない（停止、減速、注意ゾーン） | 必須 | 統合テスト |
| SAFE-OPS-OBS-006 | システムは動的障害物を追跡しなければならない（歩行者、車両） | 高 | 追跡テスト |
| SAFE-OPS-OBS-007 | システムは障害物軌跡を予測しなければならない（1-3秒） | 高 | 統合テスト |

**合計要件: 7**

---

### 3.2 安全ゾーン（SAFE-OPS-ZONE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-OPS-ZONE-001 | システムは停止ゾーンを定義しなければならない（障害物から<0.5m） | 必須 | 統合テスト |
| SAFE-OPS-ZONE-002 | システムは障害物が停止ゾーンに進入した場合即座に停止しなければならない | 必須 | 安全テスト |
| SAFE-OPS-ZONE-003 | システムは減速ゾーンを定義しなければならない（障害物から0.5-1.5m） | 必須 | 統合テスト |
| SAFE-OPS-ZONE-004 | システムは減速ゾーンで速度を0.3 m/sに減速しなければならない | 必須 | 安全テスト |
| SAFE-OPS-ZONE-005 | システムは注意ゾーンを定義しなければならない（障害物から1.5-3m） | 高 | 統合テスト |
| SAFE-OPS-ZONE-006 | システムは注意ゾーンで速度を0.7 m/sに減速しなければならない | 高 | 安全テスト |
| SAFE-OPS-ZONE-007 | システムはロボット速度に基づいてゾーンサイズを適応しなければならない | 高 | 統合テスト |

**合計要件: 7**

---

### 3.3 衝突回避（SAFE-OPS-COLL）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-OPS-COLL-001 | システムはすべての障害物に対して衝突時間（TTC）を計算しなければならない | 必須 | 単体テスト |
| SAFE-OPS-COLL-002 | システムはTTC<2秒の場合ブレーキを開始しなければならない | 必須 | 安全テスト |
| SAFE-OPS-COLL-003 | システムは5秒以内に衝突予測された場合経路を再計画しなければならない | 高 | 統合テスト |
| SAFE-OPS-COLL-004 | システムは回避より減速を優先しなければならない（乗客快適性） | 高 | 安全テスト |
| SAFE-OPS-COLL-005 | システムは障害物から≥1.0m安全距離を維持しなければならない | 必須 | フィールドテスト |
| SAFE-OPS-COLL-006 | システムは保守的バウンディングボックスを使用しなければならない（ロボット+0.2mマージン） | 必須 | 構成 |

**合計要件: 6**

---

### 3.4 緊急停止（自動）（SAFE-OPS-ESTOP）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-OPS-ESTOP-001 | システムは障害物<0.3mの場合緊急停止を開始しなければならない | 必須 | 安全テスト |
| SAFE-OPS-ESTOP-002 | システムは傾斜>20°の場合緊急停止を開始しなければならない | 必須 | 傾斜テスト |
| SAFE-OPS-ESTOP-003 | システムはセンサー故障検出時に緊急停止を開始しなければならない | 必須 | 故障注入テスト |
| SAFE-OPS-ESTOP-004 | システムは通信タイムアウト（>1s）時に緊急停止を開始しなければならない | 必須 | タイムアウトテスト |
| SAFE-OPS-ESTOP-005 | システムはソフトウェアクラッシュ検出時に緊急停止を開始しなければならない | 必須 | 故障注入テスト |
| SAFE-OPS-ESTOP-006 | システムは緊急停止理由を完全なセンサースナップショットとともにログ出力しなければならない | 高 | ログ検査 |

**合計要件: 6**

---

## 4. 環境安全要件

### 4.1 傾斜制限（SAFE-ENV-SLOPE）

| 要件ID | 要件 | 優先度 | 検証方法 |
|--------|------|--------|----------|
| SAFE-ENV-SLOPE-001 | システムは100kg荷重で10°（17.6%勾配）までの傾斜で運用しなければならない | 必須 | 傾斜テスト |
| SAFE-ENV-SLOPE-002 | システムは10°超の傾斜での運用を拒否しなければならない | 必須 | 傾斜テスト |
| SAFE-ENV-SLOPE-003 | システムは5°超の傾斜で速度を0.3 m/sに減速しなければならない | 必須 | 安全テスト |
| SAFE-ENV-SLOPE-004 | システムはリアルタイムで傾斜角（ロール+ピッチ）を計算しなければならない | 必須 | 単体テスト |
| SAFE-ENV-SLOPE-005 | システムは7°超の傾斜に接近する場合操作者に警告しなければならない | 高 | 統合テスト |

**合計要件: 5**

---

## 9. 要件サマリー

### カテゴリ別要件数

| カテゴリ | 合計要件 | 必須 | 高 | 中 | 低 |
|---------|---------|------|-----|-----|-----|
| **乗客安全** | **31** | 24 | 7 | 0 | 0 |
| **運用安全** | **42** | 34 | 8 | 0 | 0 |
| **環境安全** | **19** | 6 | 11 | 2 | 0 |
| **システム安全** | **25** | 20 | 5 | 0 | 0 |
| **ソフトウェア安全** | **25** | 22 | 3 | 0 | 0 |
| **ハードウェア安全** | **27** | 24 | 3 | 0 | 0 |
| **テスト** | **11** | 11 | 0 | 0 | 0 |
| **合計** | **180** | **141 (78%)** | **37 (21%)** | **2 (1%)** | **0 (0%)** |

**優先度分布:**
- **必須（141要件、78%）**: 安全クリティカル、これなしでシステムは安全に動作できない
- **高（37要件、21%）**: 信頼性と堅牢性に重要
- **中（2要件、1%）**: 品質改善
- **低（0要件、0%）**: 安全サブシステムにはN/A

---

## 10. 受入基準

### 10.1 最小実行可能製品（MVP）

**MVP定義:** 乗客搭乗での安全な自律運用、すべての重要安全テスト合格。

**MVP要件:**
- ✅ すべての必須要件（141合計）を満たさなければならない
- ✅ 100%緊急停止成功率（100テスト）
- ✅ >95%衝突回避成功（500シナリオ）
- ✅ 100%乗客速度制限遵守
- ✅ 100%傾斜検出と停止（<20°）
- ✅ すべてのセンサー故障テスト合格（安全状態進入）
- ✅ <300msブレーキ作動時間
- ✅ <0.7m停止距離 @ 1.0 m/s

### 10.2 製品準備完了

**製品定義:** すべての必須+高要件を満たす堅牢、全天候、24/7運用。

**製品要件:**
- ✅ すべての必須（141）+すべての高（37）要件満足 = 178合計
- ✅ 100%緊急停止成功率（1000テスト）
- ✅ >99%衝突回避成功（10,000シナリオ）
- ✅ 小雨運用（<2.5mm/hr）
- ✅ アクティブ照明での夜間運用
- ✅ <200msブレーキ作動時間
- ✅ <0.5m停止距離 @ 1.0 m/s
- ✅ 1000時間MTBF（平均故障間隔）
- ✅ 完全な故障注入テストスイート

---

**文書ステータス:** ドラフト
**次回レビュー:** 予備安全解析（FMEA）後
**承認必要:** 安全エンジニア、システムアーキテクト、ナビゲーションリード、ハードウェアリード

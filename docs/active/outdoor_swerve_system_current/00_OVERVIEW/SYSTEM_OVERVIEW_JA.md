# システム概要 - 屋外優先車椅子輸送ロボット

**⚠️ 重要な変更（2025-12-16）:**
- **ParcelPal:** コード再利用0%、アーキテクチャパターン60%（Autoware不使用）
- **開発体制:** 単独開発者（AI支援）
- **期間:** 32週間
- **詳細:** 英語版 SYSTEM_OVERVIEW.md, PROJECT_TIMELINE_WITH_AI.md 参照

---

**プロジェクト名:** スワーブドライブ式車椅子輸送ロボット
**対象環境:** 屋外優先、屋内互換性あり
**開発手法:** 単独開発者、AI支援
**参照アーキテクチャ:** ParcelPalアプローチ参考（コード0%、パターン60%、Autoware不使用）
**ドキュメント日付:** 2025年12月16日
**バージョン:** 2.0

---

## エグゼクティブサマリー

本ドキュメントは、**屋外動作**を主目的とし、完全な屋内互換性を持つ自律型車椅子輸送ロボットの包括的な概要を提供します。本システムは、優れた屋外性能のための**スワーブドライブプラットフォーム**、ArUco視覚マーカーによる**精密ドッキング**（±2-5mm）、GPS不要の実績ある**Autowareベースナビゲーション**を採用しています。

**主要イノベーション:** 屋外優先設計として、手動SLAMマッピング + NDTスキャンマッチャーローカライゼーション（ParcelPal実証済み手法）を使用することで、高価なRTK GPSなしで信頼性の高い500m-1km動作を実現。

---

## 1. プロジェクト概要

### 1.1 目的

以下の機能を持つ完全自律型車椅子輸送ロボットの開発：
- ✅ **自律車椅子ドッキング** 精密接続
- ✅ **安全な乗客輸送** ピックアップから目的地まで
- ✅ **屋外ナビゲーション** （最大10°勾配、小雨、不整地）
- ✅ **屋内互換性** （平滑床、制御環境）
- ✅ **複数停車シャトルサービス** （500m-1km動作範囲）
- ✅ **手動制御フォールバック** （ジョイスティック遠隔操作）

### 1.2 主要ユースケース

| ユースケース | 説明 | 優先度 |
|------------|------|--------|
| **車椅子ドッキング** | 自律接近と精密ドッキング（±2-5mm） | 最重要 |
| **乗客輸送** | A→Bナビゲーション、人が乗車、スムーズな走行 | 最重要 |
| **複数停車シャトル** | 連続ウェイポイントナビゲーション、定期運行 | 高 |
| **充電ステーション帰還** | バッテリー低下時（<30%）自動帰還 | 高 |
| **手動オーバーライド** | ジョイスティック遠隔操作、ティーチングモード | 中 |
| **緊急帰還** | センサー故障時の安全な基地への帰還 | 中 |

---

## 2. システムアーキテクチャ

### 2.1 高レベルアーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│            車椅子輸送ロボットシステム                          │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │      Wheelchair Master （メイン制御）                 │  │
│  │      • ステートマシン制御                            │  │
│  │      • ミッション計画                               │  │
│  │      • 安全監視                                     │  │
│  └─────────────┬────────────────────────────────────────┘  │
│                │                                            │
│    ┌───────────┼──────────┬──────────────┬────────────┐   │
│    ▼           ▼          ▼              ▼            ▼    │
│ ┌──────┐  ┌────────┐  ┌────────┐  ┌──────────┐  ┌──────┐│
│ │  UI  │  │Autoware│  │Swerve  │  │ Docking  │  │ eHMI ││
│ │(タッチ│  │  Nav   │  │ Drive  │  │Subsystem │  │(ESP32││
│ │スク  │  │ Stack  │  │制御    │  │(ArUco)   │  │      ││
│ │リーン│  └────────┘  └────────┘  └──────────┘  └──────┘│
│ └──────┘        │                                          │
│                 ▼                                          │
│          ┌─────────────┐                                  │
│          │  センサー    │                                  │
│          │LiDAR+カメラ  │                                  │
│          │   +IMU      │                                  │
│          └─────────────┘                                  │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 主要サブシステム

#### **1. スワーブドライブシステム** (新規)
- 4独立ホイールモジュール（6.5"ホバーボードインホイールモーター）
- 全方向移動のための逆運動学
- メカナムホイールより優れた屋外性能
- Nav2統合用のROS 2コントローラプラグイン

#### **2. 車椅子ドッキングサブシステム** (新規)
- ArUcoマーカー検出（OpenCV）
- 2段階ドッキング：粗ナビゲーション + 精密ビジュアルサーボイング
- 精度：屋外±2-5mm、屋内目標±1mm
- 確認センサー付き機械的結合

#### **3. Autowareナビゲーションスタック** (再利用 - ParcelPal)
- 手動SLAMマッピング1回（オフライン、ループクロージャ付き）
- NDTスキャンマッチャーローカライゼーション（オンライン、ドリフトなし）
- Nav2経路計画と障害物回避
- 範囲：GPS不要で500m-1km

#### **4. 知覚システム** (再利用 - ParcelPal)
- 3D LiDAR（屋外グレード、IP65+、モデルTBD）
- デュアルRGBカメラ（ArUco検出 + 障害物認識）
- 9軸IMU（姿勢、傾斜補償）
- バイナリ障害物検出（深層学習不要）

#### **5. 安全システム** (拡張 - ParcelPal + 車椅子)
- 乗客安全監視（在席検知）
- 緊急停止（ハードウェアボタン + ソフトウェア）
- 5°超勾配ではピックアップ/ドロップオフ禁止
- 乗客乗車時の速度制限
- ジオフェンシングと進入禁止エリア

---

## 3. 主要技術仕様

### 3.1 ハードウェアプラットフォーム

| コンポーネント | 仕様 | 理由 |
|-------------|------|------|
| **ドライブシステム** | スワーブドライブ（4モジュール） | 最良の屋外性能、全方向移動 |
| **ホイール** | 6.5" φ165mm ホバーボードインホイールモーター | 実績あり、入手可能、1輪80W |
| **コンピュート** | GMKtec Nucbox K6（Ryzen 7 7840HS、32GB、Radeon 780M） | CPUベース処理に十分、深層学習GPU不要 |
| **3D LiDAR** | 屋外グレード、IP65+（モデルTBD） | ナビゲーションと障害物検出の主要センサー |
| **カメラ** | RGBカメラ×2（解像度TBD） | ArUcoマーカー検出、視覚認識 |
| **IMU** | 9軸（MPU-9250または同等品） | 傾斜補償、姿勢 |
| **GPS** | ❌ 非搭載 | コスト削減、<1km範囲ではNDTローカライゼーションで十分 |
| **ArUcoマーカー** | ドッキングステーションに4-8個 | 精密ドッキング、OpenCVベース検出 |
| **防水性** | IP54+筐体 | 小雨動作対応 |

### 3.2 性能目標

| パラメータ | 屋外 | 屋内 | 備考 |
|---------|------|------|------|
| **ドッキング精度** | ±2-5mm | ±1mm（目標） | ArUcoビジュアルサーボイング |
| **ナビゲーション範囲** | 500m-1km | 制限なし | バッテリーによる制限、ローカライゼーションによる制限なし |
| **最大勾配** | 10°（17.6%） | 15°（可能） | 100kg荷重時の設計限界 |
| **最大速度** | 1.0 m/s | 1.5 m/s | 乗客快適性限界 |
| **ローカライゼーション精度** | ±10cm位置 | ±5cm位置 | NDTスキャンマッチャー |

---

## 4. 運用ワークフロー

### 4.1 車椅子ドッキングシーケンス

```
1. IDLE → 乗客がUI/アプリで呼び出し

2. APPROACHING_WHEELCHAIR → 接近ゾーンへナビゲート
   └─> 保存マップ + NDTローカライゼーション使用

3. SEARCHING_ARUCO → 車椅子のArUcoマーカー検出
   └─> ナビゲーションからビジュアルサーボイングへ切替

4. DOCKING → 精密接近（±2-5mm）
   └─> ビジュアルサーボイングコントローラ + 機械的結合

5. WHEELCHAIR_ATTACHED → 接続確認
   └─> 在席検知センサー有効化
   └─> 音声："車椅子接続成功"
```

### 4.2 乗客輸送シーケンス

```
6. TRANSPORTING → 目的地へナビゲート
   └─> 乗客乗車中、速度低減、快適性優先
   └─> eHMI："乗客乗車中、距離を保ってください"

7. ARRIVED_DESTINATION → 降車場所到着
   └─> 音声："目的地に到着しました"
   └─> 切り離し確認待ち

8. UNDOCKING → 機械的結合解除
   └─> ドッキング手順の逆

9. WHEELCHAIR_DETACHED → 解放確認
   └─> 音声："車椅子切り離し完了、準備完了"
   └─> IDLEまたは次のミッションへ
```

---

## 5. 設計原則

### 5.1 屋外優先哲学

**すべての要件が屋外動作を優先:**
- ハードウェア：防水、屋外グレードセンサー
- ソフトウェア：GPS喪失、照明変化、地形変動に堅牢
- 性能：勾配、不整地、気象条件で検証
- **屋内が容易に:** より良いローカライゼーション、より高速、より厳密な公差

### 5.2 関心の分離（アジャイル対応）

**各サブシステムは独立して:**
- 文書化（要件、アーキテクチャ、設計）
- 開発可能（並行チーム開発）
- テスト可能（ユニット + 統合 + システムテスト）
- 統合可能（明確なROS 2インターフェース）

---

## 6. 既存システムとの主な差別化要因

| 機能 | 本システム | 典型的な屋内車椅子ロボット | 優位性 |
|-----|-----------|------------------------|--------|
| **環境** | 屋外優先 + 屋内 | 屋内のみ | 実世界展開の柔軟性 |
| **ローカライゼーション** | 手動SLAM + NDT（GPS不要） | GPSまたはビーコンベース | コスト削減、<1km信頼性 |
| **ドライブシステム** | スワーブドライブ | メカナムまたは差動 | 優れた屋外性能 |
| **ドッキング精度** | 屋外±2-5mm | 一般的に±10cm | あらゆる条件で信頼性の高い接続 |
| **参照アーキテクチャ** | 実績あるParcelPalベース | ゼロからカスタム | 低リスク、高速開発 |

---

## 7. リスク軽減

### 7.1 技術的リスク

| リスク | 軽減策 | ステータス |
|-------|--------|----------|
| **屋外ローカライゼーションドリフト** | 手動SLAM + NDT（ParcelPal実証済み） | ✅ 検証済み |
| **屋外ドッキング精度** | ArUco + ビジュアルサーボイング | ⚠️ テスト必要 |
| **スワーブドライブ制御複雑性** | 段階的開発、ROS 2プラグイン | ⚠️ 新規開発 |

### 7.2 安全リスク

| リスク | 軽減策 | ステータス |
|-------|--------|----------|
| **輸送中の乗客転倒** | 在席検知、緊急停止、速度制限 | 🔄 設計段階 |
| **歩行者との衝突** | LiDAR障害物検出、eHMI警告 | ✅ ParcelPal実証済み |
| **荷重時の勾配安定性** | 10°設計限界、傾斜センサーカットオフ | 🔄 テスト必要 |

---

## 8. 成功基準

### 8.1 技術的成功

- ✅ ドッキング成功率 >95%（屋外条件）
- ✅ ローカライゼーション精度 500m超で±10cm（GPS不要）
- ✅ 障害物回避：テスト中の衝突ゼロ
- ✅ バッテリー寿命：乗客輸送で4時間以上
- ✅ 稼働率：>98%（メンテナンス除く）

---

## 9. 関連ドキュメント

**参照資料:**
- `reference/PARCELPAL_EXPLORATION_SUMMARY.md` - ParcelPalアーキテクチャ分析
- `reference/EHMI_SYSTEM_REFERENCE.md` - eHMI実装詳細
- `reference/SWERVE_DRIVE_SYSTEM_TASK.md` - 元のタスク仕様
- `reference/question_answers.md` - シニアレビューQ&A

**要件:**
- `01_REQUIREMENTS/SYSTEM_REQUIREMENTS.md` - 完全システム要件
- `01_REQUIREMENTS/SWERVE_DRIVE_REQUIREMENTS.md` - ドライブシステム仕様

**アーキテクチャ:**
- `02_ARCHITECTURE/OVERALL_SYSTEM_ARCHITECTURE.md` - 詳細アーキテクチャ

**開発:**
- `05_DEVELOPMENT/AGILE_ROADMAP.md` - スプリント計画とタイムライン

---

**ドキュメントステータス:** 完了
**次回レビュー:** フェーズ1スプリント1完了後
**バージョン履歴:**
- v1.0 (2025-12-15): 初版システム概要ドキュメント

# タイムライン付き完全テスト計画 - 屋外車椅子搬送ロボット

**ドキュメントID:** DOC-TEST-PLAN-002
**バージョン:** 1.0
**日付:** 2025-12-16
**ステータス:** アクティブテスト計画

---

## エグゼクティブサマリー

本ドキュメントは、**AI加速テスト生成と実行**を活用した屋外車椅子搬送ロボットシステムの包括的なテスト計画を提供します。

**主要パラメータ:**
- **チーム:** 1〜2名の開発者 + 1名の専任フィールドテスター
- **AI加速:** テスト作成時間を60〜70%削減、フィールドテスト時間を20〜30%削減
- **テストアプローチ:** 3層戦略（単体 → 統合 → フィールド）
- **カバレッジ目標:** 80%以上のラインカバレッジ、70%以上のブランチカバレッジ
- **タイムライン:** 開発スプリントと統合（サブシステムごとの段階的テスト）

**総テスト期間:** 24週間のプロジェクトタイムライン全体で約10週間

---

## テスト哲学

### AI加速テスト戦略

**従来のテストの課題:**
- 単体テスト作成に時間がかかる（多くの場合、開発時間の50%）
- 統合テストに複雑なセットアップが必要（launchファイル、モック）
- フィールドテストに広範なデータ収集と分析が必要

**AI加速ソリューション:**
- **AIが80%以上の単体テストを自動生成**（gtest/pytest）
- **AIがモックオブジェクトとテストフィクスチャを作成**
- **AIがフィールドテストデータを分析**し、洞察とパラメータチューニングを提供
- **AIが要件カバレッジに基づいてテストケースを提案**

---

## 3層テスト戦略

### 第1層: 単体テスト（AI生成、80%以上のカバレッジ）
**目的:** 個々のコンポーネントを独立して検証
**いつ:** 開発中（継続的）
**誰が:** 開発者（AI支援）
**期間:** サブシステムごとに約0.5週間
**カバレッジ目標:** 80%以上のラインカバレッジ、70%以上のブランチカバレッジ

### 第2層: 統合テスト（AI支援）
**目的:** サブシステム間の相互作用を検証
**いつ:** サブシステム開発後
**誰が:** 開発者（AI支援）
**期間:** サブシステムごとに約0.5週間
**カバレッジ目標:** 全サブシステム間インターフェースをテスト

### 第3層: フィールドテスト（段階的、実ハードウェア）
**目的:** 屋外性能と安全性を検証
**いつ:** サブシステムごとの統合後
**誰が:** 専任フィールドテスター + 開発者
**期間:** サブシステムごとに0.5〜1.5週間（重要度による）
**カバレッジ目標:** 実際の屋外条件で全要件を検証

---

## サブシステム別テストタイムライン

### スプリント1〜2: スワーブドライブテスト（第1〜4週）

#### 単体テスト（第3週、0.5週間）
**AIの役割:** 80%以上のテストケースを自動生成

| コンポーネント | テストタイプ | テストケース | AI生成 | 手動 | カバレッジ目標 |
|-----------|-----------|------------|--------------|--------|-----------------|
| 逆運動学 | アルゴリズム検証 | 15テストケース | 12（80%） | 3（エッジケース） | 90%以上 |
| 順運動学 | アルゴリズム検証 | 12テストケース | 10（83%） | 2（エッジケース） | 90%以上 |
| コントローラー状態マシン | 状態遷移 | 20テストケース | 18（90%） | 2（複雑） | 85%以上 |
| CANバスインターフェース | プロトコル検証 | 10テストケース | 8（80%） | 2（エラーケース） | 80%以上 |
| 速度ガバナー | 安全性制限 | 8テストケース | 8（100%） | 0 | 95%以上 |

**AIツール:**
- Claude Code: 要件からgtestテストケースを生成
- GitHub Copilot: テストフィクスチャとモックを生成
- AIコードレビュー: テストカバレッジと品質を検証

**成果物:** 65以上の単体テスト、85%以上のコードカバレッジ

---

#### 統合テスト（第3.5週、0.5週間）
**AIの役割:** launchファイル生成、統合問題のトラブルシューティング

| 統合ポイント | テストシナリオ | 期待動作 | AI支援 |
|------------------|---------------|-------------------|---------------|
| ROS 2コントローラーノード | /cmd_velをサブスクライブ、/joint_statesをパブリッシュ | 速度コマンドが車輪速度に変換される | AIがROS 2テストlaunchファイルを生成 |
| CANバス通信 | モーターコマンド送信、エンコーダーフィードバック受信 | モーターが50ms以内に応答 | AIがモックCANバスを作成 |
| TFツリー | 車輪TF変換をパブリッシュ | TFツリーが有効、リンク切れなし | AIがTFツリー構造を検証 |
| Nav2統合 | Nav2 cmd_vel → スワーブコントローラー | ロボットがNav2コマンドを実行 | AIがNav2パラメータをチューニング |

**AIツール:**
- AIがROS 2 launchテストファイルを生成
- AIが統合問題をトラブルシュート（トピック名、QoS、タイミング）

**成果物:** 4つの統合テストシナリオ合格

---

#### フィールドテスト（第4週、1週間）
**AIの役割:** テストデータ分析、パラメータチューニング提案

| テストシナリオ | 場所 | 受入基準 | データ収集 | AI分析 |
|---------------|----------|---------------------|-----------------|-------------|
| 直線運動 | 屋外駐車場（50m） | 50m上で±5cm偏差 | オドメトリ + GPS真値 | AIがドリフトパターンを検出 |
| 360°回転 | 開放エリア | ±2°最終方向誤差 | IMU + オドメトリ | AIが回転PIDをチューニング |
| 斜め移動 | 屋外駐車場（20m） | 滑らかな斜め軌跡 | 速度プロファイルロギング | AIが運動学を検証 |
| 速度ランプテスト | 直線パス（100m） | 5秒で0 → 1.5 m/s、安定 | 加速度プロファイル | AIが安全性制限をチェック |
| CANバス信頼性 | 1時間連続動作 | 0パケットロス、<10msレイテンシ | CANバスログ | AIが異常を検出 |

**テスト機器:**
- RTK-GPS（真値、±2cm精度）
- データロガー（ROS 2 bag録画）
- 外部監視者（安全性）

**AIツール:**
- AIがROS 2 bagファイルを分析（ドリフト、ジッター、レイテンシ）
- AIがPIDパラメータチューニングを提案
- AIが可視化付きテストレポートを生成

**成果物:** フィールドテストレポート、検証済みスワーブドライブ性能

---

### スプリント3〜4: ナビゲーションテスト（第5〜8週）

#### 単体テスト（第6週、0.5週間）
**AIの役割:** テストケース生成、モックマップ作成

| コンポーネント | テストタイプ | テストケース | AI生成 | カバレッジ目標 |
|-----------|-----------|------------|--------------|-----------------|
| NDT自己位置推定 | 姿勢推定精度 | 12テストケース | 10（83%） | 85%以上 |
| ルートマネージャー | ウェイポイントキュー管理 | 15テストケース | 13（87%） | 90%以上 |
| パス検証 | パス実行可能性チェック | 10テストケース | 9（90%） | 85%以上 |
| リカバリー動作 | スタック検出/リカバリー | 8テストケース | 7（88%） | 80%以上 |

**AIツール:**
- AIがモック点群マップを生成
- AIがテストシナリオを作成（ループクロージャ、誘拐ロボット）

**成果物:** 45以上の単体テスト、85%以上のコードカバレッジ

---

#### 統合テスト（第7週、0.5週間）

| 統合ポイント | テストシナリオ | 期待動作 | AI支援 |
|------------------|---------------|-------------------|---------------|
| NDT + マップサーバー | マップロード、ロボット自己位置推定 | ±10cm以内の姿勢推定 | AIがマップ品質を検証 |
| Nav2グローバルプランナー | 障害物ありの500mルート計画 | 有効なパスを生成 | AIがプランナーパラメータをチューニング |
| Nav2ローカルプランナー | 動的障害物回避 | ロボットが障害物を回避して再計画 | AIがDWBパラメータを最適化 |
| スワーブ + Nav2 | 計画されたパス実行 | スワーブドライブが滑らかにパスをフォロー | AIがコントローラーゲインをチューニング |

**成果物:** 4つの統合テストシナリオ合格

---

#### フィールドテスト（第8週、1.5週間）
**AIの役割:** 自己位置推定ドリフト分析、マップ改善提案

| テストシナリオ | 場所 | 受入基準 | データ収集 | AI分析 |
|---------------|----------|---------------------|-----------------|-------------|
| 屋外マッピング | キャンパスルート（500m） | 高品質NDTマップ作成 | LiDARスキャン + GPS | AIがマップ品質を評価（カバレッジ、解像度） |
| 自己位置推定精度 | 同じ500mルート（10周） | 500m上で±10cm誤差 | 真値GPS vs. NDT姿勢 | AIが系統的ドリフトを検出 |
| ウェイポイントナビゲーション | 10ウェイポイントルート | ロボットが各ウェイポイントに到達（±20cm） | ミッション成功率 | AIが失敗を分析 |
| 動的障害物 | 歩行者ありのルート | ロボットが再計画、衝突なし | 障害物検出ログ | AIがコストマップ更新を検証 |
| GPS拒否リカバリー | ミッション中にGPS信号をブロック | ロボットが自己位置推定を維持 | NDTのみの性能 | AIがNDT信頼性を検証 |

**テスト機器:**
- RTK-GPS（真値）
- 外部監視者（安全性 + 歩行者シミュレーション）
- データロガー（ROS 2 bag）

**成果物:** 自己位置推定精度検証（500m上で±10cm）、90%以上のウェイポイントナビゲーション成功

---

### スプリント5〜6: 知覚テスト（第9〜12週）

#### 単体テスト（第10週、0.5週間）

| コンポーネント | テストタイプ | テストケース | AI生成 | カバレッジ目標 |
|-----------|-----------|------------|--------------|-----------------|
| 地面除去 | RANSAC検証 | 12テストケース | 11（92%） | 90%以上 |
| 障害物クラスタリング | クラスター検出 | 10テストケース | 9（90%） | 85%以上 |
| コストマップ膨張 | 膨張半径 | 8テストケース | 8（100%） | 90%以上 |
| CPUパフォーマンス | 処理レイテンシ | 5テストケース | 5（100%） | 80%以上 |

**AIツール:**
- AIが合成点群テストデータを生成
- AIがテストシナリオを作成（縁石、岩、ポール、木）

**成果物:** 35以上の単体テスト、87%以上のコードカバレッジ

---

#### 統合テスト（第11週、0.5週間）

| 統合ポイント | テストシナリオ | 期待動作 | AI支援 |
|------------------|---------------|-------------------|---------------|
| LiDARドライバー + ROS 2 | 10Hzで点群をパブリッシュ | 安定した10Hzパブリッシュ | AIがレイテンシを監視 |
| PCLパイプライン | 生点群 → 障害物 | 地面除去、障害物検出 | AIがRANSACパラメータをチューニング |
| コストマップ統合 | 障害物 → Nav2コストマップ | 100ms以内のコストマップ更新 | AIが更新レートを最適化 |
| CPUパフォーマンス | Nucbox K6での完全パイプライン | 10Hzで<50% CPU使用率 | AIがボトルネックをプロファイル |

**成果物:** 4つの統合テストシナリオ合格、CPUパフォーマンス検証

---

#### フィールドテスト（第12週、1週間）

| テストシナリオ | 場所 | 受入基準 | データ収集 | AI分析 |
|---------------|----------|---------------------|-----------------|-------------|
| 障害物検出（静的） | 屋外環境 | >90%検出率（岩、縁石、ポール） | 検出ログ + 真値 | AIが適合率/再現率を計算 |
| 障害物検出（動的） | 歩行者ありのルート | >85%検出率、偽陰性なし | ビデオ + 検出ログ | AIが失敗ケースを分析 |
| 偽陽性分析 | 開放エリア（草、舗装） | <5%偽陽性率 | 点群 + コストマップデータ | AIが偽陽性ソースを特定 |
| 照明堅牢性 | 朝/正午/夕方テスト | 照明全体で一貫した検出 | 時刻別検出率 | AIが照明不変性を検証 |
| CPU熱テスト | 1時間連続動作 | CPU <85°C、サーマルスロットリングなし | CPU温度ログ | AIが熱安定性を監視 |

**テスト機器:**
- 外部監視者（真値ラベリング）
- カメラ（検証用ビデオ録画）
- データロガー（ROS 2 bag）

**成果物:** >90%障害物検出率、<5%偽陽性、CPUパフォーマンス検証

---

### スプリント7〜8: ドッキングテスト（第13〜16週）

#### 単体テスト（第14週、0.5週間）

| コンポーネント | テストタイプ | テストケース | AI生成 | カバレッジ目標 |
|-----------|-----------|------------|--------------|-----------------|
| ArUco検出 | 姿勢推定精度 | 15テストケース | 13（87%） | 90%以上 |
| カメラフュージョン | デュアルカメラデータフュージョン | 10テストケース | 9（90%） | 85%以上 |
| ビジュアルサーボ | PIDコントローラー | 12テストケース | 11（92%） | 90%以上 |
| ドッキング状態マシン | 状態遷移 | 18テストケース | 16（89%） | 88%以上 |
| 車椅子係合 | ラッチ検出 | 6テストケース | 6（100%） | 95%以上 |

**AIツール:**
- AIがモックArUco検出を生成（様々な姿勢、照明）
- AIがテストシナリオを作成（オクルージョン、日光、影）

**成果物:** 61以上の単体テスト、89%以上のコードカバレッジ

---

#### 統合テスト（第15週、0.5週間）

| 統合ポイント | テストシナリオ | 期待動作 | AI支援 |
|------------------|---------------|-------------------|---------------|
| カメラドライバー + ROS 2 | 30Hzでカメラ画像をパブリッシュ | 安定した30Hz、フレームドロップなし | AIがフレームレートを監視 |
| ArUco検出パイプライン | 屋外で4〜8マーカーを検出 | 日光下で堅牢な検出 | AIが検出パラメータをチューニング |
| ビジュアルサーボ + スワーブ | ドッキングステーションに整列（屋内） | ±2mm精度（屋内） | AIがPIDコントローラーをチューニング |
| Nav2ドッキング統合 | ドッキングアプローチ姿勢にナビゲート | 滑らかなアプローチ、ビジュアルサーボ引継ぎ | AIがNav2ドッキングを設定 |

**成果物:** 4つの統合テストシナリオ合格、屋内ドッキング動作（±2mm）

---

#### フィールドテスト（第16週、1.5週間）

| テストシナリオ | 場所 | 受入基準 | データ収集 | AI分析 |
|---------------|----------|---------------------|-----------------|-------------|
| 屋外ドッキング精度 | 屋外ドッキングステーション（平坦） | ±5mm精度、>90%成功率 | ドッキング姿勢ログ（100回以上の試行） | AIが精度分布を分析 |
| 日光堅牢性 | 朝/正午/夕方テスト | 全照明で>85%検出率 | 時刻別ArUco検出成功 | AIが照明最適化を提案 |
| 影処理 | 部分的に日陰のドッキングエリア | 影ありで堅牢な検出 | 影での検出成功 | AIが影耐性を検証 |
| アプローチ角度変化 | 0°、±30°、±60°からアプローチ | 全角度から成功ドッキング | アプローチ角度別成功率 | AIが最適角度を特定 |
| 車椅子係合 | 50回以上の係合テスト | >95%成功係合 | ラッチセンサーログ | AIが係合信頼性を検証 |
| 風堅牢性 | 風のある条件（10〜20 km/h） | 安定したドッキング、ドリフトなし | 風速 + ドッキング精度 | AIが風の影響を評価 |

**テスト機器:**
- 精密測定ツール（キャリパー、±0.1mm）
- 照度計（照明条件を検証）
- 風速計（風条件を検証）
- 外部監視者（安全性）

**成果物:** 屋外ドッキング検証（±5mm、>90%成功）、照明/風堅牢性確認

---

### スプリント9〜10: 安全性テスト（第15〜18週、並行）

#### 単体テスト（第16週、0.5週間）

| コンポーネント | テストタイプ | テストケース | AI生成 | カバレッジ目標 |
|-----------|-----------|------------|--------------|-----------------|
| 非常停止 | E-Stop応答時間 | 10テストケース | 10（100%） | 95%以上 |
| ウォッチドッグモニター | ノードヘルス検出 | 12テストケース | 11（92%） | 90%以上 |
| 速度ガバナー | 速度制限強制 | 8テストケース | 8（100%） | 95%以上 |
| 衝突回避 | 予測アルゴリズム | 15テストケース | 13（87%） | 85%以上 |
| 故障リカバリー | リカバリー動作 | 10テストケース | 9（90%） | 85%以上 |

**AIツール:**
- AIが安全性テストシナリオを生成（ノードクラッシュ、センサー故障）
- AIがタイミング要件を検証（<100ms E-Stop）

**成果物:** 55以上の単体テスト、90%以上のコードカバレッジ

---

#### 統合テスト（第17週、0.5週間）

| 統合ポイント | テストシナリオ | 期待動作 | AI支援 |
|------------------|---------------|-------------------|---------------|
| ハードウェアE-Stop | 物理的E-Stopボタン押下 | 100ms以内にロボット停止 | AIがタイミングログを検証 |
| ソフトウェアE-Stop | /emergency_stopトピックをパブリッシュ | 全ノードが受信し100ms以内に停止 | AIがトピック伝播を検証 |
| ウォッチドッグ + 全ノード | ノードクラッシュをシミュレート | ウォッチドッグが1秒以内に検出、リカバリーをトリガー | AIがウォッチドッグログを監視 |
| 衝突回避 + Nav2 | 1 m/sで障害物に接近 | 衝突前（<50cm）にロボット停止 | AIが衝突閾値をチューニング |

**成果物:** 4つの統合テストシナリオ合格、E-Stop <100ms検証

---

#### フィールドテスト（第18週、1週間）

| テストシナリオ | 場所 | 受入基準 | データ収集 | AI分析 |
|---------------|----------|---------------------|-----------------|-------------|
| 非常停止（ハードウェア） | 屋外ルート | 全シナリオで100ms以内に停止 | E-Stopタイミングログ（50回以上のテスト） | AIがタイミングコンプライアンスを検証 |
| 非常停止（ソフトウェア） | 屋外ルート | 100ms以内に停止 | E-Stop伝播ログ | AIがトピックレイテンシをチェック |
| 障害物衝突回避 | 動的障害物ありのルート | 0衝突、ロボット停止/再計画 | 衝突ログ（100回以上のテスト） | AIがエッジケースを特定 |
| ノードクラッシュリカバリー | ミッション中にナビゲーションノードをキル | ウォッチドッグが検出、リカバリー動作を起動 | ウォッチドッグログ + リカバリー時間 | AIがリカバリー時間を検証 |
| センサー故障処理 | ミッション中にLiDARを切断 | ロボットが故障を検出、安全に停止 | 故障検出ログ | AIが故障検出を検証 |
| バッテリー低処理 | <20%バッテリーをシミュレート | ロボットがミッション中止、ベースに戻る | バッテリーモニタリングログ | AIが低バッテリー動作を検証 |

**テスト機器:**
- 外部監視者（安全性 + 故障注入）
- 高速カメラ（E-Stopタイミング検証）
- データロガー（ROS 2 bag）

**成果物:** 安全性システム検証（E-Stop <100ms、0衝突、故障リカバリー動作）

---

### スプリント11〜12: UIテスト（第17〜20週、並行）

#### 単体テスト（第18週、0.5週間）

| コンポーネント | テストタイプ | テストケース | AI生成 | カバレッジ目標 |
|-----------|-----------|------------|--------------|-----------------|
| Reactコンポーネント | コンポーネントレンダリング | 20テストケース | 18（90%） | 85%以上 |
| rosbridgeクライアント | WebSocket通信 | 12テストケース | 11（92%） | 90%以上 |
| 状態管理 | Zustandストア | 10テストケース | 10（100%） | 90%以上 |
| 多言語サポート | i18n翻訳 | 8テストケース | 8（100%） | 95%以上 |

**AIツール:**
- AIがJest/React Testing Libraryテストケースを生成
- AIがモックrosbridge WebSocketを作成

**成果物:** 50以上の単体テスト、88%以上のコードカバレッジ

---

#### 統合テスト（第19週、0.5週間）

| 統合ポイント | テストシナリオ | 期待動作 | AI支援 |
|------------------|---------------|-------------------|---------------|
| rosbridge + ROS 2 | UIが/robot_statusをサブスクライブ | リアルタイムステータス更新 | AIがWebSocket問題をトラブルシュート |
| ミッションコントロール | UIからミッション開始/停止/一時停止 | ロボットがUIコマンドに応答 | AIがサービスコールを検証 |
| E-Stopボタン | UI E-Stopボタン押下 | 100ms以内にロボット停止 | AIがE-Stop伝播を検証 |
| 多言語切替 | EN → JP → ZH切替 | UIが即座に更新、エラーなし | AIが翻訳完全性を検証 |

**成果物:** 4つの統合テストシナリオ合格、rosbridge信頼性確保

---

#### フィールドテスト（第20週、0.5週間）

| テストシナリオ | 場所 | 受入基準 | データ収集 | AI分析 |
|---------------|----------|---------------------|-----------------|-------------|
| タッチスクリーン応答性 | 屋外タッチスクリーン | <200msタップ応答時間 | タッチイベントログ | AIが応答性を検証 |
| 日光視認性 | 屋外（強い日光） | >400 nitsでUI読取可能 | ユーザーフィードバック（オペレーター） | AIがUI輝度/コントラストチューニングを提案 |
| ユーザビリティテスト | 5名のオペレーター（初心者 + 専門家） | 基本操作の学習に<5分 | ユーザーフィードバックアンケート | AIがユーザーの課題を分析 |
| ネットワーク信頼性 | 1時間連続動作 | 0 WebSocket切断 | rosbridge接続ログ | AIが接続安定性を監視 |

**テスト機器:**
- 外部オペレーター（ユーザビリティテスト）
- 照度計（画面輝度検証）

**成果物:** 屋外ユーザビリティ検証済みUI、<5分のオペレーター学習曲線

---

### スプリント13: eHMIテスト（第19〜21週、並行）

#### 単体テスト（第20週、0.5週間）

| コンポーネント | テストタイプ | テストケース | AI生成 | カバレッジ目標 |
|-----------|-----------|------------|--------------|-----------------|
| LEDストリップ制御 | パターン生成 | 12テストケース | 11（92%） | 90%以上 |
| LEDマトリックス制御 | マトリックスパターン | 10テストケース | 9（90%） | 88%以上 |
| I2S音声再生 | 音声出力 | 8テストケース | 8（100%） | 90%以上 |
| シリアルプロトコル | UART通信 | 15テストケース | 14（93%） | 92%以上 |
| 状態マシン | 車椅子状態遷移 | 20テストケース | 18（90%） | 88%以上 |

**AIツール:**
- AIがESP32ファームウェアテストを生成
- AIがモックシリアル入力を作成

**成果物:** 65以上の単体テスト、90%以上のコードカバレッジ

---

#### 統合テスト（第21週、0.5週間）

| 統合ポイント | テストシナリオ | 期待動作 | AI支援 |
|------------------|---------------|-------------------|---------------|
| ESP32 + ROS 2シリアルノード | ROS 2が車椅子状態をパブリッシュ | ESP32が受信、LED/音声を更新 | AIがシリアル問題をトラブルシュート |
| LED視認性 | 8つの車椅子状態をテスト | 各状態が独自のLEDパターン | AIがパターンの独自性を検証 |
| 音声明瞭度 | 8つの車椅子状態をテスト | 各状態が独自の音声キュー | AIが音声明瞭度を検証 |
| シリアル信頼性 | 1時間連続状態更新 | 0パケットロス、<10msレイテンシ | AIがシリアルログを監視 |

**成果物:** 4つの統合テストシナリオ合格、シリアル通信信頼性確保

---

#### フィールドテスト（第21週、0.5週間）

| テストシナリオ | 場所 | 受入基準 | データ収集 | AI分析 |
|---------------|----------|---------------------|-----------------|-------------|
| LED視認性（日光） | 屋外（強い日光） | 10mからLED視認可能 | 観察者フィードバック | AIが輝度チューニングを提案 |
| 音声明瞭度（屋外） | 屋外（環境騒音） | 5mから音声聴取可能 | 音圧計 + 観察者フィードバック | AIが音量チューニングを提案 |
| 車椅子状態遷移 | 8つの車椅子状態（21〜28） | 各状態に正しいLED + 音声 | 状態遷移ログ | AIが状態精度を検証 |
| 歩行者認識 | 観察者がロボットに接近 | eHMIが適切に応答 | 観察者フィードバック | AIが歩行者インタラクションを検証 |

**テスト機器:**
- 外部監視者（歩行者シミュレーション）
- 音圧計（音声音量検証）
- 照度計（LED輝度検証）

**成果物:** 屋外視認性/聴取可能性検証済みeHMI、8つの車椅子状態動作

---

## システム統合とフィールド検証テスト

### スプリント14: システム統合テスト（第21〜22週）

**チーム:** 1〜2名の開発者 + 1名のテスター
**AIの役割:** 統合問題のトラブルシューティング、システムログ分析

#### 統合テストシナリオ（第21〜22週、2週間）

| シナリオ | 説明 | 受入基準 | 期間 |
|----------|-------------|---------------------|----------|
| **完全ミッション（屋内）** | 開始 → ナビゲート → ドック → 復帰（まず屋内） | 100%成功率（制御された環境） | 2日 |
| **完全ミッション（屋外平坦）** | 開始 → 500mナビゲーション → ドック → 復帰（平坦な屋外） | >90%成功率 | 3日 |
| **障害物回避ミッション** | 動的障害物ありのルートをナビゲート | ロボットが再計画、衝突なし | 2日 |
| **安全性シナリオテスト** | ミッション中のE-Stop、ノードクラッシュ、センサー故障 | ロボットが安全に停止、可能な場合リカバリー | 2日 |
| **マルチミッション耐久** | 10回連続ミッション（再起動なし） | ロボットが全10ミッション完了 | 3日 |

**AI支援:**
- AIがボトルネック、失敗のシステムログを分析
- AIがパフォーマンス最適化を提案（CPU、ネットワーク、タイミング）
- AIが統合テストレポートを生成

**成果物:** 全サブシステム統合、屋内 + 平坦な屋外ミッション動作（>90%成功）

---

### スプリント15: フィールド検証テスト（第23〜24週）

**チーム:** 1〜2名の開発者 + 1名の専任テスター
**AIの役割:** ミッション成功率分析、テストデータ処理、検証レポート生成

#### フィールド検証シナリオ（第23〜24週、2週間）

| シナリオ | 説明 | 受入基準 | 期間 | テスト実行 |
|----------|-------------|---------------------|----------|-----------|
| **500mナビゲーション + ドッキング** | 完全ミッション（ナビゲーション + 高精度ドッキング） | >90%成功率 | 3日 | 50回以上 |
| **気象堅牢性** | 雨、風、極端な温度でテスト | 全条件でシステム稼働 | 2日 | 20回以上 |
| **照明堅牢性** | 朝、正午、夕方テスト | 照明全体で一貫した性能 | 2日 | 30回以上 |
| **地形変化** | 平坦、わずかな傾斜、荒れた舗装 | ロボットが地形変化を処理 | 2日 | 20回以上 |
| **安全性検証** | E-Stop、障害物回避、センサー故障 | 100%安全性コンプライアンス | 2日 | 30回以上 |
| **バッテリー耐久** | 4時間以上の連続動作 | バッテリーが4時間以上持続、低バッテリー処理動作 | 1日 | 5回以上 |
| **オペレータートレーニング** | 3名のオペレーターをトレーニング、ユーザビリティ検証 | オペレーターが<30分で習熟 | 1日 | 3名のオペレーター |

**テスト機器:**
- RTK-GPS（真値）
- 気象ステーション（温度、風、雨）
- 照度計（照明条件検証）
- データロガー（ROS 2 bag、全センサー）
- 外部監視者（安全性）

**AI支援:**
- AIが150回以上のテスト実行データを処理（ミッション成功率、故障モード）
- AIが統計分析を生成（成功率、精度分布、故障パターン）
- AIが推奨事項付き最終検証レポートを作成

**成果物:** フィールド検証レポート（>90%ミッション成功率、MVP受入基準達成）

---

## テスト指標と受入基準

### コードカバレッジ目標

| サブシステム | ラインカバレッジ | ブランチカバレッジ | テストケース | AI生成% |
|-----------|---------------|-----------------|------------|----------------|
| スワーブドライブ | 85%以上 | 75%以上 | 65以上 | 82% |
| ナビゲーション | 85%以上 | 70%以上 | 45以上 | 85% |
| 知覚 | 87%以上 | 72%以上 | 35以上 | 89% |
| ドッキング | 89%以上 | 75%以上 | 61以上 | 88% |
| 安全性 | 90%以上 | 80%以上 | 55以上 | 91% |
| UI | 88%以上 | 70%以上 | 50以上 | 90% |
| eHMI | 90%以上 | 75%以上 | 65以上 | 91% |
| **全体** | **87%以上** | **74%以上** | **376以上** | **88%** |

**総テストケース:** 376以上（88% AI生成、12%手動改良）

---

### フィールドテスト成功基準

| テストカテゴリー | 指標 | 目標 | 測定方法 |
|--------------|--------|--------|-------------------|
| **ナビゲーション精度** | 自己位置推定誤差 | 500m上で±10cm | RTK-GPS真値 |
| **ドッキング精度** | 最終ドッキング誤差 | ±5mm（屋外） | 精密測定ツール |
| **障害物検出** | 検出率 | >90%（静的）、>85%（動的） | 真値ラベリング |
| **安全性コンプライアンス** | E-Stop応答 | <100ms（ハードウェア + ソフトウェア） | 高速タイミングログ |
| **ミッション成功率** | 完全ミッション完了 | >90%（MVP）、>95%（本番） | ミッションログ（150回以上の実行） |
| **バッテリー耐久** | 連続動作 | 4時間以上 | バッテリーモニタリングログ |
| **オペレーターユーザビリティ** | 学習曲線 | <30分（基本操作） | ユーザーフィードバックアンケート |

---

### MVP受入基準（第24週）

**全て合格必須:**
- ✅ 500m屋外ナビゲーション（>90%成功率）
- ✅ 高精度ドッキング（±5mm、>90%成功率）
- ✅ 障害物検出（>90%静的、>85%動的）
- ✅ 安全性コンプライアンス（E-Stop <100ms、0衝突）
- ✅ バッテリー耐久（4時間以上）
- ✅ 気象堅牢性（雨、風、温度）
- ✅ コードカバレッジ（87%以上ライン、74%以上ブランチ）
- ✅ オペレータートレーニング（<30分学習曲線）

**本番受入基準（将来）:**
- 500m屋外ナビゲーション（>95%成功率）
- 高精度ドッキング（±2mm、>95%成功率）
- 100回以上連続ミッション（再起動なし）
- 6ヶ月のフィールド信頼性データ

---

## テストツールとインフラストラクチャ

### AI駆動テストツール

1. **単体テスト生成**
   - **ツール:** Claude Code、GitHub Copilot
   - **用途:** 要件からgtest/pytestテストケースを生成
   - **加速:** テスト作成が4〜6倍高速

2. **テストデータ生成**
   - **ツール:** AI生成合成データ（点群、画像、センサーデータ）
   - **用途:** 実ハードウェアなしでテストシナリオを作成
   - **加速:** テストデータ作成が3〜5倍高速

3. **テスト分析**
   - **ツール:** AIログ分析、統計分析
   - **用途:** フィールドテストデータ分析、故障パターン特定
   - **加速:** データ分析が2〜3倍高速

4. **テストレポート生成**
   - **ツール:** AIドキュメント生成
   - **用途:** 可視化付きテストレポート生成
   - **加速:** レポート作成が4〜5倍高速

---

### 従来のテストツール

1. **単体テスト（C++）**
   - **フレームワーク:** gtest、gmock
   - **カバレッジ:** gcov、lcov
   - **CI/CD:** GitHub Actions（自動テスト実行）

2. **単体テスト（Python）**
   - **フレームワーク:** pytest、unittest
   - **カバレッジ:** pytest-cov
   - **CI/CD:** GitHub Actions

3. **統合テスト（ROS 2）**
   - **フレームワーク:** launch_testing（ROS 2）
   - **シミュレーション:** Gazebo（物理シミュレーション）
   - **可視化:** RViz（データ可視化）

4. **フィールドテスト**
   - **データロギング:** rosbag2（ROS 2 bag録画）
   - **真値:** RTK-GPS（±2cm精度）
   - **分析:** Plotly、Matplotlib（データ可視化）

---

## テストリソース配分

### 開発者1（主要）
- **単体テスト:** 開発中にAI生成テストを作成/レビュー（継続的）
- **統合テスト:** launchファイルセットアップ、統合問題のトラブルシューティング（サブシステムごとに0.5週間）
- **フィールドテストサポート:** フィールドテスト中のパラメータチューニング、バグ修正（必要に応じて）

### 開発者2（パートタイム）
- **UIテスト:** Reactコンポーネントテスト、rosbridge統合テスト（スプリント11〜12）
- **eHMIテスト:** ESP32ファームウェアテスト、シリアルプロトコルテスト（スプリント13）
- **統合サポート:** システム統合テストの支援（スプリント14）

### フィールドテスター（専任）
- **フィールドテスト:** 全フィールドテストシナリオ実行（第4、8、12、16、18、20、21〜24週）
- **データ収集:** 全テストデータ録画（ROS 2 bag、真値）
- **安全性監視:** 安全なテスト運用確保（E-Stop準備）

**総テスト労力:**
- **開発者1:** テストに約25%の時間（残りは開発）
- **開発者2:** テストに約30%の時間（UI/eHMI重点）
- **フィールドテスター:** フィールドテストに100%の時間（24週間プロジェクト全体で10週間）

---

## リスク管理と緊急時対応テスト

### 追加テストが必要な高リスクエリア

| リスクエリア | テスト戦略 | 追加時間配分 |
|-----------|-----------------|----------------------|
| **NDT屋外自己位置推定ドリフト** | 拡張フィールドテスト（20周以上）、様々な気象条件 | +1週間（失敗時、センサーフュージョン追加） |
| **ArUco屋外検出（日光/影）** | 200回以上のドッキング試行、朝/正午/夕方テスト | +1週間（失敗時、IRマーカー追加） |
| **CPUパフォーマンスボトルネック** | 早期プロファイリング、完全センサーレートでのストレステスト | +0.5週間（失敗時、センサー周波数削減） |
| **安全性認証（ISO 13482）** | 正式な安全性検証、サードパーティ監査 | +2週間（外部監査を計画） |

**緊急時対応バッファー:** 予期しない問題に対してテストタイムラインに2〜3週間を追加

---

## テストタイムライン概要

### サブシステム別テスト時間

| サブシステム | 単体 | 統合 | フィールド | 総テスト | 開発の% |
|-----------|------|-------------|-------|---------------|------------------|
| スワーブドライブ | 0.5週間 | 0.5週間 | 1週間 | 2週間 | 57% |
| ナビゲーション | 0.5週間 | 0.5週間 | 1.5週間 | 2.5週間 | 71% |
| 知覚 | 0.5週間 | 0.5週間 | 1週間 | 2週間 | 67% |
| ドッキング | 0.5週間 | 0.5週間 | 1.5週間 | 2.5週間 | 63% |
| 安全性 | 0.5週間 | 0.5週間 | 1週間 | 2週間 | 67% |
| UI | 0.5週間 | 0.5週間 | 0.5週間 | 1.5週間 | 50% |
| eHMI | 0.5週間 | 0.5週間 | 0.5週間 | 1.5週間 | 60% |
| **小計** | **3.5週間** | **3.5週間** | **7週間** | **14週間** | - |
| **統合と検証** | - | 2週間 | 2週間 | 4週間 | - |
| **合計** | **3.5週間** | **5.5週間** | **9週間** | **18週間** | **24週間の75%** |

**注:** テストは開発と重複（開発中の単体テスト、開発後の統合テスト、段階的フィールドテスト）

**実際のテスト時間（専任）:** 約10週間（フィールドテスト + 統合）

---

## 次のステップ

### 即時アクション（スプリント1）
1. ✅ テストインフラストラクチャセットアップ（gtest、pytest、GitHub Actions CI/CD）
2. ✅ AIテストツール設定（Claude Codeでテスト生成）
3. ✅ フィールドテスト機器準備（RTK-GPS、データロガー）
4. ✅ 単体テスト生成開始（スワーブドライブ、AI支援）

### 継続的テストプロセス
- **毎スプリント:** 単体テスト（AI生成、80%以上のカバレッジ）
- **各サブシステム終了時:** 統合テスト + フィールドテスト
- **スプリント14〜15:** 完全システム統合 + フィールド検証

---

**ドキュメントステータス:** アクティブ - 継続更新ドキュメント
**最終更新:** 2025-12-16
**管理者:** QAリード + 開発チーム
**レビュー頻度:** 隔週（結果に基づいてテスト戦略を調整）

---

**ドキュメント終了**
